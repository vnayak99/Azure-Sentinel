{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "DomainTools - memberservices@domaintools.com",
    "comments": "Solution template for DomainTools"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    }
  },
  "variables": {
    "email": "memberservices@domaintools.com",
    "_email": "[variables('email')]",
    "_solutionName": "DomainTools",
    "_solutionVersion": "3.0.0",
    "solutionId": "domaintoolsllc1647901527537.domaintools-iris-investigate",
    "_solutionId": "[variables('solutionId')]",
    "DomainToolsFunctionApp": "DomainToolsFunctionApp",
    "_DomainToolsFunctionApp": "[variables('DomainToolsFunctionApp')]",
    "playbookVersion1": "1.0",
    "playbookContentId1": "DomainToolsFunctionApp",
    "_playbookContentId1": "[variables('playbookContentId1')]",
    "playbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-fa-',uniquestring(variables('_playbookContentId1'))))]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "_playbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','fa','-', uniqueString(concat(variables('_solutionId'),'-','AzureFunction','-',variables('_playbookContentId1'),'-', variables('playbookVersion1'))))]",
    "blanks": "[replace('b', 'b', '')]",
    "DomainTools_Iris_Enrich-Domain_Playbook": "DomainTools_Iris_Enrich-Domain_Playbook",
    "_DomainTools_Iris_Enrich-Domain_Playbook": "[variables('DomainTools_Iris_Enrich-Domain_Playbook')]",
    "TemplateEmptyArray": "[json('[]')]",
    "playbookVersion2": "1.0",
    "playbookContentId2": "DomainTools_Iris_Enrich-Domain_Playbook",
    "_playbookContentId2": "[variables('playbookContentId2')]",
    "playbookId2": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId2'))]",
    "playbookTemplateSpecName2": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId2'))))]",
    "_playbookcontentProductId2": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId2'),'-', variables('playbookVersion2'))))]",
    "DomainTools_Iris_Investigate-Domain_Playbook": "DomainTools_Iris_Investigate-Domain_Playbook",
    "_DomainTools_Iris_Investigate-Domain_Playbook": "[variables('DomainTools_Iris_Investigate-Domain_Playbook')]",
    "playbookVersion3": "1.0",
    "playbookContentId3": "DomainTools_Iris_Investigate-Domain_Playbook",
    "_playbookContentId3": "[variables('playbookContentId3')]",
    "playbookId3": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId3'))]",
    "playbookTemplateSpecName3": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId3'))))]",
    "_playbookcontentProductId3": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId3'),'-', variables('playbookVersion3'))))]",
    "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook": "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook",
    "_DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook": "[variables('DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook')]",
    "playbookVersion4": "1.0",
    "playbookContentId4": "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook",
    "_playbookContentId4": "[variables('playbookContentId4')]",
    "playbookId4": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId4'))]",
    "playbookTemplateSpecName4": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId4'))))]",
    "_playbookcontentProductId4": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId4'),'-', variables('playbookVersion4'))))]",
    "DomainTools_Iris_Investigate-Guided_Pivots_Playbook": "DomainTools_Iris_Investigate-Guided_Pivots_Playbook",
    "_DomainTools_Iris_Investigate-Guided_Pivots_Playbook": "[variables('DomainTools_Iris_Investigate-Guided_Pivots_Playbook')]",
    "playbookVersion5": "1.0",
    "playbookContentId5": "DomainTools_Iris_Investigate-Guided_Pivots_Playbook",
    "_playbookContentId5": "[variables('playbookContentId5')]",
    "playbookId5": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId5'))]",
    "playbookTemplateSpecName5": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId5'))))]",
    "_playbookcontentProductId5": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId5'),'-', variables('playbookVersion5'))))]",
    "DomainTools_Iris_Investigate-Malicious_Tags_Playbook": "DomainTools_Iris_Investigate-Malicious_Tags_Playbook",
    "_DomainTools_Iris_Investigate-Malicious_Tags_Playbook": "[variables('DomainTools_Iris_Investigate-Malicious_Tags_Playbook')]",
    "playbookVersion6": "1.0",
    "playbookContentId6": "DomainTools_Iris_Investigate-Malicious_Tags_Playbook",
    "_playbookContentId6": "[variables('playbookContentId6')]",
    "playbookId6": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId6'))]",
    "playbookTemplateSpecName6": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId6'))))]",
    "_playbookcontentProductId6": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId6'),'-', variables('playbookVersion6'))))]",
    "DomainTools_Iris_Investigate-URL_Playbook": "DomainTools_Iris_Investigate-URL_Playbook",
    "_DomainTools_Iris_Investigate-URL_Playbook": "[variables('DomainTools_Iris_Investigate-URL_Playbook')]",
    "playbookVersion7": "1.0",
    "playbookContentId7": "DomainTools_Iris_Investigate-URL_Playbook",
    "_playbookContentId7": "[variables('playbookContentId7')]",
    "playbookId7": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId7'))]",
    "playbookTemplateSpecName7": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId7'))))]",
    "_playbookcontentProductId7": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId7'),'-', variables('playbookVersion7'))))]",
    "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook": "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook",
    "_DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook": "[variables('DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook')]",
    "playbookVersion8": "1.0",
    "playbookContentId8": "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook",
    "_playbookContentId8": "[variables('playbookContentId8')]",
    "playbookId8": "[resourceId('Microsoft.Logic/workflows', variables('playbookContentId8'))]",
    "playbookTemplateSpecName8": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-pl-',uniquestring(variables('_playbookContentId8'))))]",
    "_playbookcontentProductId8": "[concat(take(variables('_solutionId'),50),'-','pl','-', uniqueString(concat(variables('_solutionId'),'-','Playbook','-',variables('_playbookContentId8'),'-', variables('playbookVersion8'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainToolsFunctionApp Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion1')]",
          "parameters": {
            "FunctionAppName": {
              "defaultValue": "DomainToolsFunctionApp",
              "type": "String"
            },
            "AppInsightsWorkspaceResourceID": {
              "type": "string",
              "metadata": {
                "description": "Migrate Classic Application Insights to Log Analytic Workspace which is retiring by 29 Febraury 2024. Use 'Log Analytic Workspace-->Properties' blade having 'Resource ID' property value. This is a fully qualified resourceId which is in format '/subscriptions/{subscriptionId}/resourceGroups/{resourceGroupName}/providers/Microsoft.OperationalInsights/workspaces/{workspaceName}'"
              }
            }
          },
          "variables": {
            "functionappName": "[[concat(toLower(parameters('FunctionAppName')), uniqueString(resourceGroup().id))]",
            "storageAccountName": "[[concat(uniquestring(resourceGroup().id), 'storageacc')]",
            "storageAccountType": "Standard_LRS",
            "storageAccountTier": "Standard",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "playbookContentId1": "DomainToolsFunctionApp",
            "playbookId1": "[[resourceId('Microsoft.Logic/workflows', variables('playbookContentId1'))]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/serverfarms",
              "apiVersion": "2021-02-01",
              "name": "[[variables('functionappName')]",
              "location": "[[variables('workspace-location-inline')]",
              "sku": {
                "name": "S1"
              },
              "kind": "linux",
              "properties": {
                "reserved": true
              }
            },
            {
              "type": "Microsoft.Storage/storageAccounts",
              "apiVersion": "2022-09-01",
              "name": "[[variables('storageAccountName')]",
              "location": "[[variables('workspace-location-inline')]",
              "sku": {
                "name": "[[variables('StorageAccountType')]",
                "tier": "[[variables('StorageAccountTier')]"
              },
              "kind": "StorageV2"
            },
            {
              "type": "Microsoft.Insights/components",
              "apiVersion": "2020-02-02",
              "name": "[[variables('functionappName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "web",
              "properties": {
                "Application_Type": "web",
                "ApplicationId": "[[variables('functionappName')]",
                "WorkspaceResourceId": "[[parameters('AppInsightsWorkspaceResourceID')]"
              }
            },
            {
              "apiVersion": "2015-08-01",
              "type": "Microsoft.Web/sites",
              "name": "[[variables('functionappName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "functionapp,linux",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Storage/storageAccounts', variables('storageAccountName'))]",
                "[[resourceId('Microsoft.Insights/components', variables('functionappName'))]",
                "[[resourceId('Microsoft.Web/serverfarms', variables('functionappName'))]"
              ],
              "properties": {
                "name": "[[variables('functionAppName')]",
                "serverFarmId": "[[resourceId('Microsoft.Web/serverfarms', variables('functionappName'))]",
                "siteConfig": {
                  "alwaysOn": true,
                  "cors": {
                    "allowedOrigins": [
                      "*"
                    ]
                  },
                  "appSettings": [
                    {
                      "name": "AzureWebJobsStorage",
                      "value": "[[concat('DefaultEndpointsProtocol=https;AccountName=', variables('storageAccountName'), ';AccountKey=', listKeys(resourceId('Microsoft.Storage/storageAccounts', toLower(variables('storageAccountName'))), '2022-09-01').keys[0].value)]"
                    },
                    {
                      "name": "APPINSIGHTS_INSTRUMENTATIONKEY",
                      "value": "[[reference(resourceId('Microsoft.insights/components', variables('functionappName')), '2020-02-02').InstrumentationKey]"
                    },
                    {
                      "name": "APPLICATIONINSIGHTS_CONNECTION_STRING",
                      "value": "[[reference(resourceId('microsoft.insights/components', variables('functionappName')), '2020-02-02').ConnectionString]"
                    },
                    {
                      "name": "WEBSITE_RUN_FROM_PACKAGE",
                      "value": "https://github.com/Azure/Azure-Sentinel/blob/master/Solutions/DomainTools/Playbooks/DomainToolsFunctionApp/ExtractDomainFromUrl.zip?raw=true"
                    },
                    {
                      "name": "FUNCTIONS_EXTENSION_VERSION",
                      "value": "~3"
                    },
                    {
                      "name": "FUNCTIONS_WORKER_RUNTIME",
                      "value": "python"
                    },
                    {
                      "name": "linuxFxVersion",
                      "value": "python|3.8"
                    }
                  ]
                }
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[[concat(variables('workspace-name'),'/Microsoft.SecurityInsights/',concat('AzureFunction-', last(split(variables('playbookId1'),'/'))))]",
              "properties": {
                "parentId": "[[variables('playbookId1')]",
                "contentId": "[variables('_playbookContentId1')]",
                "kind": "AzureFunction",
                "version": "[variables('playbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Extract Domain from URL",
            "description": "Given a URL, this function will extract the proper domain.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "tags": [
              "Utilities"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId1')]",
        "contentKind": "AzureFunction",
        "displayName": "DomainToolsFunctionApp",
        "contentProductId": "[variables('_playbookcontentProductId1')]",
        "id": "[variables('_playbookcontentProductId1')]",
        "version": "[variables('playbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName2')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Enrich-Domain_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion2')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Enrich-Domain_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisenric-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "registrar_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each_Host": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Check_if_results_exists": {
                          "actions": {
                            "Results_Loop": {
                              "foreach": "@body('Enrich_Domain')?['response']?['results']",
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Technical_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><span style=\"font-size: 16px\"><strong>DomainTools IRIS Enrich response for:</strong></span><span style=\"font-size: 16px\"> </span><span style=\"font-size: 16px\">@{variables('domain_name')}</span><span style=\"font-size: 16px\"></span><br>\n@{body('Domain_detailts_Table')}@{replace(replace(replace(body('Domain_Risk_Score_Components_Table') , '&quot;', ''),']','') , '[', '') }@{body('miscellaneouos_Table')}@{body('IP_Table')}@{body('MX_Table')}@{body('Nameserver_Table')}@{body('Admin_Contact_Table')}@{body('Billing_Contact_Table')}@{body('Registrant_Contact_Table')}@{body('Technical_Contact_Table')}<br>\n<strong>Find more details:</strong> https://research.domaintools.com/iris/search/?q=@{variables('domain_name')}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Admin_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Admin_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Admin Contact City": "@items('Results_Loop')?['admin_contact']?['city']?['value']",
                                    "Admin Contact Country": "@items('Results_Loop')?['admin_contact']?['country']?['value']",
                                    "Admin Contact Email": "@substring(variables('admin_contact_email'),0,sub(length(variables('admin_contact_email')),1))",
                                    "Admin Contact Fax": "@items('Results_Loop')?['admin_contact']?['fax']?['value']",
                                    "Admin Contact Name": "@items('Results_Loop')?['admin_contact']?['name']?['value']",
                                    "Admin Contact Org": "@items('Results_Loop')?['admin_contact']?['org']?['value']",
                                    "Admin Contact Phone": "@items('Results_Loop')?['admin_contact']?['phone']?['value']",
                                    "Admin Contact Postal": "@items('Results_Loop')?['admin_contact']?['postal']?['value']",
                                    "Admin Contact State": "@items('Results_Loop')?['admin_contact']?['state']?['value']",
                                    "Admin Contact Street": "@items('Results_Loop')?['admin_contact']?['street']?['value']"
                                  }
                                },
                                "Admin_Contact_Table": {
                                  "runAfter": {
                                    "Nameserver_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('admin_contact_details')"
                                  }
                                },
                                "Append_to__Domain_Details_array": {
                                  "runAfter": {
                                    "_Domain_Details_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "@outputs('_Domain_Details_Compose')"
                                  }
                                },
                                "Append_to_admin_contact_array": {
                                  "runAfter": {
                                    "Admin_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "@outputs('Admin_Contact_Compose')"
                                  }
                                },
                                "Append_to_billing_contact_array": {
                                  "runAfter": {
                                    "Billing_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "@outputs('Billing_Contact_Compose')"
                                  }
                                },
                                "Append_to_miscellaneous_array_variable": {
                                  "runAfter": {
                                    "Miscellaneous_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "@outputs('Miscellaneous_Compose')"
                                  }
                                },
                                "Append_to_registrant_contact_array": {
                                  "runAfter": {
                                    "Registrant_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "@outputs('Registrant_Contact_Compose')"
                                  }
                                },
                                "Append_to_techinical_contact_array": {
                                  "runAfter": {
                                    "Technical_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "@outputs('Technical_Contact_Compose')"
                                  }
                                },
                                "Billing_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Billing_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Billing Contact City": "@items('Results_Loop')?['billing_contact']?['city']?['value']",
                                    "Billing Contact Country": "@items('Results_Loop')?['billing_contact']?['country']?['value']",
                                    "Billing Contact Email": "@substring(variables('billing_contact_email'),0,sub(length(variables('billing_contact_email')),1))",
                                    "Billing Contact Fax": "@items('Results_Loop')?['billing_contact']?['fax']?['value']",
                                    "Billing Contact Name": "@items('Results_Loop')?['billing_contact']?['name']?['value']",
                                    "Billing Contact Org": "@items('Results_Loop')?['billing_contact']?['org']?['value']",
                                    "Billing Contact Phone": "@items('Results_Loop')?['billing_contact']?['phone']?['value']",
                                    "Billing Contact Postal": "@items('Results_Loop')?['billing_contact']?['postal']?['value']",
                                    "Billing Contact State": "@items('Results_Loop')?['billing_contact']?['state']?['value']",
                                    "Billing Contact Street": "@items('Results_Loop')?['billing_contact']?['street']?['value']"
                                  }
                                },
                                "Billing_Contact_Table": {
                                  "runAfter": {
                                    "Admin_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('billing_contact_details')"
                                  }
                                },
                                "Condition": {
                                  "actions": {
                                    "set_registrar_value_to_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrar_value",
                                        "value": "@{items('Results_Loop')?['registrar']?['value']}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_registrar_value": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(variables('registrar_value'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Domain_Risk_Score_Components_Table": {
                                  "runAfter": {
                                    "Domain_detailts_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@items('Results_Loop')?['domain_risk']?['components']"
                                  }
                                },
                                "Domain_detailts_Table": {
                                  "runAfter": {
                                    "Append_to_miscellaneous_array_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('domain_details_array')"
                                  }
                                },
                                "For_Each_Email_Domain": {
                                  "foreach": "@items('Results_Loop')['email_domain']",
                                  "actions": {
                                    "Append_to_email_domains_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "email_domains",
                                        "value": "@{items('For_Each_Email_Domain')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_email_domain_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Admin_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['admin_contact']['email']",
                                  "actions": {
                                    "Append_to_admin_contact_email_": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "admin_contact_email",
                                        "value": "@{items('For_each_Admin_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to__Domain_Details_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Billing_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['billing_contact']['email']",
                                  "actions": {
                                    "Append_to_billing_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "billing_contact_email",
                                        "value": "@{items('For_each_Billing_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_admin_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Name_Server": {
                                  "foreach": "@items('Results_Loop')['name_server']",
                                  "actions": {
                                    "Append_to_array_variable": {
                                      "runAfter": {
                                        "Name_Server_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "nameservers",
                                        "value": "@outputs('Name_Server_Compose')"
                                      }
                                    },
                                    "For_each_namer_server_ip": {
                                      "foreach": "@items('For_each_Name_Server')['ip']",
                                      "actions": {
                                        "Append_to_name_server_ips_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "name_server_ips",
                                            "value": "@{items('For_each_namer_server_ip')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_name_server_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "Name_Server_Compose": {
                                      "runAfter": {
                                        "For_each_namer_server_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "Nameserver Domain": "@items('For_each_Name_Server')?['domain']?['value']",
                                        "Nameserver Host": "@items('For_each_Name_Server')?['host']?['value']",
                                        "Nameserver IPs": "@substring(variables('name_server_ips'),0,sub(length(variables('name_server_ips')),1))"
                                      }
                                    },
                                    "Set_name_server_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "name_server_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_mx": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Registrant_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['registrant_contact']['email']",
                                  "actions": {
                                    "Append_to_registrant_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrant_contact_email",
                                        "value": "@{items('For_each_Registrant_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_billing_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SOA_Email": {
                                  "foreach": "@items('Results_Loop')['soa_email']",
                                  "actions": {
                                    "Append_to_soa_email_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "soa_emails",
                                        "value": "@{items('For_each_SOA_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_soa_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SSL_Email": {
                                  "foreach": "@items('Results_Loop')['ssl_email']",
                                  "actions": {
                                    "Append_to_SSL_Email_array_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ssl_emails",
                                        "value": "@{items('For_each_SSL_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Tags": {
                                  "foreach": "@items('Results_Loop')?['tags']",
                                  "actions": {
                                    "Append_to_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "tags",
                                        "value": "@{items('For_each_Tags')?['label']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_adddtional_whois_email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Technical_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['technical_contact']['email']",
                                  "actions": {
                                    "Append_to_technical_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "technical_contact_email",
                                        "value": "@{items('For_each_Technical_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_registrant_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_adddtional_whois_email": {
                                  "foreach": "@items('Results_Loop')['additional_whois_email']",
                                  "actions": {
                                    "Append_toadddtional_whois_email_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "additional_whois_emails",
                                        "value": "@{items('For_each_adddtional_whois_email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_additonal_whois_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ip": {
                                  "foreach": "@items('Results_Loop')['ip']",
                                  "actions": {
                                    "Append_to_ips_array_variable": {
                                      "runAfter": {
                                        "IP_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ips",
                                        "value": "@outputs('IP_Compose')"
                                      }
                                    },
                                    "For_each_IP_Asn": {
                                      "foreach": "@items('For_each_ip')['asn']",
                                      "actions": {
                                        "Append_to_ips_asn_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "ips_asns",
                                            "value": "@{items('For_each_IP_Asn')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_ips_asn_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "IP_Compose": {
                                      "runAfter": {
                                        "For_each_IP_Asn": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "IP ASN": "@substring(variables('ips_asns'),0,sub(length(variables('ips_asns')),1))",
                                        "IP Address": "@items('For_each_ip')?['address']?['value']",
                                        "IP Country Code": "@items('For_each_ip')?['country_code']?['value']",
                                        "IP ISP": "@items('For_each_ip')?['country_code']?['value']"
                                      }
                                    },
                                    "Set_ips_asn_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ips_asns",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_techinical_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_mx": {
                                  "foreach": "@items('Results_Loop')['mx']",
                                  "actions": {
                                    "Append_to_mxs_array_variable": {
                                      "runAfter": {
                                        "MX_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "mxs",
                                        "value": "@outputs('MX_Compose')"
                                      }
                                    },
                                    "For_each_Mx_ip": {
                                      "foreach": "@items('For_each_mx')['ip']",
                                      "actions": {
                                        "Append_to_mx_ips_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "mx_ips",
                                            "value": "@{items('For_each_Mx_ip')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_mx_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "MX_Compose": {
                                      "runAfter": {
                                        "For_each_Mx_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "MX Domain": "@items('For_each_mx')?['domain']?['value']",
                                        "MX Host": "@items('For_each_mx')?['host']?['value']",
                                        "MX IP": "@substring(variables('mx_ips'),0,sub(length(variables('mx_ips')),1))",
                                        "MX Priority": "@items('For_each_mx')?['priority']"
                                      }
                                    },
                                    "Set_mx_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_registrar_status": {
                                  "foreach": "@items('Results_Loop')?['registrar_status']",
                                  "actions": {
                                    "Append_to_registrar_status_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrar_status",
                                        "value": "@{items('For_each_registrar_status')},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Tags_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "IP_Table": {
                                  "runAfter": {
                                    "miscellaneouos_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ips')"
                                  }
                                },
                                "MX_Table": {
                                  "runAfter": {
                                    "IP_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('mxs')"
                                  }
                                },
                                "Miscellaneous_Compose": {
                                  "runAfter": {
                                    "For_each_Tags": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Additional Whois Emails": "@substring(variables('additional_whois_emails'),0,sub(length(variables('additional_whois_emails')),1))",
                                    "Email Domains": "@substring(variables('email_domains'),0,sub(length(variables('email_domains')),1))",
                                    "SOA Emails": "@substring(variables('soa_emails'),0,sub(length(variables('soa_emails')),1))",
                                    "SSL Emails": "@substring(variables('ssl_emails'),0,sub(length(variables('ssl_emails')),1))",
                                    "Tags": "@substring(variables('tags'),0,sub(length(variables('tags')),1))"
                                  }
                                },
                                "Nameserver_Table": {
                                  "runAfter": {
                                    "MX_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('nameservers')"
                                  }
                                },
                                "Registrant_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Registrant_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Registrant Contact City": "@items('Results_Loop')?['registrant_contact']?['city']?['value']",
                                    "Registrant Contact Country": "@items('Results_Loop')?['registrant_contact']?['country']?['value']",
                                    "Registrant Contact Email": "@substring(variables('registrant_contact_email'),0,sub(length(variables('registrant_contact_email')),1))",
                                    "Registrant Contact Fax": "@items('Results_Loop')?['registrant_contact']?['fax']?['value']",
                                    "Registrant Contact Name": "@items('Results_Loop')?['registrant_contact']?['name']?['value']",
                                    "Registrant Contact Org": "@items('Results_Loop')?['registrant_contact']?['org']?['value']",
                                    "Registrant Contact Phone": "@items('Results_Loop')?['registrant_contact']?['phone']?['value']",
                                    "Registrant Contact Postal": "@items('Results_Loop')?['registrant_contact']?['postal']?['value']",
                                    "Registrant Contact State": "@items('Results_Loop')?['registrant_contact']?['state']?['value']",
                                    "Registrant Contact Street": "@items('Results_Loop')?['registrant_contact']?['street']?['value']"
                                  }
                                },
                                "Registrant_Contact_Table": {
                                  "runAfter": {
                                    "Billing_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('registrant_contact_details')"
                                  }
                                },
                                "Set_Admin_Contact_to_Empty": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Billing_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Billing_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Set_Admin_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Domain_Details_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Registrant_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Registrant_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Set_Admin_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Admin_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Tags_to_Empty": {
                                  "runAfter": {
                                    "Set_registrar_status_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "tags",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_ips_variable_to_empty": {
                                  "runAfter": {
                                    "Set_miscellaneous_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ips",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_miscellaneous_to_empty": {
                                  "runAfter": {
                                    "Set_Domain_Details_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_mxs_variable_to_empty": {
                                  "runAfter": {
                                    "Set_ips_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "mxs",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_nameservers_variable_to_empty": {
                                  "runAfter": {
                                    "Set_mxs_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "nameservers",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_registrar_status_to_empty": {
                                  "runAfter": {
                                    "Set_nameservers_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_status",
                                    "value": " "
                                  }
                                },
                                "Technical_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Technical_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Technical Contact City": "@items('Results_Loop')?['technical_contact']?['city']?['value']",
                                    "Technical Contact Country": "@items('Results_Loop')?['technical_contact']?['country']?['value']",
                                    "Technical Contact Email": "@substring(variables('technical_contact_email'),0,sub(length(variables('technical_contact_email')),1))",
                                    "Technical Contact Fax": "@items('Results_Loop')?['technical_contact']?['fax']?['value']",
                                    "Technical Contact Name": "@items('Results_Loop')?['technical_contact']?['name']?['value']",
                                    "Technical Contact Org": "@items('Results_Loop')?['technical_contact']?['org']?['value']",
                                    "Technical Contact Phone": "@items('Results_Loop')?['technical_contact']?['phone']?['value']",
                                    "Technical Contact Postal": "@items('Results_Loop')?['technical_contact']?['postal']?['value']",
                                    "Technical Contact State": "@items('Results_Loop')?['technical_contact']?['state']?['value']",
                                    "Technical Contact Street": "@items('Results_Loop')?['technical_contact']?['street']?['value']"
                                  }
                                },
                                "Technical_Contact_Table": {
                                  "runAfter": {
                                    "Registrant_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('technical_contact_details')"
                                  }
                                },
                                "_Domain_Details_Compose": {
                                  "runAfter": {
                                    "Condition": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Active": "@items('Results_Loop')?['active']",
                                    "Adsense": "@items('Results_Loop')?['adsense']?['value']",
                                    "Alexa": "@items('Results_Loop')?['alexa']",
                                    "Create Date": "@items('Results_Loop')?['create_date']?['value']",
                                    "Data Updated Timestsamap": "@items('Results_Loop')?['data_updated_timestamp']",
                                    "Domain": "@items('Results_Loop')?['domain']",
                                    "Expiration Date": "@items('Results_Loop')?['expiration_date']?['value']",
                                    "Google Analytics": "@items('Results_Loop')?['google_analytics']?['value']",
                                    "Redirect": "@items('Results_Loop')?['redirect']?['value']",
                                    "Redirect Domain": "@items('Results_Loop')?['redirect_domain']?['value']",
                                    "Registrant Name": "@items('Results_Loop')?['registrant_name']?['value']",
                                    "Registrant Org": "@items('Results_Loop')?['registrant_org']?['value']",
                                    "Registrar": "@variables('registrar_value')",
                                    "Registrar Status": "@substring(variables('registrar_status'),0,sub(length(variables('registrar_status')),1))",
                                    "Risk Score": "@items('Results_Loop')?['domain_risk']?['risk_score']",
                                    "SPF Info": "@items('Results_Loop')?['spf_info']",
                                    "TLD": "@items('Results_Loop')?['tld']",
                                    "Website Response": "@items('Results_Loop')?['website_response']",
                                    "Whois URL": "@items('Results_Loop')?['whois_url']"
                                  }
                                },
                                "miscellaneouos_Table": {
                                  "runAfter": {
                                    "Domain_Risk_Score_Components_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('Miscellaneous')"
                                  }
                                },
                                "set_additonal_whois_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SSL_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "additional_whois_emails",
                                    "value": " "
                                  }
                                },
                                "set_email_domain_to_empty": {
                                  "runAfter": {
                                    "For_each_Name_Server": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email_domains",
                                    "value": " "
                                  }
                                },
                                "set_registrar_value": {
                                  "runAfter": {
                                    "For_each_registrar_status": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_value",
                                    "value": "@{items('Results_Loop')?['registrar']}"
                                  }
                                },
                                "set_soa_email_to_empty": {
                                  "runAfter": {
                                    "For_Each_Email_Domain": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "soa_emails",
                                    "value": " "
                                  }
                                },
                                "set_ssl_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SOA_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_emails",
                                    "value": " "
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Enrich_Domain": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p><strong>No results found for: </strong> @{variables('domain_name')}</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Enrich_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Enrich_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisenric']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-enrich/",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each_Host')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each_Host')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Miscellaneous_variable": {
                      "runAfter": {
                        "registrar_status_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Miscellaneous",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "additional_whois_email": {
                      "runAfter": {
                        "ssl_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_details_variable": {
                      "runAfter": {
                        "domain_details_array_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_variable": {
                      "runAfter": {
                        "admin_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_details_variable": {
                      "runAfter": {
                        "admin_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_variable": {
                      "runAfter": {
                        "billing_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "domain_details_array_variable": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_details_array",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "email_domains": {
                      "runAfter": {
                        "technical_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domains",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_asns_": {
                      "runAfter": {
                        "additional_whois_email": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips_asns",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_variable": {
                      "runAfter": {
                        "Miscellaneous_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_ips": {
                      "runAfter": {
                        "ips_asns_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mxs_variable": {
                      "runAfter": {
                        "ips_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mxs",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "name_server_ips": {
                      "runAfter": {
                        "mx_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameservers_variable": {
                      "runAfter": {
                        "mxs_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameservers",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_details_variable": {
                      "runAfter": {
                        "billing_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_variable": {
                      "runAfter": {
                        "registrant_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_status_variable": {
                      "runAfter": {
                        "tags_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_status",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_value": {
                      "runAfter": {
                        "nameservers_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_emails": {
                      "runAfter": {
                        "email_domains": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_emails": {
                      "runAfter": {
                        "soa_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_array": {
                      "runAfter": {
                        "name_server_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "tags_variable": {
                      "runAfter": {
                        "ssl_info_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tags",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_details_variable": {
                      "runAfter": {
                        "registrant_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_variable": {
                      "runAfter": {
                        "technical_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisenric": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisenric')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId2'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId2')]",
                "contentId": "[variables('_playbookContentId2')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion2')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Domain Enrichment - DomainTools Iris Enrich",
            "description": "The DomainTools Iris Enrich API is more suited to high-volume API lookups than Iris Investigate and is able to provide domain infrastructure information for a domain or set of domains associated with an incident.",
            "prerequisites": "A DomainTools API Key provisioned for Iris Enrich. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId2')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Enrich-Domain_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId2')]",
        "id": "[variables('_playbookcontentProductId2')]",
        "version": "[variables('playbookVersion2')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName3')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-Domain_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion3')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-Domain_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Pivot Threshold": {
                      "defaultValue": 500,
                      "type": "Int"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "count_url_link_03": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each_Host": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Check_if_results_exists": {
                          "actions": {
                            "Results_Loop": {
                              "foreach": "@body('Investigate_Domain')?['response']?['results']",
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Technical_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><span style=\"font-size: 16px\"><strong>DomainTools IRIS Investigate response for:</strong></span><span style=\"font-size: 16px\">@{variables('domain_name')}</span><span style=\"font-size: 16px\"></span><br>\n@{replace(replace(replace(body('Domain_detailts_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Domain_Risk_Score_Components_Table') , '&quot;', ''),']','') , '[', '') }@{replace(replace(replace(body('miscellaneouos_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('IP_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('MX_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Nameserver_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('SSL_Info_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Admin_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Billing_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Registrant_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Technical_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}<br>\n<br>\n<br>\nFind more details: https://research.domaintools.com/iris/search/?q=@{variables('domain_name')}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Admin_Contact_Compose": {
                                  "runAfter": {
                                    "Check_admin_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Admin Contact City": "@variables('admin_contact_city_value')",
                                    "Admin Contact Country": "@variables('admin_contact_country_value')",
                                    "Admin Contact Email": "@substring(variables('admin_contact_email'),0,sub(length(variables('admin_contact_email')),1))",
                                    "Admin Contact Fax": "@variables('admin_contact_fax_value')",
                                    "Admin Contact Name": "@variables('admin_contact_name_value')",
                                    "Admin Contact Org": "@variables('admin_contact_org_value')",
                                    "Admin Contact Phone": "@variables('admin_contact_phone_value')",
                                    "Admin Contact Postal": "@variables('admin_contact_postal_value')",
                                    "Admin Contact State": "@variables('admin_contact_state_value')",
                                    "Admin Contact Street": "@variables('admin_contact_street_value')"
                                  }
                                },
                                "Admin_Contact_Table": {
                                  "runAfter": {
                                    "SSL_Info_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('admin_contact_details')"
                                  }
                                },
                                "Append_to__Domain_Details_array": {
                                  "runAfter": {
                                    "_Domain_Details_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "@outputs('_Domain_Details_Compose')"
                                  }
                                },
                                "Append_to_admin_contact_array": {
                                  "runAfter": {
                                    "Admin_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "@outputs('Admin_Contact_Compose')"
                                  }
                                },
                                "Append_to_billing_contact_array": {
                                  "runAfter": {
                                    "Billing_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "@outputs('Billing_Contact_Compose')"
                                  }
                                },
                                "Append_to_miscellaneous_array_variable": {
                                  "runAfter": {
                                    "Miscellaneous_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "@outputs('Miscellaneous_Compose')"
                                  }
                                },
                                "Append_to_registrant_contact_array": {
                                  "runAfter": {
                                    "Registrant_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "@outputs('Registrant_Contact_Compose')"
                                  }
                                },
                                "Append_to_techinical_contact_array": {
                                  "runAfter": {
                                    "Technical_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "@outputs('Technical_Contact_Compose')"
                                  }
                                },
                                "Billing_Contact_Compose": {
                                  "runAfter": {
                                    "Check_billing_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Billing Contact City": "@variables('billing_contact_city_value')",
                                    "Billing Contact Country": "@variables('billing_contact_country_value')",
                                    "Billing Contact Email": "@substring(variables('billing_contact_email'),0,sub(length(variables('billing_contact_email')),1))",
                                    "Billing Contact Fax": "@variables('billing_contact_fax_value')",
                                    "Billing Contact Name": "@variables('billing_contact_name_value')",
                                    "Billing Contact Org": "@variables('billing_contact_org_value')",
                                    "Billing Contact Phone": "@variables('billing_contact_phone_value')",
                                    "Billing Contact Postal": "@variables('billing_contact_postal_value')",
                                    "Billing Contact State": "@variables('billing_contact_state_value')",
                                    "Billing Contact Street": "@variables('billing_contact_street_value')"
                                  }
                                },
                                "Billing_Contact_Table": {
                                  "runAfter": {
                                    "Admin_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('billing_contact_details')"
                                  }
                                },
                                "Check_Adsense_Count": {
                                  "actions": {
                                    "Set_Adsense_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['adsense']?['value'],variables('count_url_end_03')),items('Results_Loop')?['adsense']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_adsense_value_1": {
                                      "runAfter": {
                                        "Set_Adsense_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "adsense_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_count_url_link_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_adsense_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "adsense_value",
                                          "value": "@items('Results_Loop')?['adsense']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['adsense']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['adsense']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Create_Date_Count": {
                                  "actions": {
                                    "Set_Create_Date_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['create_date']?['value'],variables('count_url_end_03')),items('Results_Loop')?['create_date']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Create_Date_value_1": {
                                      "runAfter": {
                                        "Set_Create_Date_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "create_date_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Adsense_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Create_Date_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "create_date_value",
                                          "value": "@items('Results_Loop')?['create_date']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['create_date']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['create_date']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Expiration_Date_Count": {
                                  "actions": {
                                    "Set_Expiration_Date_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['expiration_date']?['value'],variables('count_url_end_03')),items('Results_Loop')?['expiration_date']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Expiration_Date_value_1": {
                                      "runAfter": {
                                        "Set_Expiration_Date_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "expiration_date_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Create_Date_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Expiration_Date_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "expiration_date_value",
                                          "value": "@items('Results_Loop')?['expiration_date']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['expiration_date']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['expiration_date']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Redirect_Count": {
                                  "actions": {
                                    "Set_Redirect_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['redirect']?['value'],variables('count_url_end_03')),items('Results_Loop')?['redirect']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Redirect_value_1": {
                                      "runAfter": {
                                        "Set_Redirect_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "redirect_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Expiration_Date_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Redirect_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "redirect_value",
                                          "value": "@items('Results_Loop')?['redirect']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['redirect']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['redirect']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Redirect_Domain_Count": {
                                  "actions": {
                                    "Set_Redirect_Domain_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['redirect_domain']?['value'],variables('count_url_end_03')),items('Results_Loop')?['redirect_domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Redirect_Domain_value_1": {
                                      "runAfter": {
                                        "Set_Redirect_Domain_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "redirect_domain_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Redirect_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Redirect_Domain_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "redirect_domain_value",
                                          "value": "@items('Results_Loop')?['redirect_domain']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['redirect_domain']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['redirect_domain']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_City_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_city_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Country_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_country_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_fax_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Name_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Registrant_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_name_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Org_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_org_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_phone_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_postal_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_State_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_state_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Street_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_street_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_City_Count": {
                                  "actions": {
                                    "Set_admin_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_city_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Country_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_country_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_fax_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Name_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Admin_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_name_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Org_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_org_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_phone_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_postal_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_State_Count": {
                                  "actions": {
                                    "Set_admin_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_state_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Street_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_street_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_City_Count": {
                                  "actions": {
                                    "Set_billing_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_city_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Country_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_country_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_fax_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Name_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Billing_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_name_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Org_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_org_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_phone_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_postal_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_State_Count": {
                                  "actions": {
                                    "Set_billing_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_state_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Street_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_street_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_registrant_name_Count": {
                                  "actions": {
                                    "Set_registrant_name_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_registrant_name_value_1": {
                                      "runAfter": {
                                        "Set_registrant_name_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Redirect_Domain_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_registrant_name_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_name_value",
                                          "value": "@items('Results_Loop')?['registrant_name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_registrant_org_Count": {
                                  "actions": {
                                    "Set_registrant_org_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_registrant_org_value_1": {
                                      "runAfter": {
                                        "Set_registrant_org_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_registrant_name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_registrant_org_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_org_value",
                                          "value": "@items('Results_Loop')?['registrant_org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_City_Count": {
                                  "actions": {
                                    "Set_technical_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_city_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Country_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_country_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_fax_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Name_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Technical_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_name_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Org_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_org_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_phone_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_postal_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_State_Count": {
                                  "actions": {
                                    "Set_technical_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_state_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Street_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_street_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition": {
                                  "actions": {
                                    "Check_registrar_Count": {
                                      "actions": {
                                        "Set_registrar_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrar']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrar']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_registrar_value_1": {
                                          "runAfter": {
                                            "Set_registrar_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "registrar_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_registrar_value_2": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "registrar_value",
                                              "value": "@items('Results_Loop')?['registrar']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('Results_Loop')?['registrar']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('Results_Loop')?['registrar']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Set_variable_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(variables('registrar_value'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Domain_Risk_Score_Components_Table": {
                                  "runAfter": {
                                    "Domain_detailts_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@items('Results_Loop')?['domain_risk']?['components']"
                                  }
                                },
                                "Domain_detailts_Table": {
                                  "runAfter": {
                                    "Append_to_miscellaneous_array_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('domain_details_array')"
                                  }
                                },
                                "For_Each_Email_Domain": {
                                  "foreach": "@items('Results_Loop')['email_domain']",
                                  "actions": {
                                    "Check_Email_Domain_Count": {
                                      "actions": {
                                        "Append_to_email_domains_variable_1": {
                                          "runAfter": {
                                            "Set_email_domains_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "email_domains",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_email_domains_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_Each_Email_Domain')?['value'],variables('count_url_end_03')),items('For_Each_Email_Domain')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_email_domains_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "email_domains",
                                              "value": "@{items('For_Each_Email_Domain')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_Each_Email_Domain')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_Each_Email_Domain')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_email_domain_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Admin_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['admin_contact']['email']",
                                  "actions": {
                                    "Check_Admin_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_admin_contact_email": {
                                          "runAfter": {
                                            "Set_Admin_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "admin_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Admin_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Admin_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Admin_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_admin_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "admin_contact_email",
                                              "value": "@{items('For_each_Admin_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Admin_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Admin_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to__Domain_Details_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Billing_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['billing_contact']['email']",
                                  "actions": {
                                    "Check_Billing_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_billing_contact_email": {
                                          "runAfter": {
                                            "Set_Billing_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "billing_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Billing_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Billing_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Billing_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_billing_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "billing_contact_email",
                                              "value": "@{items('For_each_Billing_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Billing_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Billing_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_admin_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Name_Server": {
                                  "foreach": "@items('Results_Loop')['name_server']",
                                  "actions": {
                                    "Append_to_array_variable": {
                                      "runAfter": {
                                        "Name_Server_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "nameservers",
                                        "value": "@outputs('Name_Server_Compose')"
                                      }
                                    },
                                    "Check_Nameserver_Domain": {
                                      "actions": {
                                        "Set_Nameserver_Domain_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Name_Server')?['domain']?['value'],variables('count_url_end_03')),items('For_each_Name_Server')?['domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_nameserver_domain_with_link": {
                                          "runAfter": {
                                            "Set_Nameserver_Domain_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "name_server_domain_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_namer_server_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_nameserver_domain_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "name_server_domain_value",
                                              "value": "@items('For_each_Name_Server')?['domain']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Name_Server')?['domain']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Name_Server')?['domain']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_Nameserver_Host": {
                                      "actions": {
                                        "Set_nameserver_host_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Name_Server')?['host']?['value'],variables('count_url_end_03')),items('For_each_Name_Server')?['host']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_namserver_host_with_link": {
                                          "runAfter": {
                                            "Set_nameserver_host_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "name_server_host_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_Nameserver_Domain": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "set_nameserver_host_value_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "name_server_host_value",
                                              "value": "@{items('For_each_Name_Server')?['host']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Name_Server')?['host']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Name_Server')?['host']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_namer_server_ip": {
                                      "foreach": "@items('For_each_Name_Server')['ip']",
                                      "actions": {
                                        "Check_Nameserver_IP_Count": {
                                          "actions": {
                                            "Append_to_name_server_ips_variable_with_link": {
                                              "runAfter": {
                                                "Set_NS_ips_link_3": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToStringVariable",
                                              "inputs": {
                                                "name": "name_server_ip_value",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_NS_ips_link_3": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_namer_server_ip')?['value'],variables('count_url_end_03')),items('For_each_namer_server_ip')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_name_server_ips_variable_without_link": {
                                                "type": "SetVariable",
                                                "inputs": {
                                                  "name": "name_server_ip_value",
                                                  "value": "@{items('For_each_namer_server_ip')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_namer_server_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_namer_server_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_name_server_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "Name_Server_Compose": {
                                      "runAfter": {
                                        "Check_Nameserver_Host": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "Nameserver Domain": "@variables('name_server_domain_value')",
                                        "Nameserver Host": "@variables('name_server_host_value')",
                                        "Nameserver IPs": "@substring(variables('name_server_ip_value'),0,sub(length(variables('name_server_ip_value')),1))"
                                      }
                                    },
                                    "Set_name_server_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "name_server_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_mx": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Registrant_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['registrant_contact']['email']",
                                  "actions": {
                                    "Check_Registrant_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_registrant_contact_email": {
                                          "runAfter": {
                                            "Set_Registrant_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "registrant_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Registrant_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Registrant_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Registrant_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_registrant_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "registrant_contact_email",
                                              "value": "@{items('For_each_Registrant_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Registrant_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Registrant_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_billing_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SOA_Email": {
                                  "foreach": "@items('Results_Loop')['soa_email']",
                                  "actions": {
                                    "Check_SOA_Email_Count": {
                                      "actions": {
                                        "Append_to_soa_email_variable_1": {
                                          "runAfter": {
                                            "Set_soa_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "soa_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_soa_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_SOA_Email')?['value'],variables('count_url_end_03')),items('For_each_SOA_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_soa_email_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "soa_emails",
                                              "value": "@{items('For_each_SOA_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_SOA_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_SOA_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_soa_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SSL_Email": {
                                  "foreach": "@items('Results_Loop')['ssl_email']",
                                  "actions": {
                                    "Check_SSL_Email_Count": {
                                      "actions": {
                                        "Append_to_SSL_Email_array_variable_1": {
                                          "runAfter": {
                                            "Set_ssl_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "ssl_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_ssl_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_SSL_Email')?['value'],variables('count_url_end_03')),items('For_each_SSL_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_SSL_Email_array_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "ssl_emails",
                                              "value": "@{items('For_each_SSL_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_SSL_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_SSL_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Tags": {
                                  "foreach": "@items('Results_Loop')?['tags']",
                                  "actions": {
                                    "Append_to_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "tags",
                                        "value": "@{items('For_each_Tags')?['label']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_adddtional_whois_email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Technical_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['technical_contact']['email']",
                                  "actions": {
                                    "Check_Technical_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_technical_contact_email": {
                                          "runAfter": {
                                            "Set_Technical_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "technical_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Technical_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Technical_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Technical_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_technical_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "technical_contact_email",
                                              "value": "@{items('For_each_Technical_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Technical_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Technical_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_registrant_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_adddtional_whois_email": {
                                  "foreach": "@items('Results_Loop')['additional_whois_email']",
                                  "actions": {
                                    "Check_Additional_Email_Count": {
                                      "actions": {
                                        "Append_toadddtional_whois_email_variable_1": {
                                          "runAfter": {
                                            "Set_Additional_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "additional_whois_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Additional_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_adddtional_whois_email')?['value'],variables('count_url_end_03')),items('For_each_adddtional_whois_email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_toadddtional_whois_email_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "additional_whois_emails",
                                              "value": "@{items('For_each_adddtional_whois_email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_adddtional_whois_email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_adddtional_whois_email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_additonal_whois_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ip": {
                                  "foreach": "@items('Results_Loop')['ip']",
                                  "actions": {
                                    "Append_to_ips_array_variable": {
                                      "runAfter": {
                                        "IP_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ips",
                                        "value": "@outputs('IP_Compose')"
                                      }
                                    },
                                    "Check_IP_Address_Count": {
                                      "actions": {
                                        "Set_IP_address_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_address_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['address']?['value'],variables('count_url_end_03')),items('For_each_ip')?['address']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_IP_Asn": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_address_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_address_value",
                                              "value": "@items('For_each_ip')?['address']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['address']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['address']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_IP_Address_Country_Count": {
                                      "actions": {
                                        "Set_IP_Address_Country_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_country_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_country_code_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_country_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['country_code']?['value'],variables('count_url_end_03')),items('For_each_ip')?['country_code']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_IP_Address_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_Address_Country_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_country_code_value",
                                              "value": "@items('For_each_ip')?['country_code']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['country_code']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['country_code']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_IP_Address_ISP_Count": {
                                      "actions": {
                                        "Set_IP_Address_ISP_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_isp_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_isp_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_isp_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['isp']?['value'],variables('count_url_end_03')),items('For_each_ip')?['isp']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_IP_Address_Country_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_Address_ISP_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_isp_value",
                                              "value": "@items('For_each_ip')?['isp']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['isp']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['isp']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_IP_Asn": {
                                      "foreach": "@items('For_each_ip')['asn']",
                                      "actions": {
                                        "Check_for_IP_ASN_Count": {
                                          "actions": {
                                            "Append_to_ips_asn_variable_1": {
                                              "runAfter": {
                                                "Set_ip_asn_link_03": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToStringVariable",
                                              "inputs": {
                                                "name": "ips_asns",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_ip_asn_link_03": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_IP_Asn')?['value'],variables('count_url_end_03')),items('For_each_IP_Asn')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_ips_asn_variable_2": {
                                                "type": "AppendToStringVariable",
                                                "inputs": {
                                                  "name": "ips_asns",
                                                  "value": "@{items('For_each_IP_Asn')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_IP_Asn')?['count']",
                                                  1
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_IP_Asn')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_ips_asn_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "IP_Compose": {
                                      "runAfter": {
                                        "Check_IP_Address_ISP_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "IP ASN": "@substring(variables('ips_asns'),0,sub(length(variables('ips_asns')),1))",
                                        "IP Address": "@variables('ip_address_value')",
                                        "IP Country Code": "@variables('ip_country_code_value')",
                                        "IP ISP": "@variables('ip_isp_value')"
                                      }
                                    },
                                    "Set_ips_asn_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ips_asns",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_techinical_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_mx": {
                                  "foreach": "@items('Results_Loop')['mx']",
                                  "actions": {
                                    "Append_to_mxs_array_variable": {
                                      "runAfter": {
                                        "MX_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "mxs",
                                        "value": "@outputs('MX_Compose')"
                                      }
                                    },
                                    "Check_MX_Domain_Count": {
                                      "actions": {
                                        "Set_Mx_domain_value_with_link": {
                                          "runAfter": {
                                            "Set_vmx_domain_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "mx_domain_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_vmx_domain_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_mx')?['domain']?['value'],variables('count_url_end_03')),items('For_each_mx')?['domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_Mx_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_Mx_domain_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "mx_domain_value",
                                              "value": "@items('For_each_mx')?['domain']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_mx')?['domain']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_mx')?['domain']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_MX_Host_Count": {
                                      "actions": {
                                        "Set_Mx_host_value_with_link": {
                                          "runAfter": {
                                            "Set_mx_host_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "mx_host_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_mx_host_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_mx')?['host']?['value'],variables('count_url_end_03')),items('For_each_mx')?['host']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_MX_Domain_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_Mx_host_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "mx_host_value",
                                              "value": "@items('For_each_mx')?['host']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_mx')?['host']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_mx')?['host']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_Mx_ip": {
                                      "foreach": "@items('For_each_mx')['ip']",
                                      "actions": {
                                        "Check_MX_IP_Count": {
                                          "actions": {
                                            "Append_to_mx_ips_variable_1": {
                                              "runAfter": {
                                                "Set_mx_ips_link_3": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "mx_ips",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_mx_ips_link_3": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_Mx_ip')?['value'],variables('count_url_end_03')),items('For_each_Mx_ip')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_mx_ips_variable_2": {
                                                "type": "AppendToStringVariable",
                                                "inputs": {
                                                  "name": "mx_ips",
                                                  "value": "@{items('For_each_Mx_ip')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_Mx_ip')?['count']",
                                                  1
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_Mx_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_mx_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "MX_Compose": {
                                      "runAfter": {
                                        "Check_MX_Host_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "MX Domain": "@variables('mx_domain_value')",
                                        "MX Host": "@variables('mx_host_value')",
                                        "MX IP": "@substring(variables('mx_ips'),0,sub(length(variables('mx_ips')),1))",
                                        "MX Priority": "@items('For_each_mx')?['priority']"
                                      }
                                    },
                                    "Set_mx_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_registrar_status": {
                                  "foreach": "@items('Results_Loop')?['registrar_status']",
                                  "actions": {
                                    "Append_to_registrar_status_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrar_status",
                                        "value": "@{items('For_each_registrar_status')},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Tags_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ssl_info": {
                                  "foreach": "@items('Results_Loop')?['ssl_info']",
                                  "actions": {
                                    "Append_to_ssl_info_array_variable": {
                                      "runAfter": {
                                        "SSL_Info_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ssl_info",
                                        "value": "@outputs('SSL_Info_Compose')"
                                      }
                                    },
                                    "Check_Ssl_info_hash_count": {
                                      "actions": {
                                        "Set_ssl_info_hash_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['hash']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['hash']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_ssl_info_hash_value_with_link": {
                                          "runAfter": {
                                            "Set_ssl_info_hash_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_hash_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_info_hash_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_hash_value",
                                              "value": "@{items('For_each_ssl_info')?['hash']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['hash']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['hash']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_ssl_info_org_count": {
                                      "actions": {
                                        "Set_ssl_org_with_count_link": {
                                          "runAfter": {
                                            "Set_ssl_org_with_link": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_organization_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ssl_org_with_link": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['organization']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['organization']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_ssl_info_subject_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_org_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_organization_value",
                                              "value": "@{items('For_each_ssl_info')?['organization']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['organization']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['organization']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_ssl_info_subject_count": {
                                      "actions": {
                                        "Set_ssl_info_subject_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['subject']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['subject']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_ssl_info_subject_with_link": {
                                          "runAfter": {
                                            "Set_ssl_info_subject_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_subject_value",
                                            "value": " @{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_Ssl_info_hash_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_info_subject_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_subject_value",
                                              "value": "@{items('For_each_ssl_info')?['subject']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['subject']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['subject']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "SSL_Info_Compose": {
                                      "runAfter": {
                                        "Check_ssl_info_org_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "SSL Info Hash": "@variables('ssl_info_hash_value')",
                                        "SSL Info Organization": "@variables('ssl_info_organization_value')",
                                        "SSL Info Subject": "@variables('ssl_info_subject_value')"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Name_Server": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "IP_Table": {
                                  "runAfter": {
                                    "miscellaneouos_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ips')"
                                  }
                                },
                                "MX_Table": {
                                  "runAfter": {
                                    "IP_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('mxs')"
                                  }
                                },
                                "Miscellaneous_Compose": {
                                  "runAfter": {
                                    "For_each_Tags": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Additional Whois Emails": "@substring(variables('additional_whois_emails'),0,sub(length(variables('additional_whois_emails')),1))",
                                    "Email Domains": "@substring(variables('email_domains'),0,sub(length(variables('email_domains')),1))",
                                    "SOA Emails": "@substring(variables('soa_emails'),0,sub(length(variables('soa_emails')),1))",
                                    "SSL Emails": "@substring(variables('ssl_emails'),0,sub(length(variables('ssl_emails')),1))",
                                    "Tags": "@substring(variables('tags'),0,sub(length(variables('tags')),1))"
                                  }
                                },
                                "Nameserver_Table": {
                                  "runAfter": {
                                    "MX_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('nameservers')"
                                  }
                                },
                                "Registrant_Contact_Compose": {
                                  "runAfter": {
                                    "Check_Registrant_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Registrant Contact City": "@variables('registrant_contact_city_value')",
                                    "Registrant Contact Country": "@variables('registrant_contact_country_value')",
                                    "Registrant Contact Email": "@substring(variables('registrant_contact_email'),0,sub(length(variables('registrant_contact_email')),1))",
                                    "Registrant Contact Fax": "@variables('registrant_contact_fax_value')",
                                    "Registrant Contact Name": "@variables('registrant_contact_name_value')",
                                    "Registrant Contact Org": "@variables('registrant_contact_org_value')",
                                    "Registrant Contact Phone": "@variables('registrant_contact_phone_value')",
                                    "Registrant Contact Postal": "@variables('registrant_contact_postal_value')",
                                    "Registrant Contact State": "@variables('registrant_contact_state_value')",
                                    "Registrant Contact Street": "@variables('registrant_contact_street_value')"
                                  }
                                },
                                "Registrant_Contact_Table": {
                                  "runAfter": {
                                    "Billing_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('registrant_contact_details')"
                                  }
                                },
                                "SSL_Info_Table": {
                                  "runAfter": {
                                    "Nameserver_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ssl_info')"
                                  }
                                },
                                "Set_Admin_Contact_to_Empty": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Billing_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Billing_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Set_Admin_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Domain_Details_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Registrant_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Registrant_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Set_Admin_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_count_url_link_3_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Tags_to_Empty": {
                                  "runAfter": {
                                    "Set_registrar_status_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "tags",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_count_url_link_1": {
                                  "runAfter": {
                                    "For_each_registrar_status": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_01",
                                    "value": "@{concat(variables('count_url_01'),variables('domain_name'))}"
                                  }
                                },
                                "Set_count_url_link_1_to_empty": {
                                  "runAfter": {
                                    "Set_Admin_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_01",
                                    "value": " "
                                  }
                                },
                                "Set_count_url_link_2": {
                                  "runAfter": {
                                    "Set_count_url_link_1": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_02",
                                    "value": "@{concat(variables('count_url_link_01'),variables('count_url_end_01'))}"
                                  }
                                },
                                "Set_count_url_link_3_to_empty": {
                                  "runAfter": {
                                    "Set_count_url_link_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_03",
                                    "value": " "
                                  }
                                },
                                "Set_count_url_link_to_empty": {
                                  "runAfter": {
                                    "Set_count_url_link_1_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_02",
                                    "value": " "
                                  }
                                },
                                "Set_ips_variable_to_empty": {
                                  "runAfter": {
                                    "Set_miscellaneous_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ips",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_miscellaneous_to_empty": {
                                  "runAfter": {
                                    "Set_Domain_Details_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_mxs_variable_to_empty": {
                                  "runAfter": {
                                    "Set_ips_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "mxs",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_nameservers_variable_to_empty": {
                                  "runAfter": {
                                    "Set_mxs_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "nameservers",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_registrar_status_to_empty": {
                                  "runAfter": {
                                    "Set_ssl_info_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_status",
                                    "value": " "
                                  }
                                },
                                "Set_ssl_info_variable_to_empty": {
                                  "runAfter": {
                                    "Set_nameservers_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_info",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_variable_2": {
                                  "runAfter": {
                                    "Check_registrant_org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_value",
                                    "value": "@{items('Results_Loop')?['registrar']}"
                                  }
                                },
                                "Technical_Contact_Compose": {
                                  "runAfter": {
                                    "Check_technical_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Technical Contact City": "@variables('technical_contact_city_value')",
                                    "Technical Contact Country": "@variables('technical_contact_country_value')",
                                    "Technical Contact Email": "@substring(variables('technical_contact_email'),0,sub(length(variables('technical_contact_email')),1))",
                                    "Technical Contact Fax": "@variables('technical_contact_fax_value')",
                                    "Technical Contact Name": "@variables('technical_contact_name_value')",
                                    "Technical Contact Org": "@variables('technical_contact_org_value')",
                                    "Technical Contact Phone": "@variables('technical_contact_phone_value')",
                                    "Technical Contact Postal": "@variables('technical_contact_postal_value')",
                                    "Technical Contact State": "@variables('technical_contact_state_value')",
                                    "Technical Contact Street": "@variables('technical_contact_street_value')"
                                  }
                                },
                                "Technical_Contact_Table": {
                                  "runAfter": {
                                    "Registrant_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('technical_contact_details')"
                                  }
                                },
                                "_Domain_Details_Compose": {
                                  "runAfter": {
                                    "Condition": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Active": "@items('Results_Loop')?['active']",
                                    "Adsense": "@variables('adsense_value')",
                                    "Alexa": "@items('Results_Loop')?['alexa']",
                                    "Create Date": "@variables('create_date_value')",
                                    "Data Updated Timestsamap": "@items('Results_Loop')?['data_updated_timestamp']",
                                    "Domain": "@items('Results_Loop')?['domain']",
                                    "Expiration Date": "@variables('expiration_date_value')",
                                    "Google Analytics": "@items('Results_Loop')?['google_analytics']?['value']",
                                    "Redirect": "@variables('redirect_value')",
                                    "Redirect Domain": "@variables('redirect_domain_value')",
                                    "Registrant Name": "@variables('registrant_name_value')",
                                    "Registrant Org": "@variables('registrant_org_value')",
                                    "Registrar": "@variables('registrar_value')",
                                    "Registrar Status": "@substring(variables('registrar_status'),0,sub(length(variables('registrar_status')),1))",
                                    "Risk Score": "@items('Results_Loop')?['domain_risk']?['risk_score']",
                                    "SPF Info": "@items('Results_Loop')?['spf_info']",
                                    "TLD": "@items('Results_Loop')?['tld']",
                                    "Website Response": "@items('Results_Loop')?['website_response']",
                                    "Whois URL": "@items('Results_Loop')?['whois_url']"
                                  }
                                },
                                "miscellaneouos_Table": {
                                  "runAfter": {
                                    "Domain_Risk_Score_Components_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('Miscellaneous')"
                                  }
                                },
                                "set_additonal_whois_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SSL_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "additional_whois_emails",
                                    "value": " "
                                  }
                                },
                                "set_email_domain_to_empty": {
                                  "runAfter": {
                                    "For_each_ssl_info": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email_domains",
                                    "value": " "
                                  }
                                },
                                "set_soa_email_to_empty": {
                                  "runAfter": {
                                    "For_Each_Email_Domain": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "soa_emails",
                                    "value": " "
                                  }
                                },
                                "set_ssl_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SOA_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_emails",
                                    "value": " "
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p><strong>No results found for:</strong> @{variables('domain_name')}</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Investigate_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each_Host')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each_Host')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "runAfter": {
                        "MAX_COUNT_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "MAX_COUNT_": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "max_count",
                            "type": "integer",
                            "value": "@parameters('Pivot Threshold')"
                          }
                        ]
                      }
                    },
                    "Miscellaneous_variable": {
                      "runAfter": {
                        "registrar_status_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Miscellaneous",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "additional_whois_email": {
                      "runAfter": {
                        "ssl_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "additional_whois_email_value": {
                      "runAfter": {
                        "ssl_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_city_value": {
                      "runAfter": {
                        "admin_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_country_value": {
                      "runAfter": {
                        "admin_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_details_variable": {
                      "runAfter": {
                        "domain_details_array_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_value": {
                      "runAfter": {
                        "admin_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_variable": {
                      "runAfter": {
                        "admin_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_fax_value": {
                      "runAfter": {
                        "admin_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_name_value": {
                      "runAfter": {
                        "google_analytics_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_org_value": {
                      "runAfter": {
                        "admin_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_phone_value": {
                      "runAfter": {
                        "admin_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_postal_value": {
                      "runAfter": {
                        "admin_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_state_value": {
                      "runAfter": {
                        "admin_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_street_value": {
                      "runAfter": {
                        "admin_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "adsense_value": {
                      "runAfter": {
                        "nameservers_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adsense_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_city_value": {
                      "runAfter": {
                        "billing_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_country_value": {
                      "runAfter": {
                        "billing_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_details_variable": {
                      "runAfter": {
                        "admin_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_value": {
                      "runAfter": {
                        "billing_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_variable": {
                      "runAfter": {
                        "billing_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_fax_value": {
                      "runAfter": {
                        "billing_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_name_value": {
                      "runAfter": {
                        "admin_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_org_value": {
                      "runAfter": {
                        "billing_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_phone_value": {
                      "runAfter": {
                        "billing_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_postal_value": {
                      "runAfter": {
                        "billing_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_state_value": {
                      "runAfter": {
                        "billing_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_street_value": {
                      "runAfter": {
                        "billing_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_01": {
                      "runAfter": {
                        "ssl_info_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_01",
                            "type": "string",
                            "value": "<a href=https://research.domaintools.com/iris/search/?q="
                          }
                        ]
                      }
                    },
                    "count_url_end_01": {
                      "runAfter": {
                        "count_url_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_01",
                            "type": "string",
                            "value": ">"
                          }
                        ]
                      }
                    },
                    "count_url_end_02": {
                      "runAfter": {
                        "count_url_end_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_02",
                            "type": "string",
                            "value": "</a>"
                          }
                        ]
                      }
                    },
                    "count_url_end_03": {
                      "runAfter": {
                        "count_url_end_02": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_03",
                            "type": "string",
                            "value": "("
                          }
                        ]
                      }
                    },
                    "count_url_end_04": {
                      "runAfter": {
                        "count_url_end_03": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_04",
                            "type": "string",
                            "value": ")"
                          }
                        ]
                      }
                    },
                    "count_url_link_01": {
                      "runAfter": {
                        "count_url_end_04": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_01",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_link_02": {
                      "runAfter": {
                        "count_url_link_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_02",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_link_03": {
                      "runAfter": {
                        "count_url_link_02": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_03",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "create_date_value": {
                      "runAfter": {
                        "technical_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "create_date_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "domain_details_array_variable": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_details_array",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "email_domain_value": {
                      "runAfter": {
                        "expiration_date_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "email_domains": {
                      "runAfter": {
                        "technical_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domains",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "expiration_date_value": {
                      "runAfter": {
                        "create_date_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "expiration_date_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "google_analytics_value": {
                      "runAfter": {
                        "adsense_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "google_analytics_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_address_value": {
                      "runAfter": {
                        "additional_whois_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_asn_value": {
                      "runAfter": {
                        "ip_address_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_asn_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_country_code_value": {
                      "runAfter": {
                        "ip_asn_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_country_code_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_isp_value": {
                      "runAfter": {
                        "ip_country_code_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_isp_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_asns_": {
                      "runAfter": {
                        "additional_whois_email": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips_asns",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_variable": {
                      "runAfter": {
                        "Miscellaneous_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_domain_value": {
                      "runAfter": {
                        "mx_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_host_value": {
                      "runAfter": {
                        "ip_isp_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_ip_count": {
                      "runAfter": {
                        "mx_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "mx_ip_value": {
                      "runAfter": {
                        "mx_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_ips": {
                      "runAfter": {
                        "ips_asns_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mxs_variable": {
                      "runAfter": {
                        "ips_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mxs",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "name_server_domain_value": {
                      "runAfter": {
                        "name_server_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_host_value": {
                      "runAfter": {
                        "mx_ip_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_ip_value": {
                      "runAfter": {
                        "name_server_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_ips": {
                      "runAfter": {
                        "mx_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameservers_variable": {
                      "runAfter": {
                        "mxs_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameservers",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "redirect_domain_value": {
                      "runAfter": {
                        "redirect_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "redirect_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "redirect_value": {
                      "runAfter": {
                        "name_server_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "redirect_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_city_value": {
                      "runAfter": {
                        "registrant_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_country_value": {
                      "runAfter": {
                        "registrant_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_details_variable": {
                      "runAfter": {
                        "billing_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_value": {
                      "runAfter": {
                        "registrant_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_variable": {
                      "runAfter": {
                        "registrant_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_fax_value": {
                      "runAfter": {
                        "registrant_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_name_value": {
                      "runAfter": {
                        "billing_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_org_value": {
                      "runAfter": {
                        "registrant_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_phone_value": {
                      "runAfter": {
                        "registrant_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_postal_value": {
                      "runAfter": {
                        "registrant_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_state_value": {
                      "runAfter": {
                        "registrant_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_street_value": {
                      "runAfter": {
                        "registrant_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_name_value": {
                      "runAfter": {
                        "redirect_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_org_value": {
                      "runAfter": {
                        "registrant_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_status_variable": {
                      "runAfter": {
                        "tags_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_status",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_value": {
                      "runAfter": {
                        "registrant_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_email_value": {
                      "runAfter": {
                        "email_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_emails": {
                      "runAfter": {
                        "email_domains": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_email_value": {
                      "runAfter": {
                        "soa_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_emails": {
                      "runAfter": {
                        "soa_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_array": {
                      "runAfter": {
                        "name_server_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "ssl_info_email_value": {
                      "runAfter": {
                        "ssl_info_organization_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_value": {
                      "runAfter": {
                        "registrar_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_organization_value": {
                      "runAfter": {
                        "ssl_info_subject_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_organization_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_subject_value": {
                      "runAfter": {
                        "ssl_info_hash_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_subject_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "tags_variable": {
                      "runAfter": {
                        "ssl_info_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tags",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_city_value": {
                      "runAfter": {
                        "technical_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_country_value": {
                      "runAfter": {
                        "technical_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_details_variable": {
                      "runAfter": {
                        "registrant_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_value": {
                      "runAfter": {
                        "technical_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_variable": {
                      "runAfter": {
                        "technical_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_fax_value": {
                      "runAfter": {
                        "technical_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_name_value": {
                      "runAfter": {
                        "registrant_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_org_value": {
                      "runAfter": {
                        "technical_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_phone_value": {
                      "runAfter": {
                        "technical_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_postal_value": {
                      "runAfter": {
                        "technical_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_state_value": {
                      "runAfter": {
                        "technical_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_street_value": {
                      "runAfter": {
                        "technical_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId3'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId3')]",
                "contentId": "[variables('_playbookContentId3')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion3')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Domain Enrichment - DomainTools Iris Investigate",
            "description": "Given a domain or set of domains associated with an incident return all Iris Investigate data for those domains as comments in the incident.",
            "prerequisites": "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId3')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-Domain_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId3')]",
        "id": "[variables('_playbookcontentProductId3')]",
        "version": "[variables('playbookVersion3')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName4')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion4')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "High": {
                      "defaultValue": 100,
                      "type": "Int"
                    },
                    "Informational": {
                      "defaultValue": 49,
                      "type": "Int"
                    },
                    "Low": {
                      "defaultValue": 69,
                      "type": "Int"
                    },
                    "Medium": {
                      "defaultValue": 89,
                      "type": "Int"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Risk_Score_Variable": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_risk_score",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "incident_assigned_severity_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Check_if_results_exists": {
                          "actions": {
                            "Loop_through_the_results_object": {
                              "foreach": "@body('Investigate_Domain')?['response']?['results']",
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Domain_Risk_Score_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><span style=\"font-size: 16px\"><strong>DomainTools Risk Score details for: </strong></span><span style=\"font-size: 16px\">@{variables('domain_name')}</span><span style=\"font-size: 16px\"> : </span><span style=\"font-size: 16px\">@{variables('domain_risk_score')}</span><span style=\"font-size: 16px\"><br>\nDomain Risk Components: </span><span style=\"font-size: 16px\">@{replace(replace(replace(body('Domain_Risk_Score_Table') , '&quot;', ''),']','') , '[', '') }</span><span style=\"font-size: 16px\"></span><br>\n<br>\nFind more details: https://research.domaintools.com/iris/search/?q=@{variables('domain_name')}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Domain_Risk_Score_Table": {
                                  "runAfter": {
                                    "Severity_Condition": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@items('Loop_through_the_results_object')?['domain_risk']?['components']"
                                  }
                                },
                                "Set_Domain_Risk_Score": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "domain_risk_score",
                                    "value": "@items('Loop_through_the_results_object')?['domain_risk']?['risk_score']"
                                  }
                                },
                                "Severity_Condition": {
                                  "actions": {
                                    "Add_Informational_to_Array": {
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "Incident_severity",
                                        "value": "@variables('severity_informational_text')"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Domain_Risk_Score": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Severity_low": {
                                        "actions": {
                                          "Add_Low_to_Array": {
                                            "type": "AppendToArrayVariable",
                                            "inputs": {
                                              "name": "Incident_severity",
                                              "value": "@variables('severity_low_text')"
                                            }
                                          }
                                        },
                                        "else": {
                                          "actions": {
                                            "Severity_medium": {
                                              "actions": {
                                                "Add_Medium_to_Array": {
                                                  "type": "AppendToArrayVariable",
                                                  "inputs": {
                                                    "name": "Incident_severity",
                                                    "value": "@variables('severity_medium_text')"
                                                  }
                                                }
                                              },
                                              "else": {
                                                "actions": {
                                                  "Severity_high": {
                                                    "actions": {
                                                      "Add_High_to_Array": {
                                                        "type": "AppendToArrayVariable",
                                                        "inputs": {
                                                          "name": "Incident_severity",
                                                          "value": "@variables('severity_high_text')"
                                                        }
                                                      }
                                                    },
                                                    "expression": {
                                                      "and": [
                                                        {
                                                          "greater": [
                                                            "@variables('domain_risk_score')",
                                                            "@variables('severity_medium')"
                                                          ]
                                                        },
                                                        {
                                                          "lessOrEquals": [
                                                            "@variables('domain_risk_score')",
                                                            "@variables('severity_high')"
                                                          ]
                                                        }
                                                      ]
                                                    },
                                                    "type": "If"
                                                  }
                                                }
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "greater": [
                                                      "@variables('domain_risk_score')",
                                                      "@variables('severity_low')"
                                                    ]
                                                  },
                                                  {
                                                    "lessOrEquals": [
                                                      "@variables('domain_risk_score')",
                                                      "@variables('severity_medium')"
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            }
                                          }
                                        },
                                        "expression": {
                                          "and": [
                                            {
                                              "greater": [
                                                "@variables('domain_risk_score')",
                                                "@variables('severity_informational')"
                                              ]
                                            },
                                            {
                                              "lessOrEquals": [
                                                "@variables('domain_risk_score')",
                                                "@variables('severity_low')"
                                              ]
                                            }
                                          ]
                                        },
                                        "type": "If"
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "lessOrEquals": [
                                          "@variables('domain_risk_score')",
                                          "@variables('severity_informational')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p><strong>No results found for: </strong>@{variables('domain_name')}</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Investigate_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Incident_Severity_Array": {
                      "runAfter": {
                        "Domain_Risk_Score_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Incident_severity",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "Incident_Severity_Check": {
                      "actions": {
                        "Check_High": {
                          "actions": {
                            "Set_high_severity_to_incident": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "incident_assigned_severity_value",
                                "value": "@variables('severity_high_text')"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_Unique_Incident_Severity": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Check_Medium": {
                                "actions": {
                                  "Set_medium_severity_to_incident": {
                                    "type": "SetVariable",
                                    "inputs": {
                                      "name": "incident_assigned_severity_value",
                                      "value": "@variables('severity_medium_text')"
                                    }
                                  }
                                },
                                "else": {
                                  "actions": {
                                    "Check_Low": {
                                      "actions": {
                                        "Set_low_severity_to_incident": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "incident_assigned_severity_value",
                                            "value": "@variables('severity_low_text')"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Check_Informational": {
                                            "actions": {
                                              "Set_informational_severity_to_incident": {
                                                "type": "SetVariable",
                                                "inputs": {
                                                  "name": "incident_assigned_severity_value",
                                                  "value": "@variables('severity_informational_text')"
                                                }
                                              }
                                            },
                                            "expression": {
                                              "and": [
                                                {
                                                  "contains": [
                                                    "@variables('Incident_severity_unique')",
                                                    "@variables('severity_informational_text')"
                                                  ]
                                                }
                                              ]
                                            },
                                            "type": "If"
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "contains": [
                                              "@variables('Incident_severity_unique')",
                                              "@variables('severity_low_text')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  }
                                },
                                "expression": {
                                  "and": [
                                    {
                                      "contains": [
                                        "@variables('Incident_severity_unique')",
                                        "@variables('severity_medium_text')"
                                      ]
                                    }
                                  ]
                                },
                                "type": "If"
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "contains": [
                                  "@variables('Incident_severity_unique')",
                                  "@variables('severity_high')"
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Set_Unique_Incident_Severity": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "Incident_severity_unique",
                            "value": "@union(variables('Incident_severity'),variables('Incident_severity'))"
                          }
                        },
                        "Update_incident": {
                          "runAfter": {
                            "Check_High": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "severity": "@variables('incident_assigned_severity_value')"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "put",
                            "path": "/Incidents"
                          }
                        }
                      },
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('Incident_severity'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "Incident_Severity_Unique_Array": {
                      "runAfter": {
                        "Incident_Severity_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Incident_severity_unique",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "incident_assigned_severity_value": {
                      "runAfter": {
                        "severity_high_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "incident_assigned_severity_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "severity_high_threshold_value": {
                      "runAfter": {
                        "severity_medium_threshold_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_high",
                            "type": "integer",
                            "value": "@parameters('High')"
                          }
                        ]
                      }
                    },
                    "severity_high_value": {
                      "runAfter": {
                        "severity_medium_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_high_text",
                            "type": "string",
                            "value": "High"
                          }
                        ]
                      }
                    },
                    "severity_informational_threshold_value": {
                      "runAfter": {
                        "Incident_Severity_Unique_Array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_informational",
                            "type": "integer",
                            "value": "@parameters('Informational')"
                          }
                        ]
                      }
                    },
                    "severity_informational_value": {
                      "runAfter": {
                        "severity_high_threshold_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_informational_text",
                            "type": "string",
                            "value": "Informational"
                          }
                        ]
                      }
                    },
                    "severity_low_threshold_value": {
                      "runAfter": {
                        "severity_informational_threshold_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_low",
                            "type": "integer",
                            "value": "@parameters('Low')"
                          }
                        ]
                      }
                    },
                    "severity_low_value": {
                      "runAfter": {
                        "severity_informational_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_low_text",
                            "type": "string",
                            "value": "Low"
                          }
                        ]
                      }
                    },
                    "severity_medium_threshold_value": {
                      "runAfter": {
                        "severity_low_threshold_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_medium",
                            "type": "integer",
                            "value": "@parameters('Medium')"
                          }
                        ]
                      }
                    },
                    "severity_medium_value": {
                      "runAfter": {
                        "severity_low_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "severity_medium_text",
                            "type": "string",
                            "value": "Medium"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId4'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId4')]",
                "contentId": "[variables('_playbookContentId4')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion4')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Domain Risk Score - DomainTools Iris Investigate",
            "description": "Given a domain or set of domains associated with an incident return the risk scores and adjust the severity of the incident if a high risk domain is observed, adding the risk details in the comments of the incident.",
            "prerequisites": "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId4')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId4')]",
        "id": "[variables('_playbookcontentProductId4')]",
        "version": "[variables('playbookVersion4')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName5')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-Guided_Pivots_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion5')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-Guided_Pivots_Playbook",
              "type": "string"
            },
            "IrisInvestigateAPIUsername": {
              "type": "securestring",
              "metadata": {
                "description": "Enter Iris Investigate API Username."
              }
            },
            "IrisInvestigateAPIKey": {
              "type": "securestring",
              "metadata": {
                "description": "Enter Iris Investigate API Key."
              }
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[variables('DomainToolsApiKey')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "IrisInvestigateAPIKey": {
                      "defaultValue": "[[parameters('IrisInvestigateAPIKey')]",
                      "type": "SecureString"
                    },
                    "IrisInvestigateAPIUsername": {
                      "defaultValue": "[[parameters('IrisInvestigateAPIUsername')]",
                      "type": "SecureString"
                    },
                    "max_email_domain_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_ip_address_count": {
                      "defaultValue": 150,
                      "type": "Int"
                    },
                    "max_mx_host_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_mx_ip_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_name_server_host_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_name_server_ip_count": {
                      "defaultValue": 250,
                      "type": "Int"
                    },
                    "max_registrant_name_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_registrant_org_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_soa_email_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_ssl_email_count": {
                      "defaultValue": 200,
                      "type": "Int"
                    },
                    "max_ssl_info_hash_count": {
                      "defaultValue": 350,
                      "type": "Int"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "soa_email_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each_Host_": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Email_Domain_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_email_domain": {
                              "foreach": "@items('Email_Domain_Details')['email_domain']",
                              "actions": {
                                "Check_Max_Email_Domain_Count": {
                                  "actions": {
                                    "Reverse_Email_Domain": {
                                      "runAfter": {
                                        "set_email_domain_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/email-domain",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "email_domain": "@variables('email_domain_value')"
                                        }
                                      }
                                    },
                                    "check_limit_exceeded_for_reverse_email": {
                                      "actions": {
                                        "Email_Domain_Comment": {
                                          "runAfter": {
                                            "Email_Domain_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Email Domain: </strong></span>@{variables('email_domain_value')}<br>\n<strong>Average Risk Score: &nbsp;</strong><strong>@{div(variables('email_domain_domain_risk'),variables('email_domain_domain_risk_count'))}</strong><strong></strong><br>\n@{body('Email_Domain_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        },
                                        "Email_Domain_Table": {
                                          "runAfter": {
                                            "For_each_reverse_email_domain": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('email_domain_domain_details')"
                                          }
                                        },
                                        "For_each_reverse_email_domain": {
                                          "foreach": "@body('Reverse_Email_Domain')?['response']?['results']",
                                          "actions": {
                                            "Append_to_email_domain_domain_details": {
                                              "runAfter": {
                                                "Email_Domain_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "email_domain_domain_details",
                                                "value": "@outputs('Email_Domain_Compose')"
                                              }
                                            },
                                            "Check_if_email_domain_domain_risk_is_null": {
                                              "actions": {
                                                "set_email_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "email_domain_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_email_domain_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_reverse_email_domain')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_reverse_email_domain')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Email_Domain_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_reverse_email_domain')?['domain']",
                                                "Risk Score": "@items('For_each_reverse_email_domain')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "set_email_domain_domain_risk": {
                                              "runAfter": {
                                                "Append_to_email_domain_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "email_domain_domain_risk",
                                                "value": "@items('For_each_reverse_email_domain')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        }
                                      },
                                      "runAfter": {
                                        "Reverse_Email_Domain": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Email_Domain_Comment_Limit_Exceeded": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Email Domain: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Reverse_Email_Domain')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Reverse_Email_Domain')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_email_domain_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "email_domain_value",
                                        "value": "@items('For_each_email_domain')?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_email_domain_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('email_domain_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('email_domain_count')",
                                          "@parameters('max_email_domain_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_email_domain_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email_domain_count",
                                    "value": "@items('For_each_email_domain')?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "IP_Address_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_IP": {
                              "foreach": "@items('IP_Address_Details')['ip']",
                              "actions": {
                                "Check_Max_IP_Address_Count": {
                                  "actions": {
                                    "Check_Reverse_IP_Limit_Exceeded": {
                                      "actions": {
                                        "Create_IP_Address_Table": {
                                          "runAfter": {
                                            "For_each_reverse_ip_results": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('ip_address_domain_details')"
                                          }
                                        },
                                        "For_each_reverse_ip_results": {
                                          "foreach": "@body('Reverse_IP')?['response']?['results']",
                                          "actions": {
                                            "Append_to_ip_address_domain_details": {
                                              "runAfter": {
                                                "Reverse_IP_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "ip_address_domain_details",
                                                "value": "@outputs('Reverse_IP_Compose')"
                                              }
                                            },
                                            "Check_if_the_ip_address_riskscore_is_null": {
                                              "actions": {
                                                "set_ip_address_risk_score_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "ip_address_risk_score_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_ip_address_overall_risk_score": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_reverse_ip_results')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_reverse_ip_results')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Reverse_IP_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_reverse_ip_results')?['domain']",
                                                "Risk Score": "@items('For_each_reverse_ip_results')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "set_ip_address_overall_risk_score": {
                                              "runAfter": {
                                                "Append_to_ip_address_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "ip_address_risk_score",
                                                "value": "@items('For_each_reverse_ip_results')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "Reverse_IP_Comment": {
                                          "runAfter": {
                                            "Create_IP_Address_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> IP Address: </strong></span>@{variables('ip_address_value')}<br>\n<strong>Average Risk Score: &nbsp;</strong>@{div(variables('ip_address_risk_score'),variables('ip_address_risk_score_count'))}<br>\n@{body('Create_IP_Address_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Reverse_IP": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Reverse_IP_Limit_Exceeded_Comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> IP Address: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Reverse_IP')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Reverse_IP')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Reverse_IP": {
                                      "runAfter": {
                                        "set_ip_address_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/reverse-ip/",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "ip": "@variables('ip_address_value')"
                                        }
                                      }
                                    },
                                    "set_ip_address_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ip_address_value",
                                        "value": "@items('For_each_IP')?['address']?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_ip_address_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('ip_address_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('ip_address_count')",
                                          "@parameters('max_ip_address_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_ip_address_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ip_address_count",
                                    "value": "@items('For_each_IP')?['address']?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "MX_Host_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_mx2": {
                              "foreach": "@items('MX_Host_Details')['mx']",
                              "actions": {
                                "Check_Max_Mx_Host_Count": {
                                  "actions": {
                                    "Check_Pivot_MX_Host_Limit_Exceeded": {
                                      "actions": {
                                        "For_each_pivot_mx_host": {
                                          "foreach": "@body('Pivot_MX_Host')?['response']?['results']",
                                          "actions": {
                                            "Append_to_mx_host_domain_details": {
                                              "runAfter": {
                                                "MX_host_compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "mx_hostl_domain_details",
                                                "value": "@outputs('MX_host_compose')"
                                              }
                                            },
                                            "MX_host_compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_pivot_mx_host')?['domain']",
                                                "Risk Score": "@items('For_each_pivot_mx_host')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "check_if_host_domain_risk_score_is_null": {
                                              "actions": {
                                                "set_mx_host_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "mx_host_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_host_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_pivot_mx_host')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_pivot_mx_host')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "set_host_domain_risk": {
                                              "runAfter": {
                                                "Append_to_mx_host_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "mx_host_domain_risk",
                                                "value": "@items('For_each_pivot_mx_host')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "MX_Host_Table": {
                                          "runAfter": {
                                            "For_each_pivot_mx_host": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('mx_hostl_domain_details')"
                                          }
                                        },
                                        "Pivot_MX_Host_Comment": {
                                          "runAfter": {
                                            "MX_Host_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;MX Host: </strong></span>@{variables('mx_host_value')}<br>\n<strong>Average Risk Score: </strong>&nbsp;@{div(variables('mx_host_domain_risk'),variables('mx_host_domain_risk_count'))}<br>\n@{body('MX_Host_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Pivot_MX_Host": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Pivot_MX_Host_Limit_Exceeded_Comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;MX Host: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_MX_Host')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Pivot_MX_Host')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Pivot_MX_Host": {
                                      "runAfter": {
                                        "Set_mx_host_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/mailserver-host/",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "mailserver_host": "@variables('mx_host_value')"
                                        }
                                      }
                                    },
                                    "Set_mx_host_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_host_value",
                                        "value": "@items('For_each_mx2')?['host']?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_mx_host_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('mx_host_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('mx_host_count')",
                                          "@parameters('max_mx_host_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Set_mx_host_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "mx_host_count",
                                    "value": "@items('For_each_mx2')?['host']?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "MX_IP_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_mx": {
                              "foreach": "@items('MX_IP_Details')['mx']",
                              "actions": {
                                "For_each_mx_ip": {
                                  "foreach": "@items('For_each_mx')['ip']",
                                  "actions": {
                                    "Check_Max_IP_": {
                                      "actions": {
                                        "Check_MX_IP_Limit_Exceeded": {
                                          "actions": {
                                            "For_each_MX_IP_results": {
                                              "foreach": "@body('Pivot_by_MX_IP')?['response']?['results']",
                                              "actions": {
                                                "Append_to_mx_ip_domain_details": {
                                                  "runAfter": {
                                                    "MX_IP_Compose": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "type": "AppendToArrayVariable",
                                                  "inputs": {
                                                    "name": "mx_ip_domain_details",
                                                    "value": "@outputs('MX_IP_Compose')"
                                                  }
                                                },
                                                "MX_IP_Compose": {
                                                  "type": "Compose",
                                                  "inputs": {
                                                    "Domain": "@items('For_each_MX_IP_results')?['domain']",
                                                    "Risk Score": "@items('For_each_MX_IP_results')?['domain_risk']?['risk_score']"
                                                  }
                                                },
                                                "check_mx_ip_risk_score_is_null": {
                                                  "actions": {
                                                    "set_mx_ip_risk_score_count": {
                                                      "type": "IncrementVariable",
                                                      "inputs": {
                                                        "name": "mx_ip_risk_score_count",
                                                        "value": 1
                                                      }
                                                    }
                                                  },
                                                  "runAfter": {
                                                    "set_mx_ip_risk_score": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "expression": {
                                                    "and": [
                                                      {
                                                        "not": {
                                                          "equals": [
                                                            "@items('For_each_MX_IP_results')?['domain_risk']?['risk_score']",
                                                            "@null"
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "greater": [
                                                          "@items('For_each_MX_IP_results')?['domain_risk']?['risk_score']",
                                                          0
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  "type": "If"
                                                },
                                                "set_mx_ip_risk_score": {
                                                  "runAfter": {
                                                    "Append_to_mx_ip_domain_details": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "mx_ip_risk_score",
                                                    "value": "@items('For_each_MX_IP_results')?['domain_risk']?['risk_score']"
                                                  }
                                                }
                                              },
                                              "type": "Foreach"
                                            },
                                            "MX_IP_Comment": {
                                              "runAfter": {
                                                "MX_IP_table": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "ApiConnection",
                                              "inputs": {
                                                "body": {
                                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                                  "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> MX IP Address: </strong></span>@{variables('mx_ip_value')}<br>\n<strong>Average Risk Score:</strong> &nbsp;@{div(variables('mx_ip_risk_score'),variables('mx_ip_risk_score_count'))}<br>\n@{body('MX_IP_table')}</p>"
                                                },
                                                "host": {
                                                  "connection": {
                                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                  }
                                                },
                                                "method": "post",
                                                "path": "/Incidents/Comment"
                                              }
                                            },
                                            "MX_IP_table": {
                                              "runAfter": {
                                                "For_each_MX_IP_results": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "Table",
                                              "inputs": {
                                                "format": "HTML",
                                                "from": "@variables('mx_ip_domain_details')"
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Pivot_by_MX_IP": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "MX_IP_Limit_Exceeded_Comment": {
                                                "type": "ApiConnection",
                                                "inputs": {
                                                  "body": {
                                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                                    "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> MX IP Address: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_by_MX_IP')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                                  },
                                                  "host": {
                                                    "connection": {
                                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                    }
                                                  },
                                                  "method": "post",
                                                  "path": "/Incidents/Comment"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "not": {
                                                  "equals": [
                                                    "@body('Pivot_by_MX_IP')?['response']?['limit_exceeded']",
                                                    "@true"
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Pivot_by_MX_IP": {
                                          "runAfter": {
                                            "set_mx_ip_value": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/iris-investigate/mx-ip",
                                            "queries": {
                                              "api_key": "@parameters('IrisInvestigateAPIKey')",
                                              "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                              "mailserver_ip": "@variables('mx_ip_value')"
                                            }
                                          }
                                        },
                                        "set_mx_ip_value": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "mx_ip_value",
                                            "value": "@items('For_each_mx_ip')?['value']"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "set_mx_ip_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@variables('mx_ip_count')",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@variables('mx_ip_count')",
                                              "@parameters('max_mx_ip_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_mx_ip_count": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_ip_count",
                                        "value": "@items('For_each_mx_ip')?['count']"
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "NameServer_IP_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_nameserver": {
                              "foreach": "@items('NameServer_IP_Details')['name_server']",
                              "actions": {
                                "For_each_nameserver_ip": {
                                  "foreach": "@items('For_each_nameserver')['ip']",
                                  "actions": {
                                    "Check_Max_Nameserver_IP_Count": {
                                      "actions": {
                                        "Check_Nameserver_IP_Limit_exceeded": {
                                          "actions": {
                                            "For_each_nameserver_ip_address": {
                                              "foreach": "@body('Pivot_by_Nameserver_IP_Address')?['response']?['results']",
                                              "actions": {
                                                "Append_to_nameserver_ip_domain_details": {
                                                  "runAfter": {
                                                    "Nameserver_IP_Address_Compose": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "type": "AppendToArrayVariable",
                                                  "inputs": {
                                                    "name": "nameserver_ip_domain_details",
                                                    "value": "@outputs('Nameserver_IP_Address_Compose')"
                                                  }
                                                },
                                                "Check_if_nameserver_riskscore_is_null": {
                                                  "actions": {
                                                    "set_nameserver_ip_domain_risk_count": {
                                                      "type": "IncrementVariable",
                                                      "inputs": {
                                                        "name": "nameserver_ip_domain_risk_count",
                                                        "value": 1
                                                      }
                                                    }
                                                  },
                                                  "runAfter": {
                                                    "set_nameserver_ip_domain_risk": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "expression": {
                                                    "and": [
                                                      {
                                                        "not": {
                                                          "equals": [
                                                            "@items('For_each_nameserver_ip_address')?['domain_risk']?['risk_score']",
                                                            "@null"
                                                          ]
                                                        }
                                                      },
                                                      {
                                                        "greater": [
                                                          "@items('For_each_nameserver_ip_address')?['domain_risk']?['risk_score']",
                                                          0
                                                        ]
                                                      }
                                                    ]
                                                  },
                                                  "type": "If"
                                                },
                                                "Nameserver_IP_Address_Compose": {
                                                  "type": "Compose",
                                                  "inputs": {
                                                    "Domain": "@items('For_each_nameserver_ip_address')?['domain']",
                                                    "Risk Score": "@items('For_each_nameserver_ip_address')?['domain_risk']?['risk_score']"
                                                  }
                                                },
                                                "set_nameserver_ip_domain_risk": {
                                                  "runAfter": {
                                                    "Append_to_nameserver_ip_domain_details": [
                                                      "Succeeded"
                                                    ]
                                                  },
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "nameserver_ip_domain_risk",
                                                    "value": "@items('For_each_nameserver_ip_address')?['domain_risk']?['risk_score']"
                                                  }
                                                }
                                              },
                                              "type": "Foreach"
                                            },
                                            "Nameserver_IP_Comment": {
                                              "runAfter": {
                                                "Nameserver_IP_table": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "ApiConnection",
                                              "inputs": {
                                                "body": {
                                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                                  "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Nameserver IP: </strong></span>@{variables('nameserver_ip_value')}<br>\n<strong>Average Risk Score</strong>: @{div(variables('nameserver_ip_domain_risk'),variables('nameserver_ip_domain_risk_count'))}<br>\n@{body('Nameserver_IP_table')}</p>"
                                                },
                                                "host": {
                                                  "connection": {
                                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                  }
                                                },
                                                "method": "post",
                                                "path": "/Incidents/Comment"
                                              }
                                            },
                                            "Nameserver_IP_table": {
                                              "runAfter": {
                                                "For_each_nameserver_ip_address": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "Table",
                                              "inputs": {
                                                "format": "HTML",
                                                "from": "@variables('nameserver_ip_domain_details')"
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Pivot_by_Nameserver_IP_Address": [
                                              "Succeeded"
                                            ]
                                          },
                                          "else": {
                                            "actions": {
                                              "Nameserver_IP_Limit_Exceeded_Comment": {
                                                "type": "ApiConnection",
                                                "inputs": {
                                                  "body": {
                                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                                    "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Nameserver IP: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_by_Nameserver_IP_Address')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                                  },
                                                  "host": {
                                                    "connection": {
                                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                    }
                                                  },
                                                  "method": "post",
                                                  "path": "/Incidents/Comment"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "not": {
                                                  "equals": [
                                                    "@body('Pivot_by_Nameserver_IP_Address')?['response']?['limit_exceeded']",
                                                    "@true"
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Pivot_by_Nameserver_IP_Address": {
                                          "runAfter": {
                                            "set_nameserver_ip_value": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/iris-investigate/nameserver-ip",
                                            "queries": {
                                              "api_key": "@parameters('IrisInvestigateAPIKey')",
                                              "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                              "nameserver_ip": "@variables('nameserver_ip_value')"
                                            }
                                          }
                                        },
                                        "set_nameserver_ip_value": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "nameserver_ip_value",
                                            "value": "@items('For_each_nameserver_ip')?['value']"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "set_nameserver_ip_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@variables('nameserver_ip_count')",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@variables('nameserver_ip_count')",
                                              "@parameters('max_name_server_ip_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_nameserver_ip_count": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "nameserver_ip_count",
                                        "value": "@items('For_each_nameserver_ip')?['count']"
                                      }
                                    }
                                  },
                                  "type": "Foreach"
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Nameserver_Host_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_nameserver_obj": {
                              "foreach": "@items('Nameserver_Host_Details')['name_server']",
                              "actions": {
                                "Check_Max_nameserver_host_count": {
                                  "actions": {
                                    "Check_Nameserver_host_limit_exceeded": {
                                      "actions": {
                                        "For_each_pivot_nameserver_host_details": {
                                          "foreach": "@body('Pivot_Nameserver_Host')?['response']?['results']",
                                          "actions": {
                                            "Append_to_nameserver_host_domain_details": {
                                              "runAfter": {
                                                "Nameserver_Host_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "nameserver_host_domain_details",
                                                "value": "@outputs('Nameserver_Host_Compose')"
                                              }
                                            },
                                            "Check_nameserver_host_risskscore_is_null": {
                                              "actions": {
                                                "set_nameserver_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "nameserver_host_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_nameserver_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_pivot_nameserver_host_details')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_pivot_nameserver_host_details')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "Nameserver_Host_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_pivot_nameserver_host_details')?['domain']",
                                                "Risk Score": "@items('For_each_pivot_nameserver_host_details')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "set_nameserver_domain_risk": {
                                              "runAfter": {
                                                "Append_to_nameserver_host_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "nameserver_host_domain_risk",
                                                "value": "@items('For_each_pivot_nameserver_host_details')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "Namerserver_Host_Table": {
                                          "runAfter": {
                                            "For_each_pivot_nameserver_host_details": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('nameserver_host_domain_details')"
                                          }
                                        },
                                        "Nameserver_host_comment": {
                                          "runAfter": {
                                            "Namerserver_Host_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for &nbsp;</strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Nameserver Host:</strong></span>@{variables('nameserver_host_value')}<br>\n<strong>Average Risk Score:</strong> @{div(variables('nameserver_host_domain_risk'),variables('nameserver_host_domain_risk_count'))}<br>\n@{body('Namerserver_Host_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Pivot_Nameserver_Host": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "nameserver_host_limit_exceeded_comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for &nbsp;</strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Nameserver Host:<br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_Nameserver_Host')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Pivot_Nameserver_Host')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Pivot_Nameserver_Host": {
                                      "runAfter": {
                                        "Set_nameserver_host_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/nameserver-host/",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "nameserver_host": "@variables('nameserver_host_value')"
                                        }
                                      }
                                    },
                                    "Set_nameserver_host_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "nameserver_host_value",
                                        "value": "@items('For_each_nameserver_obj')?['host']?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_nameserver_host_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('nameserver_host_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('nameserver_host_count')",
                                          "@parameters('max_name_server_host_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_nameserver_host_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "nameserver_host_count",
                                    "value": "@items('For_each_nameserver_obj')?['host']?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Registrant_Name_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "Check_registrant_contact_name_count": {
                              "actions": {
                                "Pivot_by_Registrant_Name": {
                                  "runAfter": {
                                    "Set_registrant_name_value": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/iris-investigate/registrant",
                                    "queries": {
                                      "api_key": "@parameters('IrisInvestigateAPIKey')",
                                      "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                      "registrant": "@variables('registrant_name_value')"
                                    }
                                  }
                                },
                                "Set_registrant_name_value": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_name_value",
                                    "value": "@items('Registrant_Name_Details')?['registrant_name']?['value']"
                                  }
                                },
                                "check_registrant_limit_exceeded": {
                                  "actions": {
                                    "Create_Domain_Details_Table": {
                                      "runAfter": {
                                        "For_each_registrant_name_pivot_results": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Table",
                                      "inputs": {
                                        "format": "HTML",
                                        "from": "@variables('registrant_name_domain_details')"
                                      }
                                    },
                                    "For_each_registrant_name_pivot_results": {
                                      "foreach": "@body('Pivot_by_Registrant_Name')?['response']?['results']",
                                      "actions": {
                                        "Append_to_domain_details_array": {
                                          "runAfter": {
                                            "Registrant_Name_Compose": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "registrant_name_domain_details",
                                            "value": "@outputs('Registrant_Name_Compose')"
                                          }
                                        },
                                        "Check_Risk_Score_Value_is_not_null": {
                                          "actions": {
                                            "increment_domain_risk_score_count": {
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "registrant_name_domain_risk_score_count",
                                                "value": 1
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "Overall_Risk_Score": [
                                              "Succeeded"
                                            ]
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "not": {
                                                  "equals": [
                                                    "@items('For_each_registrant_name_pivot_results')?['domain_risk']?['risk_score']",
                                                    "@null"
                                                  ]
                                                }
                                              },
                                              {
                                                "greater": [
                                                  "@items('For_each_registrant_name_pivot_results')?['domain_risk']?['risk_score']",
                                                  0
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "Overall_Risk_Score": {
                                          "runAfter": {
                                            "Append_to_domain_details_array": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "registrant_name_domain_risk",
                                            "value": "@items('For_each_registrant_name_pivot_results')?['domain_risk']?['risk_score']"
                                          }
                                        },
                                        "Registrant_Name_Compose": {
                                          "type": "Compose",
                                          "inputs": {
                                            "Domain": "@items('For_each_registrant_name_pivot_results')?['domain']",
                                            "Risk Score": "@items('For_each_registrant_name_pivot_results')?['domain_risk']?['risk_score']"
                                          }
                                        }
                                      },
                                      "type": "Foreach"
                                    },
                                    "registrant_name_comment": {
                                      "runAfter": {
                                        "Create_Domain_Details_Table": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "incidentArmId": "@triggerBody()?['object']?['id']",
                                          "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Registrant Name:</strong></span>@{variables('registrant_name_value')}<br>\n<strong>Average Risk Score: </strong>@{div(variables('registrant_name_domain_risk'),variables('registrant_name_domain_risk_score_count'))}<br>\n@{body('Create_Domain_Details_Table')}</p>"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/Incidents/Comment"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Pivot_by_Registrant_Name": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "registrant_name_limit_exceeded_comment": {
                                        "type": "ApiConnection",
                                        "inputs": {
                                          "body": {
                                            "incidentArmId": "@triggerBody()?['object']?['id']",
                                            "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> Registrant Name:<br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_by_Registrant_Name')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                          },
                                          "host": {
                                            "connection": {
                                              "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                            }
                                          },
                                          "method": "post",
                                          "path": "/Incidents/Comment"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@body('Pivot_by_Registrant_Name')?['response']?['limit_exceeded']",
                                            "@true"
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "type": "If"
                                }
                              },
                              "runAfter": {
                                "Set_registrant_name_count": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@variables('registrant_name_count')",
                                      1
                                    ]
                                  },
                                  {
                                    "lessOrEquals": [
                                      "@variables('registrant_name_count')",
                                      "@parameters('max_registrant_name_count')"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Set_registrant_name_count": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "registrant_name_count",
                                "value": "@items('Registrant_Name_Details')?['registrant_name']?['count']"
                              }
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Registrant_Org_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "Check_Max_registrant_org_count": {
                              "actions": {
                                "Check_registrant_org_limit_exceeded": {
                                  "actions": {
                                    "Create_registrant_org_table": {
                                      "runAfter": {
                                        "For_each_registrant_org": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Table",
                                      "inputs": {
                                        "format": "HTML",
                                        "from": "@variables('registrant_org_domain_details')"
                                      }
                                    },
                                    "For_each_registrant_org": {
                                      "foreach": "@body('Pivot_by_Registrant_Org')?['response']?['results']",
                                      "actions": {
                                        "Append_to_registrant_org_domain_details_variable": {
                                          "runAfter": {
                                            "registrant_org_compose": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "registrant_org_domain_details",
                                            "value": "@outputs('registrant_org_compose')"
                                          }
                                        },
                                        "Check_registrant_or_risk_score_in_not_null": {
                                          "actions": {
                                            "registrant_org_domain_risk_count": {
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "registrant_org_domain_risk_score_count",
                                                "value": 1
                                              }
                                            }
                                          },
                                          "runAfter": {
                                            "registrant_org_domain_risk": [
                                              "Succeeded"
                                            ]
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "not": {
                                                  "equals": [
                                                    "@items('For_each_registrant_org')?['domain_risk']?['risk_score']",
                                                    "@null"
                                                  ]
                                                }
                                              },
                                              {
                                                "greater": [
                                                  "@items('For_each_registrant_org')?['domain_risk']?['risk_score']",
                                                  0
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        },
                                        "registrant_org_compose": {
                                          "type": "Compose",
                                          "inputs": {
                                            "Domain": "@items('For_each_registrant_org')?['domain']",
                                            "Risk Score": "@items('For_each_registrant_org')?['domain_risk']?['risk_score']"
                                          }
                                        },
                                        "registrant_org_domain_risk": {
                                          "runAfter": {
                                            "Append_to_registrant_org_domain_details_variable": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "IncrementVariable",
                                          "inputs": {
                                            "name": "registrant_org_domain_risk",
                                            "value": "@items('For_each_registrant_org')?['domain_risk']?['risk_score']"
                                          }
                                        }
                                      },
                                      "type": "Foreach"
                                    },
                                    "registrant_org_comment": {
                                      "runAfter": {
                                        "Create_registrant_org_table": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "body": {
                                          "incidentArmId": "@triggerBody()?['object']?['id']",
                                          "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Registrant Org: </strong></span>@{variables('registrant_org_value')}<br>\n<strong>Average Risk Score:</strong><strong>@{div(variables('registrant_org_domain_risk'),variables('registrant_org_domain_risk_score_count'))}</strong><strong><br>\n</strong>@{body('Create_registrant_org_table')}</p>"
                                        },
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/Incidents/Comment"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Pivot_by_Registrant_Org": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "registrant_org_limit_exceeded_comment": {
                                        "type": "ApiConnection",
                                        "inputs": {
                                          "body": {
                                            "incidentArmId": "@triggerBody()?['object']?['id']",
                                            "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Registrant Org: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_by_Registrant_Org')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                          },
                                          "host": {
                                            "connection": {
                                              "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                            }
                                          },
                                          "method": "post",
                                          "path": "/Incidents/Comment"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "not": {
                                          "equals": [
                                            "@body('Pivot_by_Registrant_Org')?['response']?['limit_exceeded']",
                                            "@true"
                                          ]
                                        }
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Pivot_by_Registrant_Org": {
                                  "runAfter": {
                                    "Set_registrant_org_value": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/iris-investigate/registrant-org",
                                    "queries": {
                                      "api_key": "@parameters('IrisInvestigateAPIKey')",
                                      "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                      "registrant_org": "@variables('registrant_org_value')"
                                    }
                                  }
                                },
                                "Set_registrant_org_value": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_org_value",
                                    "value": "@items('Registrant_Org_Details')?['registrant_org']?['value']"
                                  }
                                }
                              },
                              "runAfter": {
                                "Set_registrant_org_count": [
                                  "Succeeded"
                                ]
                              },
                              "expression": {
                                "and": [
                                  {
                                    "greater": [
                                      "@variables('registrant_org_count')",
                                      1
                                    ]
                                  },
                                  {
                                    "lessOrEquals": [
                                      "@variables('registrant_org_count')",
                                      "@parameters('max_registrant_org_count')"
                                    ]
                                  }
                                ]
                              },
                              "type": "If"
                            },
                            "Set_registrant_org_count": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "registrant_org_count",
                                "value": "@items('Registrant_Org_Details')?['registrant_org']?['count']"
                              }
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "SOA_Email_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_soa_email": {
                              "foreach": "@items('SOA_Email_Details')['soa_email']",
                              "actions": {
                                "Check_Max_SOA_Email": {
                                  "actions": {
                                    "Reverse_Email": {
                                      "runAfter": {
                                        "set_soa_email_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/reverse-email",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "email": "@variables('soa_email_value')"
                                        }
                                      }
                                    },
                                    "check_reverse_email_limit_exceeded": {
                                      "actions": {
                                        "For_each_reverse_email": {
                                          "foreach": "@body('Reverse_Email')?['response']?['results']",
                                          "actions": {
                                            "Append_to_soa_email_domain_details": {
                                              "runAfter": {
                                                "SOA_Email_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "soa_email_domain_details",
                                                "value": "@outputs('SOA_Email_Compose')"
                                              }
                                            },
                                            "SOA_Email_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_reverse_email')?['domain']",
                                                "Risk Score": "@items('For_each_reverse_email')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "check_soa_email_risk_score_is_null": {
                                              "actions": {
                                                "set_soa_email_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "soa_email_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_soa_email_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_reverse_email')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_reverse_email')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "set_soa_email_domain_risk": {
                                              "runAfter": {
                                                "Append_to_soa_email_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "soa_email_domain_risk",
                                                "value": "@items('For_each_reverse_email')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "SOA_Email_Table": {
                                          "runAfter": {
                                            "For_each_reverse_email": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('soa_email_domain_details')"
                                          }
                                        },
                                        "reverse_email_comment": {
                                          "runAfter": {
                                            "SOA_Email_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Soa EMail: </strong></span>@{variables('soa_email_value')}<br>\n<strong>Average Risk Score: </strong>&nbsp;@{div(variables('soa_email_domain_risk'),variables('soa_email_domain_risk_count'))}<br>\n@{body('SOA_Email_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Reverse_Email": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "reverse_email_limit_exceeded_comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;Soa EMail: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Reverse_Email')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Reverse_Email')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_soa_email_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "soa_email_value",
                                        "value": "@items('For_each_soa_email')?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_soa_email_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('soa_email_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('soa_email_count')",
                                          "@parameters('max_soa_email_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Set_soa_email_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "soa_email_count",
                                    "value": "@items('For_each_soa_email')?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "SSL_Info_Email_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_ssl_email": {
                              "foreach": "@items('SSL_Info_Email_Details')['ssl_email']",
                              "actions": {
                                "Check_Max_SSL_Email_Count": {
                                  "actions": {
                                    "Pivot_SSL_Email": {
                                      "runAfter": {
                                        "set_ssl_email_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/ssl-email/",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "ssl_email": "@variables('ssl_email_value')"
                                        }
                                      }
                                    },
                                    "check_ssl_email_limit_exceeded": {
                                      "actions": {
                                        "For_each_pivot_ssl_email": {
                                          "foreach": "@body('Pivot_SSL_Email')?['response']?['results']",
                                          "actions": {
                                            "Append_to_ssl_email_domain_details": {
                                              "runAfter": {
                                                "SSL_Email_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "ssl_email_domain_details",
                                                "value": "@outputs('SSL_Email_Compose')"
                                              }
                                            },
                                            "SSL_Email_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_pivot_ssl_email')?['domain']",
                                                "Risk Score": "@items('For_each_pivot_ssl_email')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "check_ssl_email_domain_risk_is_null": {
                                              "actions": {
                                                "set_ssl_email_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "ssl_email_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_ssl_email_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_pivot_ssl_email')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "greater": [
                                                      "@items('For_each_pivot_ssl_email')?['domain_risk']?['risk_score']",
                                                      0
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "set_ssl_email_domain_risk": {
                                              "runAfter": {
                                                "Append_to_ssl_email_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "ssl_email_domain_risk",
                                                "value": "@items('For_each_pivot_ssl_email')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "SSL_Email_Table": {
                                          "runAfter": {
                                            "For_each_pivot_ssl_email": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('ssl_email_domain_details')"
                                          }
                                        },
                                        "ssl_email_comment": {
                                          "runAfter": {
                                            "SSL_Email_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> SSL Email: </strong></span>@{variables('ssl_email_value')}<br>\nAverage Risk Score: &nbsp;@{div(variables('ssl_email_domain_details'),variables('ssl_info_hash_domain_risk_count'))}<br>\n@{body('SSL_Email_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Pivot_SSL_Email": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "ssl_email_limit_exceeded_comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> SSL Email: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_SSL_Email')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Pivot_SSL_Email')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_ssl_email_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ssl_email_value",
                                        "value": "@items('For_each_ssl_email')?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_email_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('ssl_email_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('ssl_email_count')",
                                          "@parameters('max_ssl_email_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_ssl_email_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_email_count",
                                    "value": "@items('For_each_ssl_email')?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "SSL_Info_Hash_Details": {
                          "foreach": "@body('Investigate_Domain')?['response']?['results']",
                          "actions": {
                            "For_each_ssl_info": {
                              "foreach": "@items('SSL_Info_Hash_Details')['ssl_info']",
                              "actions": {
                                "Check_Max_SSL_Hash_Count": {
                                  "actions": {
                                    "Pivot_by_SSL_Hash": {
                                      "runAfter": {
                                        "set_ssl_info_hash_value": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "ApiConnection",
                                      "inputs": {
                                        "host": {
                                          "connection": {
                                            "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                                          }
                                        },
                                        "method": "post",
                                        "path": "/iris-investigate/ssl-hash",
                                        "queries": {
                                          "api_key": "@parameters('IrisInvestigateAPIKey')",
                                          "api_username": "@parameters('IrisInvestigateAPIUsername')",
                                          "ssl_hash": "@variables('ssl_info_hash_value')"
                                        }
                                      }
                                    },
                                    "check_ssl_hash_limit_exceeded": {
                                      "actions": {
                                        "For_each_pivot_by_ssh_hash": {
                                          "foreach": "@body('Pivot_by_SSL_Hash')?['response']?['results']",
                                          "actions": {
                                            "Append_to_ssl_info_hash_domain_details": {
                                              "runAfter": {
                                                "SSl_Hash_Compose": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "ssl_info_hash_domain_details",
                                                "value": "@outputs('SSl_Hash_Compose')"
                                              }
                                            },
                                            "SSl_Hash_Compose": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Domain": "@items('For_each_pivot_by_ssh_hash')?['domain']",
                                                "Risk Score": "@items('For_each_pivot_by_ssh_hash')?['domain_risk']?['risk_score']"
                                              }
                                            },
                                            "check_ssl_info_domain_risk_is_null": {
                                              "actions": {
                                                "set_ssl_info_hash_domain_risk_count": {
                                                  "type": "IncrementVariable",
                                                  "inputs": {
                                                    "name": "ssl_info_hash_domain_risk_count",
                                                    "value": 1
                                                  }
                                                }
                                              },
                                              "runAfter": {
                                                "set_ssl_info_hash_domain_risk": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "equals": [
                                                        "@items('For_each_pivot_by_ssh_hash')?['domain_risk']?['risk_score']",
                                                        "@null"
                                                      ]
                                                    }
                                                  },
                                                  {
                                                    "lessOrEquals": [
                                                      "@items('For_each_pivot_by_ssh_hash')?['domain_risk']?['risk_score']",
                                                      "@parameters('max_ssl_info_hash_count')"
                                                    ]
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            },
                                            "set_ssl_info_hash_domain_risk": {
                                              "runAfter": {
                                                "Append_to_ssl_info_hash_domain_details": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "IncrementVariable",
                                              "inputs": {
                                                "name": "ssl_info_hash_domain_risk",
                                                "value": "@items('For_each_pivot_by_ssh_hash')?['domain_risk']?['risk_score']"
                                              }
                                            }
                                          },
                                          "type": "Foreach"
                                        },
                                        "SSL_Hash_Table": {
                                          "runAfter": {
                                            "For_each_pivot_by_ssh_hash": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "Table",
                                          "inputs": {
                                            "format": "HTML",
                                            "from": "@variables('ssl_info_hash_domain_details')"
                                          }
                                        },
                                        "ssl_hash_comment": {
                                          "runAfter": {
                                            "SSL_Hash_Table": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "ApiConnection",
                                          "inputs": {
                                            "body": {
                                              "incidentArmId": "@triggerBody()?['object']?['id']",
                                              "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;SSL Hash: </strong></span>@{variables('ssl_info_hash_value')}<br>\n<strong>Average Risk Score:</strong> &nbsp;@{div(variables('ssl_info_hash_domain_risk'),variables('ssl_info_hash_domain_risk_count'))}<br>\n@{body('SSL_Hash_Table')}</p>"
                                            },
                                            "host": {
                                              "connection": {
                                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                              }
                                            },
                                            "method": "post",
                                            "path": "/Incidents/Comment"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Pivot_by_SSL_Hash": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "ssl_hash_limit_exceeded_comment": {
                                            "type": "ApiConnection",
                                            "inputs": {
                                              "body": {
                                                "incidentArmId": "@triggerBody()?['object']?['id']",
                                                "message": "<p><span style=\"font-size: 14px\"><strong>Pivot Results for </strong></span><span style=\"font-size: 14px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 14px\"><strong> &nbsp;SSL Hash: <br>\n</strong></span><span style=\"font-size: 14px\"><strong>@{body('Pivot_by_SSL_Hash')?['response']?['message']}</strong></span><span style=\"font-size: 14px\"><strong></strong></span></p>"
                                              },
                                              "host": {
                                                "connection": {
                                                  "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                                }
                                              },
                                              "method": "post",
                                              "path": "/Incidents/Comment"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "not": {
                                              "equals": [
                                                "@body('Pivot_by_SSL_Hash')?['response']?['limit_exceeded']",
                                                "@true"
                                              ]
                                            }
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "set_ssl_info_hash_value": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ssl_info_hash_value",
                                        "value": "@items('For_each_ssl_info')?['hash']?['value']"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_info_hash_count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@variables('ssl_info_hash_count')",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@variables('ssl_info_hash_count')",
                                          "@parameters('max_ssl_info_hash_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_ssl_info_hash_count": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_info_hash_count",
                                    "value": "@items('For_each_ssl_info')?['hash']?['count']"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "Foreach"
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each_Host_')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each_Host_')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "email_domain_count": {
                      "runAfter": {
                        "email_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "email_domain_domain_details": {
                      "runAfter": {
                        "ssl_email_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "email_domain_domain_risk": {
                      "runAfter": {
                        "email_domain_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "email_domain_domain_risk_count": {
                      "runAfter": {
                        "email_domain_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "email_domain_value": {
                      "runAfter": {
                        "ssl_email_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_address_count": {
                      "runAfter": {
                        "ip_address_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "ip_address_domain_details": {
                      "runAfter": {
                        "registrant_org_domain_risk_score_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "ip_address_risk_score": {
                      "runAfter": {
                        "ip_address_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_risk_score",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "ip_address_risk_score_count": {
                      "runAfter": {
                        "ip_address_risk_score": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_risk_score_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "ip_address_value": {
                      "runAfter": {
                        "registrant_org_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_host_count": {
                      "runAfter": {
                        "mx_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "mx_host_domain_details": {
                      "runAfter": {
                        "nameserver_ip_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_hostl_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_host_domain_risk": {
                      "runAfter": {
                        "mx_host_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "mx_host_domain_risk_count": {
                      "runAfter": {
                        "mx_host_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "mx_host_value": {
                      "runAfter": {
                        "nameserver_ip_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_ip_count": {
                      "runAfter": {
                        "mx_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "mx_ip_domain_details": {
                      "runAfter": {
                        "ip_address_risk_score_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_ip_risk_score": {
                      "runAfter": {
                        "mx_ip_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_risk_score",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "mx_ip_risk_score_count": {
                      "runAfter": {
                        "mx_ip_risk_score": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_risk_score_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "mx_ip_value": {
                      "runAfter": {
                        "ip_address_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameserver_host_count": {
                      "runAfter": {
                        "nameserver_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_host_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_host_domain_details": {
                      "runAfter": {
                        "mx_ip_risk_score_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_host_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "nameserver_host_domain_risk": {
                      "runAfter": {
                        "nameserver_host_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_host_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_host_domain_risk_count": {
                      "runAfter": {
                        "nameserver_host_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_host_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_host_value": {
                      "runAfter": {
                        "mx_ip_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameserver_ip_count": {
                      "runAfter": {
                        "nameserver_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_ip_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_ip_domain_details": {
                      "runAfter": {
                        "nameserver_host_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_ip_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "nameserver_ip_domain_risk": {
                      "runAfter": {
                        "nameserver_ip_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_ip_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_ip_domain_risk_count": {
                      "runAfter": {
                        "nameserver_ip_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_ip_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "nameserver_ip_value": {
                      "runAfter": {
                        "nameserver_host_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameserver_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_name_count": {
                      "runAfter": {
                        "registrant_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "registrant_name_domain_details": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_name_domain_risk_score": {
                      "runAfter": {
                        "registrant_name_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "registrant_name_domain_risk_score_count": {
                      "runAfter": {
                        "registrant_name_domain_risk_score": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_domain_risk_score_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "registrant_name_value": {
                      "runAfter": {
                        "soa_email_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_org_count": {
                      "runAfter": {
                        "registrant_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "registrant_org_domain_details": {
                      "runAfter": {
                        "registrant_name_domain_risk_score_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_org_domain_risk_score": {
                      "runAfter": {
                        "registrant_org_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "registrant_org_domain_risk_score_count": {
                      "runAfter": {
                        "registrant_org_domain_risk_score": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_domain_risk_score_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "registrant_org_value": {
                      "runAfter": {
                        "registrant_name_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_email_count": {
                      "runAfter": {
                        "soa_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "soa_email_domain_details": {
                      "runAfter": {
                        "email_domain_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "soa_email_domain_risk": {
                      "runAfter": {
                        "soa_email_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_domain_risk",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "soa_email_domain_risk_count": {
                      "runAfter": {
                        "soa_email_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_domain_risk_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "soa_email_value": {
                      "runAfter": {
                        "email_domain_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_email_count": {
                      "runAfter": {
                        "ssl_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "ssl_email_domain_details": {
                      "runAfter": {
                        "ssl_info_hash_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "ssl_email_domain_risk": {
                      "runAfter": {
                        "ssl_email_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "ssl_email_domain_risk_count": {
                      "runAfter": {
                        "ssl_email_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "ssl_email_value": {
                      "runAfter": {
                        "ssl_info_hash_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_count": {
                      "runAfter": {
                        "ssl_info_hash_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_domain_details": {
                      "runAfter": {
                        "mx_host_domain_risk_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_domain_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_domain_risk": {
                      "runAfter": {
                        "ssl_info_hash_domain_details": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_domain_risk",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_domain_risk_count": {
                      "runAfter": {
                        "ssl_info_hash_domain_risk": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_domain_risk_count",
                            "type": "integer",
                            "value": 0
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_value": {
                      "runAfter": {
                        "mx_host_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_value",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId5'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId5')]",
                "contentId": "[variables('_playbookContentId5')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion5')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Guided Pivots - DomainTools Iris Investigate",
            "description": "Given a domain return all the Iris Investigate data, highlighting fields where < 200 domains share an attribute to clue investigators in to retrieve more data via Iris Investigate UI (or further queries using the Iris Investigate API).",
            "prerequisites": "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2023-03-14T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId5')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-Guided_Pivots_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId5')]",
        "id": "[variables('_playbookcontentProductId5')]",
        "version": "[variables('playbookVersion5')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName6')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-Malicious_Tags_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion6')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-Malicious_Tags_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Malicious_Tags": {
                      "defaultValue": [
                        "test_tag",
                        "test_tag2",
                        "test_tag3"
                      ],
                      "type": "Array"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Check_Malicious_Domains_Exist": {
                      "actions": {
                        "Add_comment_to_incident_(V3)": {
                          "runAfter": {
                            "Malicious_Domains_Table": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "body": {
                              "incidentArmId": "@triggerBody()?['object']?['id']",
                              "message": "<p><strong>Malicious Tags found in:</strong>@{body('Malicious_Domains_Table')}</p>"
                            },
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/Incidents/Comment"
                          }
                        },
                        "Malicious_Domains_Table": {
                          "type": "Table",
                          "inputs": {
                            "format": "HTML",
                            "from": "@variables('malicious_domains')"
                          }
                        }
                      },
                      "runAfter": {
                        "For_each": [
                          "Succeeded"
                        ]
                      },
                      "expression": {
                        "and": [
                          {
                            "greater": [
                              "@length(variables('malicious_domains'))",
                              0
                            ]
                          }
                        ]
                      },
                      "type": "If"
                    },
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "Initialize_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Check_if_results_exists": {
                          "actions": {
                            "Loop_through_the_results_object": {
                              "foreach": "@body('Investigate_Domain')?['response']?['results']",
                              "actions": {
                                "Check_if_domain_tags_exists": {
                                  "actions": {
                                    "For_each_domain_tag_list": {
                                      "foreach": "@variables('domain_tags_list')",
                                      "actions": {
                                        "Tags_condition": {
                                          "actions": {
                                            "Condition": {
                                              "actions": {
                                                "Append_to_malicious_tags": {
                                                  "type": "AppendToStringVariable",
                                                  "inputs": {
                                                    "name": "malicious_tags",
                                                    "value": "@{items('For_each_domain_tag_list')},"
                                                  }
                                                }
                                              },
                                              "expression": {
                                                "and": [
                                                  {
                                                    "not": {
                                                      "contains": [
                                                        "@variables('malicious_tags')",
                                                        "@items('For_each_domain_tag_list')"
                                                      ]
                                                    }
                                                  }
                                                ]
                                              },
                                              "type": "If"
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "contains": [
                                                  "@parameters('Malicious_Tags')",
                                                  "@items('For_each_domain_tag_list')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_domain_tags": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "For_each_domain_tags": {
                                      "foreach": "@items('Loop_through_the_results_object')?['tags']",
                                      "actions": {
                                        "Append_to_domain_tags_list": {
                                          "type": "AppendToArrayVariable",
                                          "inputs": {
                                            "name": "domain_tags_list",
                                            "value": "@items('For_each_domain_tags')?['label']"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "set_domain_tags_list": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "set_domain_tags_list": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "domain_tags_list",
                                        "value": "[variables('TemplateEmptyArray')]"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_malicious_tags_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(items('Loop_through_the_results_object')?['tags'])",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "set_malicious_tags_to_empty": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "malicious_tags",
                                    "value": "@{null}"
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Investigate_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Incident_Severity_Check": {
                          "actions": {
                            "Append_to_array_variable": {
                              "runAfter": {
                                "Malicious_Domains_Compose": [
                                  "Succeeded"
                                ]
                              },
                              "type": "AppendToArrayVariable",
                              "inputs": {
                                "name": "malicious_domains",
                                "value": "@outputs('Malicious_Domains_Compose')"
                              }
                            },
                            "Malicious_Domains_Compose": {
                              "runAfter": {
                                "Update_incident": [
                                  "Succeeded"
                                ]
                              },
                              "type": "Compose",
                              "inputs": {
                                "Domain": "@variables('domain_name')",
                                "Tags": "@substring(variables('malicious_tags'),0,sub(length(variables('malicious_tags')),1))"
                              }
                            },
                            "Update_incident": {
                              "type": "ApiConnection",
                              "inputs": {
                                "body": {
                                  "incidentArmId": "@triggerBody()?['object']?['id']",
                                  "severity": "High"
                                },
                                "host": {
                                  "connection": {
                                    "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                  }
                                },
                                "method": "put",
                                "path": "/Incidents"
                              }
                            }
                          },
                          "runAfter": {
                            "Check_if_results_exists": [
                              "Succeeded"
                            ]
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(variables('malicious_tags'))",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Initialize_variable": {
                      "runAfter": {
                        "malicious_tags": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "malicious_domains",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "domain_tags_list": {
                      "runAfter": {
                        "incident_severity": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_tags_list",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "incident_severity": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "incident_severity",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "malicious_tags": {
                      "runAfter": {
                        "domain_tags_list": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "malicious_tags",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId6'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId6')]",
                "contentId": "[variables('_playbookContentId6')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion6')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Malicious Tags - DomainTools Iris Investigate",
            "description": "Track the activities of malicious actors using the Iris Investigate UI, tagging domains of interest. Given a domain or set of domains associated with an incident, query Iris Investigate for information on those domains, and if a specified set of tags is observed, mark the incident as 'severe' Microsoft Sentinel and add a comment.",
            "prerequisites": "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId6')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-Malicious_Tags_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId6')]",
        "id": "[variables('_playbookcontentProductId6')]",
        "version": "[variables('playbookVersion6')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName7')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-URL_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion7')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-URL_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            },
            "FunctionAppName": {
              "defaultValue": "DomainToolsFunctionApp",
              "type": "String"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "functionappName": "[[concat(toLower(parameters('FunctionAppName')), uniqueString(resourceGroup().id))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-2": "[[variables('connection-2')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    },
                    "Pivot Threshold": {
                      "defaultValue": 500,
                      "type": "Int"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "URL_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_URLs": {
                      "runAfter": {
                        "count_url_link_03": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/url"
                      }
                    },
                    "For_each": {
                      "foreach": "@body('Entities_-_Get_URLs')?['URLs']",
                      "actions": {
                        "Check_if_results_exists": {
                          "actions": {
                            "Results_Loop": {
                              "foreach": "@body('Investigate_Domain')?['response']?['results']",
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Technical_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><span style=\"font-size: 16px\">DomainTools IRIS Investigate response for: </span><span style=\"font-size: 16px\">@{variables('domain_name')}</span><span style=\"font-size: 16px\"></span><br>\n@{replace(replace(replace(body('Domain_detailts_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Domain_Risk_Score_Components_Table') , '&quot;', ''),']','') , '[', '') }@{replace(replace(replace(body('miscellaneouos_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('IP_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('MX_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Nameserver_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('SSL_Info_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Admin_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Billing_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Registrant_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}@{replace(replace(replace(body('Technical_Contact_Table'), '&lt;', '<'), '&gt;', '>'),'&quot;','')}<br>\n<br>\n<br>\nFind more details: https://research.domaintools.com/iris/search/?q=@{variables('domain_name')}</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Admin_Contact_Compose": {
                                  "runAfter": {
                                    "Check_admin_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Admin Contact City": "@variables('admin_contact_city_value')",
                                    "Admin Contact Country": "@variables('admin_contact_country_value')",
                                    "Admin Contact Email": "@substring(variables('admin_contact_email'),0,sub(length(variables('admin_contact_email')),1))",
                                    "Admin Contact Fax": "@variables('admin_contact_fax_value')",
                                    "Admin Contact Name": "@variables('admin_contact_name_value')",
                                    "Admin Contact Org": "@variables('admin_contact_org_value')",
                                    "Admin Contact Phone": "@variables('admin_contact_phone_value')",
                                    "Admin Contact Postal": "@variables('admin_contact_postal_value')",
                                    "Admin Contact State": "@variables('admin_contact_state_value')",
                                    "Admin Contact Street": "@variables('admin_contact_street_value')"
                                  }
                                },
                                "Admin_Contact_Table": {
                                  "runAfter": {
                                    "SSL_Info_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('admin_contact_details')"
                                  }
                                },
                                "Append_to__Domain_Details_array": {
                                  "runAfter": {
                                    "_Domain_Details_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "@outputs('_Domain_Details_Compose')"
                                  }
                                },
                                "Append_to_admin_contact_array": {
                                  "runAfter": {
                                    "Admin_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "@outputs('Admin_Contact_Compose')"
                                  }
                                },
                                "Append_to_billing_contact_array": {
                                  "runAfter": {
                                    "Billing_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "@outputs('Billing_Contact_Compose')"
                                  }
                                },
                                "Append_to_miscellaneous_array_variable": {
                                  "runAfter": {
                                    "Miscellaneous_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "@outputs('Miscellaneous_Compose')"
                                  }
                                },
                                "Append_to_registrant_contact_array": {
                                  "runAfter": {
                                    "Registrant_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "@outputs('Registrant_Contact_Compose')"
                                  }
                                },
                                "Append_to_techinical_contact_array": {
                                  "runAfter": {
                                    "Technical_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "@outputs('Technical_Contact_Compose')"
                                  }
                                },
                                "Billing_Contact_Compose": {
                                  "runAfter": {
                                    "Check_billing_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Billing Contact City": "@variables('billing_contact_city_value')",
                                    "Billing Contact Country": "@variables('billing_contact_country_value')",
                                    "Billing Contact Email": "@substring(variables('billing_contact_email'),0,sub(length(variables('billing_contact_email')),1))",
                                    "Billing Contact Fax": "@variables('billing_contact_fax_value')",
                                    "Billing Contact Name": "@variables('billing_contact_name_value')",
                                    "Billing Contact Org": "@variables('billing_contact_org_value')",
                                    "Billing Contact Phone": "@variables('billing_contact_phone_value')",
                                    "Billing Contact Postal": "@variables('billing_contact_postal_value')",
                                    "Billing Contact State": "@variables('billing_contact_state_value')",
                                    "Billing Contact Street": "@variables('billing_contact_street_value')"
                                  }
                                },
                                "Billing_Contact_Table": {
                                  "runAfter": {
                                    "Admin_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('billing_contact_details')"
                                  }
                                },
                                "Check_Adsense_Count": {
                                  "actions": {
                                    "Set_Adsense_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['adsense']?['value'],variables('count_url_end_03')),items('Results_Loop')?['adsense']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_adsense_value_1": {
                                      "runAfter": {
                                        "Set_Adsense_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "adsense_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_count_url_link_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_adsense_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "adsense_value",
                                          "value": "@items('Results_Loop')?['adsense']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['adsense']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['adsense']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Create_Date_Count": {
                                  "actions": {
                                    "Set_Create_Date_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['create_date']?['value'],variables('count_url_end_03')),items('Results_Loop')?['create_date']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Create_Date_value_1": {
                                      "runAfter": {
                                        "Set_Create_Date_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "create_date_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Adsense_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Create_Date_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "create_date_value",
                                          "value": "@items('Results_Loop')?['create_date']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['create_date']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['create_date']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Expiration_Date_Count": {
                                  "actions": {
                                    "Set_Expiration_Date_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['expiration_date']?['value'],variables('count_url_end_03')),items('Results_Loop')?['expiration_date']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Expiration_Date_value_1": {
                                      "runAfter": {
                                        "Set_Expiration_Date_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "expiration_date_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Create_Date_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Expiration_Date_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "expiration_date_value",
                                          "value": "@items('Results_Loop')?['expiration_date']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['expiration_date']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['expiration_date']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Redirect_Count": {
                                  "actions": {
                                    "Set_Redirect_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['redirect']?['value'],variables('count_url_end_03')),items('Results_Loop')?['redirect']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Redirect_value_1": {
                                      "runAfter": {
                                        "Set_Redirect_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "redirect_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Expiration_Date_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Redirect_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "redirect_value",
                                          "value": "@items('Results_Loop')?['redirect']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['redirect']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['redirect']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Redirect_Domain_Count": {
                                  "actions": {
                                    "Set_Redirect_Domain_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['redirect_domain']?['value'],variables('count_url_end_03')),items('Results_Loop')?['redirect_domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_Redirect_Domain_value_1": {
                                      "runAfter": {
                                        "Set_Redirect_Domain_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "redirect_domain_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Redirect_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_Redirect_Domain_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "redirect_domain_value",
                                          "value": "@items('Results_Loop')?['redirect_domain']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['redirect_domain']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['redirect_domain']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_City_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_city_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Country_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_country_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_fax_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Name_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Registrant_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_name_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Org_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_org_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_phone_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_postal_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_State_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_state_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_Registrant_Contact_Street_Count": {
                                  "actions": {
                                    "Set_Registrant_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_registrant_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_Registrant_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Registrant_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_registrant_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_contact_street_value",
                                          "value": "@items('Results_Loop')?['registrant_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_City_Count": {
                                  "actions": {
                                    "Set_admin_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_city_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Country_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_country_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_fax_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Name_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Admin_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_name_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Org_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_org_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_phone_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_postal_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_State_Count": {
                                  "actions": {
                                    "Set_admin_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_state_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_admin_Contact_Street_Count": {
                                  "actions": {
                                    "Set_admin_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['admin_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['admin_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_admin_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_admin_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "admin_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_admin_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_admin_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "admin_contact_street_value",
                                          "value": "@items('Results_Loop')?['admin_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['admin_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['admin_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_City_Count": {
                                  "actions": {
                                    "Set_billing_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_city_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Country_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_country_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_fax_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Name_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Billing_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_name_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Org_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_org_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_phone_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_postal_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_State_Count": {
                                  "actions": {
                                    "Set_billing_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_state_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_billing_Contact_Street_Count": {
                                  "actions": {
                                    "Set_billing_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['billing_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['billing_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_billing_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_billing_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "billing_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_billing_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_billing_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "billing_contact_street_value",
                                          "value": "@items('Results_Loop')?['billing_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['billing_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['billing_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_registrant_name_Count": {
                                  "actions": {
                                    "Set_registrant_name_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_registrant_name_value_1": {
                                      "runAfter": {
                                        "Set_registrant_name_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_Redirect_Domain_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_registrant_name_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_name_value",
                                          "value": "@items('Results_Loop')?['registrant_name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_registrant_org_Count": {
                                  "actions": {
                                    "Set_registrant_org_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrant_org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrant_org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "Set_registrant_org_value_1": {
                                      "runAfter": {
                                        "Set_registrant_org_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrant_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_registrant_name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_registrant_org_value_2": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "registrant_org_value",
                                          "value": "@items('Results_Loop')?['registrant_org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['registrant_org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['registrant_org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_City_Count": {
                                  "actions": {
                                    "Set_technical_Contact_City_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['city']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['city']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_city_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_City_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_city_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Street_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_city_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_city_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['city']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['city']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['city']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Country_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Country_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['country']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['country']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_country_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Country_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_country_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Postal_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_country_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_country_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['country']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['country']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['country']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Fax_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Fax_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['fax']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['fax']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_fax_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Fax_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_fax_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Phone_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_fax_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_fax_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['fax']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['fax']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['fax']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Name_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Name_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['name']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['name']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_name_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Name_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_name_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Technical_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_name_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_name_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['name']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['name']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['name']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Org_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Org_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['org']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['org']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_org_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Org_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_org_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Name_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_org_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_org_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['org']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['org']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['org']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Phone_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Phone_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['phone']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['phone']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_phone_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Phone_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_phone_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Country_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_phone_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_phone_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['phone']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['phone']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['phone']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Postal_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Postal_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['postal']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['postal']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_postal_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Postal_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_postal_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_State_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_postal_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_postal_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['postal']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['postal']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['postal']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_State_Count": {
                                  "actions": {
                                    "Set_technical_Contact_State_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['state']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['state']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_state_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_State_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_state_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_City_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_state_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_state_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['state']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['state']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['state']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Check_technical_Contact_Street_Count": {
                                  "actions": {
                                    "Set_technical_Contact_Street_Count_link_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "count_url_link_03",
                                        "value": "@{concat(concat(concat(concat(items('Results_Loop')?['technical_contact']?['street']?['value'],variables('count_url_end_03')),items('Results_Loop')?['technical_contact']?['street']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                      }
                                    },
                                    "set_technical_contact_street_value_with_link": {
                                      "runAfter": {
                                        "Set_technical_Contact_Street_Count_link_3": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "technical_contact_street_value",
                                        "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Check_technical_Contact_Org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "set_technical_contact_street_value_without_link": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "technical_contact_street_value",
                                          "value": "@items('Results_Loop')?['technical_contact']?['street']?['value']"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@items('Results_Loop')?['technical_contact']?['street']?['count']",
                                          1
                                        ]
                                      },
                                      {
                                        "lessOrEquals": [
                                          "@items('Results_Loop')?['technical_contact']?['street']?['count']",
                                          "@variables('max_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition": {
                                  "actions": {
                                    "Check_registrar_Count": {
                                      "actions": {
                                        "Set_registrar_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('Results_Loop')?['registrar']?['value'],variables('count_url_end_03')),items('Results_Loop')?['registrar']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_registrar_value_1": {
                                          "runAfter": {
                                            "Set_registrar_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "registrar_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_registrar_value_2": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "registrar_value",
                                              "value": "@items('Results_Loop')?['registrar']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('Results_Loop')?['registrar']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('Results_Loop')?['registrar']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Set_variable_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(variables('registrar_value'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Domain_Risk_Score_Components_Table": {
                                  "runAfter": {
                                    "Domain_detailts_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@items('Results_Loop')?['domain_risk']?['components']"
                                  }
                                },
                                "Domain_detailts_Table": {
                                  "runAfter": {
                                    "Append_to_miscellaneous_array_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('domain_details_array')"
                                  }
                                },
                                "For_Each_Email_Domain": {
                                  "foreach": "@items('Results_Loop')['email_domain']",
                                  "actions": {
                                    "Check_Email_Domain_Count": {
                                      "actions": {
                                        "Append_to_email_domains_variable_1": {
                                          "runAfter": {
                                            "Set_email_domains_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "email_domains",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_email_domains_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_Each_Email_Domain')?['value'],variables('count_url_end_03')),items('For_Each_Email_Domain')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_email_domains_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "email_domains",
                                              "value": "@{items('For_Each_Email_Domain')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_Each_Email_Domain')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_Each_Email_Domain')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_email_domain_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Admin_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['admin_contact']['email']",
                                  "actions": {
                                    "Check_Admin_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_admin_contact_email": {
                                          "runAfter": {
                                            "Set_Admin_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "admin_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Admin_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Admin_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Admin_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_admin_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "admin_contact_email",
                                              "value": "@{items('For_each_Admin_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Admin_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Admin_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to__Domain_Details_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Billing_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['billing_contact']['email']",
                                  "actions": {
                                    "Check_Billing_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_billing_contact_email": {
                                          "runAfter": {
                                            "Set_Billing_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "billing_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Billing_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Billing_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Billing_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_billing_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "billing_contact_email",
                                              "value": "@{items('For_each_Billing_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Billing_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Billing_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_admin_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Name_Server": {
                                  "foreach": "@items('Results_Loop')['name_server']",
                                  "actions": {
                                    "Append_to_array_variable": {
                                      "runAfter": {
                                        "Name_Server_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "nameservers",
                                        "value": "@outputs('Name_Server_Compose')"
                                      }
                                    },
                                    "Check_Nameserver_Domain": {
                                      "actions": {
                                        "Set_Nameserver_Domain_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Name_Server')?['domain']?['value'],variables('count_url_end_03')),items('For_each_Name_Server')?['domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_nameserver_domain_with_link": {
                                          "runAfter": {
                                            "Set_Nameserver_Domain_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "name_server_domain_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_namer_server_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_nameserver_domain_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "name_server_domain_value",
                                              "value": "@items('For_each_Name_Server')?['domain']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Name_Server')?['domain']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Name_Server')?['domain']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_Nameserver_Host": {
                                      "actions": {
                                        "Set_nameserver_host_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Name_Server')?['host']?['value'],variables('count_url_end_03')),items('For_each_Name_Server')?['host']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_namserver_host_with_link": {
                                          "runAfter": {
                                            "Set_nameserver_host_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "name_server_host_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_Nameserver_Domain": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "set_nameserver_host_value_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "name_server_host_value",
                                              "value": "@{items('For_each_Name_Server')?['host']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Name_Server')?['host']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Name_Server')?['host']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_namer_server_ip": {
                                      "foreach": "@items('For_each_Name_Server')['ip']",
                                      "actions": {
                                        "Check_Nameserver_IP_Count": {
                                          "actions": {
                                            "Append_to_name_server_ips_variable_with_link": {
                                              "runAfter": {
                                                "Set_NS_ips_link_3": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToStringVariable",
                                              "inputs": {
                                                "name": "name_server_ip_value",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_NS_ips_link_3": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_namer_server_ip')?['value'],variables('count_url_end_03')),items('For_each_namer_server_ip')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_name_server_ips_variable_without_link": {
                                                "type": "SetVariable",
                                                "inputs": {
                                                  "name": "name_server_ip_value",
                                                  "value": "@{items('For_each_namer_server_ip')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_namer_server_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_namer_server_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_name_server_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "Name_Server_Compose": {
                                      "runAfter": {
                                        "Check_Nameserver_Host": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "Nameserver Domain": "@variables('name_server_domain_value')",
                                        "Nameserver Host": "@variables('name_server_host_value')",
                                        "Nameserver IPs": "@substring(variables('name_server_ip_value'),0,sub(length(variables('name_server_ip_value')),1))"
                                      }
                                    },
                                    "Set_name_server_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "name_server_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_mx": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Registrant_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['registrant_contact']['email']",
                                  "actions": {
                                    "Check_Registrant_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_registrant_contact_email": {
                                          "runAfter": {
                                            "Set_Registrant_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "registrant_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Registrant_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Registrant_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Registrant_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_registrant_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "registrant_contact_email",
                                              "value": "@{items('For_each_Registrant_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Registrant_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Registrant_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_billing_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SOA_Email": {
                                  "foreach": "@items('Results_Loop')['soa_email']",
                                  "actions": {
                                    "Check_SOA_Email_Count": {
                                      "actions": {
                                        "Append_to_soa_email_variable_1": {
                                          "runAfter": {
                                            "Set_soa_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "soa_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_soa_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_SOA_Email')?['value'],variables('count_url_end_03')),items('For_each_SOA_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_soa_email_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "soa_emails",
                                              "value": "@{items('For_each_SOA_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_SOA_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_SOA_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_soa_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SSL_Email": {
                                  "foreach": "@items('Results_Loop')['ssl_email']",
                                  "actions": {
                                    "Check_SSL_Email_Count": {
                                      "actions": {
                                        "Append_to_SSL_Email_array_variable_1": {
                                          "runAfter": {
                                            "Set_ssl_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "ssl_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_ssl_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_SSL_Email')?['value'],variables('count_url_end_03')),items('For_each_SSL_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_SSL_Email_array_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "ssl_emails",
                                              "value": "@{items('For_each_SSL_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_SSL_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_SSL_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Tags": {
                                  "foreach": "@items('Results_Loop')?['tags']",
                                  "actions": {
                                    "Append_to_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "tags",
                                        "value": "@{items('For_each_Tags')?['label']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_adddtional_whois_email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Technical_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['technical_contact']['email']",
                                  "actions": {
                                    "Check_Technical_Contact_Email_Count": {
                                      "actions": {
                                        "Append_to_technical_contact_email": {
                                          "runAfter": {
                                            "Set_Technical_Contact_Email_Count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "technical_contact_email",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Technical_Contact_Email_Count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_Technical_Contact_Email')?['value'],variables('count_url_end_03')),items('For_each_Technical_Contact_Email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_to_technical_contact_email_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "technical_contact_email",
                                              "value": "@{items('For_each_Technical_Contact_Email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_Technical_Contact_Email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_Technical_Contact_Email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_registrant_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_adddtional_whois_email": {
                                  "foreach": "@items('Results_Loop')['additional_whois_email']",
                                  "actions": {
                                    "Check_Additional_Email_Count": {
                                      "actions": {
                                        "Append_toadddtional_whois_email_variable_1": {
                                          "runAfter": {
                                            "Set_Additional_emails_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "additional_whois_emails",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                          }
                                        },
                                        "Set_Additional_emails_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_adddtional_whois_email')?['value'],variables('count_url_end_03')),items('For_each_adddtional_whois_email')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Append_toadddtional_whois_email_variable_2": {
                                            "type": "AppendToStringVariable",
                                            "inputs": {
                                              "name": "additional_whois_emails",
                                              "value": "@{items('For_each_adddtional_whois_email')?['value']},"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_adddtional_whois_email')?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_adddtional_whois_email')?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    }
                                  },
                                  "runAfter": {
                                    "set_additonal_whois_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ip": {
                                  "foreach": "@items('Results_Loop')['ip']",
                                  "actions": {
                                    "Append_to_ips_array_variable": {
                                      "runAfter": {
                                        "IP_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ips",
                                        "value": "@outputs('IP_Compose')"
                                      }
                                    },
                                    "Check_IP_Address_Count": {
                                      "actions": {
                                        "Set_IP_address_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_address_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['address']?['value'],variables('count_url_end_03')),items('For_each_ip')?['address']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_IP_Asn": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_address_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_address_value",
                                              "value": "@items('For_each_ip')?['address']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['address']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['address']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_IP_Address_Country_Count": {
                                      "actions": {
                                        "Set_IP_Address_Country_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_country_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_country_code_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_country_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['country_code']?['value'],variables('count_url_end_03')),items('For_each_ip')?['country_code']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_IP_Address_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_Address_Country_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_country_code_value",
                                              "value": "@items('For_each_ip')?['country_code']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['country_code']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['country_code']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_IP_Address_ISP_Count": {
                                      "actions": {
                                        "Set_IP_Address_ISP_value_01": {
                                          "runAfter": {
                                            "Set_ip_address_isp_count_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ip_isp_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ip_address_isp_count_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ip')?['isp']?['value'],variables('count_url_end_03')),items('For_each_ip')?['isp']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_IP_Address_Country_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_IP_Address_ISP_value_02": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ip_isp_value",
                                              "value": "@items('For_each_ip')?['isp']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ip')?['isp']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ip')?['isp']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_IP_Asn": {
                                      "foreach": "@items('For_each_ip')['asn']",
                                      "actions": {
                                        "Check_for_IP_ASN_Count": {
                                          "actions": {
                                            "Append_to_ips_asn_variable_1": {
                                              "runAfter": {
                                                "Set_ip_asn_link_03": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToStringVariable",
                                              "inputs": {
                                                "name": "ips_asns",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_ip_asn_link_03": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_IP_Asn')?['value'],variables('count_url_end_03')),items('For_each_IP_Asn')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_ips_asn_variable_2": {
                                                "type": "AppendToStringVariable",
                                                "inputs": {
                                                  "name": "ips_asns",
                                                  "value": "@{items('For_each_IP_Asn')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_IP_Asn')?['count']",
                                                  1
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_IP_Asn')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_ips_asn_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "IP_Compose": {
                                      "runAfter": {
                                        "Check_IP_Address_ISP_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "IP ASN": "@substring(variables('ips_asns'),0,sub(length(variables('ips_asns')),1))",
                                        "IP Address": "@variables('ip_address_value')",
                                        "IP Country Code": "@variables('ip_country_code_value')",
                                        "IP ISP": "@variables('ip_isp_value')"
                                      }
                                    },
                                    "Set_ips_asn_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ips_asns",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_techinical_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_mx": {
                                  "foreach": "@items('Results_Loop')['mx']",
                                  "actions": {
                                    "Append_to_mxs_array_variable": {
                                      "runAfter": {
                                        "MX_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "mxs",
                                        "value": "@outputs('MX_Compose')"
                                      }
                                    },
                                    "Check_MX_Domain_Count": {
                                      "actions": {
                                        "Set_Mx_domain_value_with_link": {
                                          "runAfter": {
                                            "Set_vmx_domain_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "mx_domain_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_vmx_domain_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_mx')?['domain']?['value'],variables('count_url_end_03')),items('For_each_mx')?['domain']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "For_each_Mx_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_Mx_domain_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "mx_domain_value",
                                              "value": "@items('For_each_mx')?['domain']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_mx')?['domain']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_mx')?['domain']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_MX_Host_Count": {
                                      "actions": {
                                        "Set_Mx_host_value_with_link": {
                                          "runAfter": {
                                            "Set_mx_host_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "mx_host_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_mx_host_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_mx')?['host']?['value'],variables('count_url_end_03')),items('For_each_mx')?['host']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_MX_Domain_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_Mx_host_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "mx_host_value",
                                              "value": "@items('For_each_mx')?['host']?['value']"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_mx')?['host']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_mx')?['host']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "For_each_Mx_ip": {
                                      "foreach": "@items('For_each_mx')['ip']",
                                      "actions": {
                                        "Check_MX_IP_Count": {
                                          "actions": {
                                            "Append_to_mx_ips_variable_1": {
                                              "runAfter": {
                                                "Set_mx_ips_link_3": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "mx_ips",
                                                "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))},"
                                              }
                                            },
                                            "Set_mx_ips_link_3": {
                                              "type": "SetVariable",
                                              "inputs": {
                                                "name": "count_url_link_03",
                                                "value": "@{concat(concat(concat(concat(items('For_each_Mx_ip')?['value'],variables('count_url_end_03')),items('For_each_Mx_ip')?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_mx_ips_variable_2": {
                                                "type": "AppendToStringVariable",
                                                "inputs": {
                                                  "name": "mx_ips",
                                                  "value": "@{items('For_each_Mx_ip')?['value']},"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "greater": [
                                                  "@items('For_each_Mx_ip')?['count']",
                                                  1
                                                ]
                                              },
                                              {
                                                "lessOrEquals": [
                                                  "@items('For_each_Mx_ip')?['count']",
                                                  "@variables('max_count')"
                                                ]
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "runAfter": {
                                        "Set_mx_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "MX_Compose": {
                                      "runAfter": {
                                        "Check_MX_Host_Count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "MX Domain": "@variables('mx_domain_value')",
                                        "MX Host": "@variables('mx_host_value')",
                                        "MX IP": "@substring(variables('mx_ips'),0,sub(length(variables('mx_ips')),1))",
                                        "MX Priority": "@items('For_each_mx')?['priority']"
                                      }
                                    },
                                    "Set_mx_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_registrar_status": {
                                  "foreach": "@items('Results_Loop')?['registrar_status']",
                                  "actions": {
                                    "Append_to_registrar_status_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrar_status",
                                        "value": "@{items('For_each_registrar_status')},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Tags_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ssl_info": {
                                  "foreach": "@items('Results_Loop')?['ssl_info']",
                                  "actions": {
                                    "Append_to_ssl_info_array_variable": {
                                      "runAfter": {
                                        "SSL_Info_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ssl_info",
                                        "value": "@outputs('SSL_Info_Compose')"
                                      }
                                    },
                                    "Check_Ssl_info_hash_count": {
                                      "actions": {
                                        "Set_ssl_info_hash_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['hash']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['hash']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_ssl_info_hash_value_with_link": {
                                          "runAfter": {
                                            "Set_ssl_info_hash_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_hash_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_info_hash_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_hash_value",
                                              "value": "@{items('For_each_ssl_info')?['hash']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['hash']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['hash']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_ssl_info_org_count": {
                                      "actions": {
                                        "Set_ssl_org_with_count_link": {
                                          "runAfter": {
                                            "Set_ssl_org_with_link": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_organization_value",
                                            "value": "@{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        },
                                        "Set_ssl_org_with_link": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['organization']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['organization']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_ssl_info_subject_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_org_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_organization_value",
                                              "value": "@{items('For_each_ssl_info')?['organization']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['organization']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['organization']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "Check_ssl_info_subject_count": {
                                      "actions": {
                                        "Set_ssl_info_subject_link_3": {
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "count_url_link_03",
                                            "value": "@{concat(concat(concat(concat(items('For_each_ssl_info')?['subject']?['value'],variables('count_url_end_03')),items('For_each_ssl_info')?['subject']?['count']),variables('count_url_end_04')),variables('count_url_end_02'))}"
                                          }
                                        },
                                        "Set_ssl_info_subject_with_link": {
                                          "runAfter": {
                                            "Set_ssl_info_subject_link_3": [
                                              "Succeeded"
                                            ]
                                          },
                                          "type": "SetVariable",
                                          "inputs": {
                                            "name": "ssl_info_subject_value",
                                            "value": " @{concat(variables('count_url_link_02'),variables('count_url_link_03'))}"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Check_Ssl_info_hash_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "else": {
                                        "actions": {
                                          "Set_ssl_info_subject_without_link": {
                                            "type": "SetVariable",
                                            "inputs": {
                                              "name": "ssl_info_subject_value",
                                              "value": "@{items('For_each_ssl_info')?['subject']?['value']}"
                                            }
                                          }
                                        }
                                      },
                                      "expression": {
                                        "and": [
                                          {
                                            "greater": [
                                              "@items('For_each_ssl_info')?['subject']?['count']",
                                              1
                                            ]
                                          },
                                          {
                                            "lessOrEquals": [
                                              "@items('For_each_ssl_info')?['subject']?['count']",
                                              "@variables('max_count')"
                                            ]
                                          }
                                        ]
                                      },
                                      "type": "If"
                                    },
                                    "SSL_Info_Compose": {
                                      "runAfter": {
                                        "Check_ssl_info_org_count": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "SSL Info Hash": "@variables('ssl_info_hash_value')",
                                        "SSL Info Organization": "@variables('ssl_info_organization_value')",
                                        "SSL Info Subject": "@variables('ssl_info_subject_value')"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_Name_Server": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "IP_Table": {
                                  "runAfter": {
                                    "miscellaneouos_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ips')"
                                  }
                                },
                                "MX_Table": {
                                  "runAfter": {
                                    "IP_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('mxs')"
                                  }
                                },
                                "Miscellaneous_Compose": {
                                  "runAfter": {
                                    "For_each_Tags": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Additional Whois Emails": "@substring(variables('additional_whois_emails'),0,sub(length(variables('additional_whois_emails')),1))",
                                    "Email Domains": "@substring(variables('email_domains'),0,sub(length(variables('email_domains')),1))",
                                    "SOA Emails": "@substring(variables('soa_emails'),0,sub(length(variables('soa_emails')),1))",
                                    "SSL Emails": "@substring(variables('ssl_emails'),0,sub(length(variables('ssl_emails')),1))",
                                    "Tags": "@substring(variables('tags'),0,sub(length(variables('tags')),1))"
                                  }
                                },
                                "Nameserver_Table": {
                                  "runAfter": {
                                    "MX_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('nameservers')"
                                  }
                                },
                                "Registrant_Contact_Compose": {
                                  "runAfter": {
                                    "Check_Registrant_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Registrant Contact City": "@variables('registrant_contact_city_value')",
                                    "Registrant Contact Country": "@variables('registrant_contact_country_value')",
                                    "Registrant Contact Email": "@substring(variables('registrant_contact_email'),0,sub(length(variables('registrant_contact_email')),1))",
                                    "Registrant Contact Fax": "@variables('registrant_contact_fax_value')",
                                    "Registrant Contact Name": "@variables('registrant_contact_name_value')",
                                    "Registrant Contact Org": "@variables('registrant_contact_org_value')",
                                    "Registrant Contact Phone": "@variables('registrant_contact_phone_value')",
                                    "Registrant Contact Postal": "@variables('registrant_contact_postal_value')",
                                    "Registrant Contact State": "@variables('registrant_contact_state_value')",
                                    "Registrant Contact Street": "@variables('registrant_contact_street_value')"
                                  }
                                },
                                "Registrant_Contact_Table": {
                                  "runAfter": {
                                    "Billing_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('registrant_contact_details')"
                                  }
                                },
                                "SSL_Info_Table": {
                                  "runAfter": {
                                    "Nameserver_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ssl_info')"
                                  }
                                },
                                "Set_Admin_Contact_to_Empty": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Billing_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Billing_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Set_Admin_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Domain_Details_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Registrant_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Registrant_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Set_Admin_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_count_url_link_3_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Tags_to_Empty": {
                                  "runAfter": {
                                    "Set_registrar_status_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "tags",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_count_url_link_1": {
                                  "runAfter": {
                                    "For_each_registrar_status": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_01",
                                    "value": "@{concat(variables('count_url_01'),variables('domain_name'))}"
                                  }
                                },
                                "Set_count_url_link_1_to_empty": {
                                  "runAfter": {
                                    "Set_Admin_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_01",
                                    "value": " "
                                  }
                                },
                                "Set_count_url_link_2": {
                                  "runAfter": {
                                    "Set_count_url_link_1": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_02",
                                    "value": "@{concat(variables('count_url_link_01'),variables('count_url_end_01'))}"
                                  }
                                },
                                "Set_count_url_link_3_to_empty": {
                                  "runAfter": {
                                    "Set_count_url_link_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_03",
                                    "value": " "
                                  }
                                },
                                "Set_count_url_link_to_empty": {
                                  "runAfter": {
                                    "Set_count_url_link_1_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "count_url_link_02",
                                    "value": " "
                                  }
                                },
                                "Set_ips_variable_to_empty": {
                                  "runAfter": {
                                    "Set_miscellaneous_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ips",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_miscellaneous_to_empty": {
                                  "runAfter": {
                                    "Set_Domain_Details_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_mxs_variable_to_empty": {
                                  "runAfter": {
                                    "Set_ips_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "mxs",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_nameservers_variable_to_empty": {
                                  "runAfter": {
                                    "Set_mxs_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "nameservers",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_registrar_status_to_empty": {
                                  "runAfter": {
                                    "Set_ssl_info_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_status",
                                    "value": " "
                                  }
                                },
                                "Set_ssl_info_variable_to_empty": {
                                  "runAfter": {
                                    "Set_nameservers_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_info",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_variable_2": {
                                  "runAfter": {
                                    "Check_registrant_org_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_value",
                                    "value": "@{items('Results_Loop')?['registrar']}"
                                  }
                                },
                                "Technical_Contact_Compose": {
                                  "runAfter": {
                                    "Check_technical_Contact_Fax_Count": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Technical Contact City": "@variables('technical_contact_city_value')",
                                    "Technical Contact Country": "@variables('technical_contact_country_value')",
                                    "Technical Contact Email": "@substring(variables('technical_contact_email'),0,sub(length(variables('technical_contact_email')),1))",
                                    "Technical Contact Fax": "@variables('technical_contact_fax_value')",
                                    "Technical Contact Name": "@variables('technical_contact_name_value')",
                                    "Technical Contact Org": "@variables('technical_contact_org_value')",
                                    "Technical Contact Phone": "@variables('technical_contact_phone_value')",
                                    "Technical Contact Postal": "@variables('technical_contact_postal_value')",
                                    "Technical Contact State": "@variables('technical_contact_state_value')",
                                    "Technical Contact Street": "@variables('technical_contact_street_value')"
                                  }
                                },
                                "Technical_Contact_Table": {
                                  "runAfter": {
                                    "Registrant_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('technical_contact_details')"
                                  }
                                },
                                "_Domain_Details_Compose": {
                                  "runAfter": {
                                    "Condition": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Active": "@items('Results_Loop')?['active']",
                                    "Adsense": "@variables('adsense_value')",
                                    "Alexa": "@items('Results_Loop')?['alexa']",
                                    "Create Date": "@variables('create_date_value')",
                                    "Data Updated Timestsamap": "@items('Results_Loop')?['data_updated_timestamp']",
                                    "Domain": "@items('Results_Loop')?['domain']",
                                    "Expiration Date": "@variables('expiration_date_value')",
                                    "Google Analytics": "@items('Results_Loop')?['google_analytics']?['value']",
                                    "Redirect": "@variables('redirect_value')",
                                    "Redirect Domain": "@variables('redirect_domain_value')",
                                    "Registrant Name": "@variables('registrant_name_value')",
                                    "Registrant Org": "@variables('registrant_org_value')",
                                    "Registrar": "@variables('registrar_value')",
                                    "Registrar Status": "@substring(variables('registrar_status'),0,sub(length(variables('registrar_status')),1))",
                                    "Risk Score": "@items('Results_Loop')?['domain_risk']?['risk_score']",
                                    "SPF Info": "@items('Results_Loop')?['spf_info']",
                                    "TLD": "@items('Results_Loop')?['tld']",
                                    "Website Response": "@items('Results_Loop')?['website_response']",
                                    "Whois URL": "@items('Results_Loop')?['whois_url']"
                                  }
                                },
                                "miscellaneouos_Table": {
                                  "runAfter": {
                                    "Domain_Risk_Score_Components_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('Miscellaneous')"
                                  }
                                },
                                "set_additonal_whois_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SSL_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "additional_whois_emails",
                                    "value": " "
                                  }
                                },
                                "set_email_domain_to_empty": {
                                  "runAfter": {
                                    "For_each_ssl_info": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email_domains",
                                    "value": " "
                                  }
                                },
                                "set_soa_email_to_empty": {
                                  "runAfter": {
                                    "For_Each_Email_Domain": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "soa_emails",
                                    "value": " "
                                  }
                                },
                                "set_ssl_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SOA_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_emails",
                                    "value": " "
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p>No results found for @{variables('domain_name')}</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Investigate_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Compose": {
                          "type": "Compose",
                          "inputs": {
                            "url": "@items('For_each')?['Url']"
                          }
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "SET_Domain": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "SET_Domain": {
                          "runAfter": {
                            "ExtractDomainFromUrl": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "domain_name",
                            "value": "@{body('ExtractDomainFromUrl')}"
                          }
                        },
                        "ExtractDomainFromUrl": {
                          "runAfter": {
                            "Compose": [
                              "Succeeded"
                            ]
                          },
                          "type": "Function",
                          "inputs": {
                            "body": "@outputs('Compose')",
                            "function": {
                              "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/resourceGroups/', resourceGroup().name, '/providers/Microsoft.Web/sites/', variables('Functionappname'), '/functions/ExtractDomainFromUrl ')]"
                            }
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_URLs": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "MAX_COUNT_": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "max_count",
                            "type": "integer",
                            "value": "@parameters('Pivot Threshold')"
                          }
                        ]
                      }
                    },
                    "Miscellaneous_variable": {
                      "runAfter": {
                        "registrar_status_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Miscellaneous",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "URL_Variable": {
                      "runAfter": {
                        "MAX_COUNT_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "url",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "additional_whois_email": {
                      "runAfter": {
                        "ssl_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "additional_whois_email_value": {
                      "runAfter": {
                        "ssl_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_city_value": {
                      "runAfter": {
                        "admin_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_country_value": {
                      "runAfter": {
                        "admin_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_details_variable": {
                      "runAfter": {
                        "domain_details_array_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_value": {
                      "runAfter": {
                        "admin_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_variable": {
                      "runAfter": {
                        "admin_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_fax_value": {
                      "runAfter": {
                        "admin_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_name_value": {
                      "runAfter": {
                        "google_analytics_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_org_value": {
                      "runAfter": {
                        "admin_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_phone_value": {
                      "runAfter": {
                        "admin_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_postal_value": {
                      "runAfter": {
                        "admin_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_state_value": {
                      "runAfter": {
                        "admin_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_street_value": {
                      "runAfter": {
                        "admin_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "adsense_value": {
                      "runAfter": {
                        "nameservers_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "adsense_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_city_value": {
                      "runAfter": {
                        "billing_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_country_value": {
                      "runAfter": {
                        "billing_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_details_variable": {
                      "runAfter": {
                        "admin_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_value": {
                      "runAfter": {
                        "billing_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_variable": {
                      "runAfter": {
                        "billing_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_fax_value": {
                      "runAfter": {
                        "billing_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_name_value": {
                      "runAfter": {
                        "admin_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_org_value": {
                      "runAfter": {
                        "billing_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_phone_value": {
                      "runAfter": {
                        "billing_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_postal_value": {
                      "runAfter": {
                        "billing_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_state_value": {
                      "runAfter": {
                        "billing_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_street_value": {
                      "runAfter": {
                        "billing_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_01": {
                      "runAfter": {
                        "ssl_info_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_01",
                            "type": "string",
                            "value": "<a href=https://research.domaintools.com/iris/search/?q="
                          }
                        ]
                      }
                    },
                    "count_url_end_01": {
                      "runAfter": {
                        "count_url_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_01",
                            "type": "string",
                            "value": ">"
                          }
                        ]
                      }
                    },
                    "count_url_end_02": {
                      "runAfter": {
                        "count_url_end_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_02",
                            "type": "string",
                            "value": "</a>"
                          }
                        ]
                      }
                    },
                    "count_url_end_03": {
                      "runAfter": {
                        "count_url_end_02": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_03",
                            "type": "string",
                            "value": "("
                          }
                        ]
                      }
                    },
                    "count_url_end_04": {
                      "runAfter": {
                        "count_url_end_03": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_end_04",
                            "type": "string",
                            "value": ")"
                          }
                        ]
                      }
                    },
                    "count_url_link_01": {
                      "runAfter": {
                        "count_url_end_04": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_01",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_link_02": {
                      "runAfter": {
                        "count_url_link_01": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_02",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "count_url_link_03": {
                      "runAfter": {
                        "count_url_link_02": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "count_url_link_03",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "create_date_value": {
                      "runAfter": {
                        "technical_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "create_date_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "domain_details_array_variable": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_details_array",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "email_domain_value": {
                      "runAfter": {
                        "expiration_date_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "email_domains": {
                      "runAfter": {
                        "technical_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domains",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "expiration_date_value": {
                      "runAfter": {
                        "create_date_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "expiration_date_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "google_analytics_value": {
                      "runAfter": {
                        "adsense_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "google_analytics_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_address_value": {
                      "runAfter": {
                        "additional_whois_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_address_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_asn_value": {
                      "runAfter": {
                        "ip_address_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_asn_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_country_code_value": {
                      "runAfter": {
                        "ip_asn_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_country_code_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ip_isp_value": {
                      "runAfter": {
                        "ip_country_code_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ip_isp_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_asns_": {
                      "runAfter": {
                        "additional_whois_email": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips_asns",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_variable": {
                      "runAfter": {
                        "Miscellaneous_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_domain_value": {
                      "runAfter": {
                        "mx_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_host_value": {
                      "runAfter": {
                        "ip_isp_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_ip_count": {
                      "runAfter": {
                        "mx_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_count",
                            "type": "integer"
                          }
                        ]
                      }
                    },
                    "mx_ip_value": {
                      "runAfter": {
                        "mx_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mx_ips": {
                      "runAfter": {
                        "ips_asns_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mxs_variable": {
                      "runAfter": {
                        "ips_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mxs",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "name_server_domain_value": {
                      "runAfter": {
                        "name_server_host_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_host_value": {
                      "runAfter": {
                        "mx_ip_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_host_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_ip_value": {
                      "runAfter": {
                        "name_server_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ip_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "name_server_ips": {
                      "runAfter": {
                        "mx_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameservers_variable": {
                      "runAfter": {
                        "mxs_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameservers",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "redirect_domain_value": {
                      "runAfter": {
                        "redirect_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "redirect_domain_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "redirect_value": {
                      "runAfter": {
                        "name_server_ip_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "redirect_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_city_value": {
                      "runAfter": {
                        "registrant_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_country_value": {
                      "runAfter": {
                        "registrant_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_details_variable": {
                      "runAfter": {
                        "billing_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_value": {
                      "runAfter": {
                        "registrant_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_variable": {
                      "runAfter": {
                        "registrant_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_fax_value": {
                      "runAfter": {
                        "registrant_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_name_value": {
                      "runAfter": {
                        "billing_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_org_value": {
                      "runAfter": {
                        "registrant_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_phone_value": {
                      "runAfter": {
                        "registrant_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_postal_value": {
                      "runAfter": {
                        "registrant_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_state_value": {
                      "runAfter": {
                        "registrant_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_contact_street_value": {
                      "runAfter": {
                        "registrant_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_name_value": {
                      "runAfter": {
                        "redirect_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrant_org_value": {
                      "runAfter": {
                        "registrant_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_status_variable": {
                      "runAfter": {
                        "tags_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_status",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_value": {
                      "runAfter": {
                        "registrant_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_email_value": {
                      "runAfter": {
                        "email_domain_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_emails": {
                      "runAfter": {
                        "email_domains": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_email_value": {
                      "runAfter": {
                        "soa_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_emails": {
                      "runAfter": {
                        "soa_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_array": {
                      "runAfter": {
                        "name_server_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "ssl_info_email_value": {
                      "runAfter": {
                        "ssl_info_organization_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_hash_value": {
                      "runAfter": {
                        "registrar_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_hash_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_organization_value": {
                      "runAfter": {
                        "ssl_info_subject_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_organization_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_subject_value": {
                      "runAfter": {
                        "ssl_info_hash_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info_subject_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "tags_variable": {
                      "runAfter": {
                        "ssl_info_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tags",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_city_value": {
                      "runAfter": {
                        "technical_contact_street_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_city_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_country_value": {
                      "runAfter": {
                        "technical_contact_postal_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_country_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_details_variable": {
                      "runAfter": {
                        "registrant_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_value": {
                      "runAfter": {
                        "technical_contact_fax_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_variable": {
                      "runAfter": {
                        "technical_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_fax_value": {
                      "runAfter": {
                        "technical_contact_phone_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_fax_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_name_value": {
                      "runAfter": {
                        "registrant_contact_email_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_name_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_org_value": {
                      "runAfter": {
                        "technical_contact_name_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_org_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_phone_value": {
                      "runAfter": {
                        "technical_contact_country_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_phone_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_postal_value": {
                      "runAfter": {
                        "technical_contact_state_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_postal_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_state_value": {
                      "runAfter": {
                        "technical_contact_city_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_state_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_street_value": {
                      "runAfter": {
                        "technical_contact_org_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_street_value",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId7'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId7')]",
                "contentId": "[variables('_playbookContentId7')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion7')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "kind": "AzureFunction",
                      "contentId": "[variables('_DomainToolsFunctionApp')]",
                      "version": "[variables('playbookVersion1')]"
                    }
                  ]
                }
              }
            }
          ],
          "metadata": {
            "title": "URL Enrichment- DomainTools Iris Investigate",
            "description": "Given a URL or set of URLs associated with an incident return all Iris Investigate data for the extracted domains from the URL as comments in the incident.",
            "prerequisites": "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "url"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId7')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-URL_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId7')]",
        "id": "[variables('_playbookcontentProductId7')]",
        "version": "[variables('playbookVersion7')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('playbookTemplateSpecName8')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook Playbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('playbookVersion8')]",
          "parameters": {
            "PlaybookName": {
              "defaultValue": "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook",
              "type": "string"
            },
            "UserName": {
              "defaultValue": "<username>@<domain>",
              "type": "string"
            }
          },
          "variables": {
            "DomainToolsApiKey": "[[concat('domaintoolsirisinves-', parameters('PlaybookName'))]",
            "FarsightDNSDBApiKey": "[[concat('farsightdnsdb-', parameters('PlaybookName'))]",
            "AzureSentinelConnectionName": "[[concat('azuresentinel-', parameters('PlaybookName'))]",
            "connection-1": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
            "_connection-1": "[[variables('connection-1')]",
            "connection-2": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]",
            "_connection-2": "[[variables('connection-2')]",
            "connection-3": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]",
            "_connection-3": "[[variables('connection-3')]",
            "workspace-location-inline": "[concat('[resourceGroup().locatio', 'n]')]",
            "workspace-name": "[parameters('workspace')]",
            "workspaceResourceId": "[[resourceId('microsoft.OperationalInsights/Workspaces', variables('workspace-name'))]"
          },
          "resources": [
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('AzureSentinelConnectionName')]",
              "location": "[[variables('workspace-location-inline')]",
              "kind": "V1",
              "properties": {
                "displayName": "[[variables('AzureSentinelConnectionName')]",
                "parameterValueType": "Alternative",
                "api": {
                  "id": "[[variables('_connection-1')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('DomainToolsApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-2')]"
                }
              }
            },
            {
              "type": "Microsoft.Web/connections",
              "apiVersion": "2016-06-01",
              "name": "[[variables('FarsightDNSDBApiKey')]",
              "location": "[[variables('workspace-location-inline')]",
              "properties": {
                "displayName": "[[parameters('UserName')]",
                "api": {
                  "id": "[[variables('_connection-3')]"
                }
              }
            },
            {
              "type": "Microsoft.Logic/workflows",
              "apiVersion": "2017-07-01",
              "name": "[[parameters('PlaybookName')]",
              "location": "[[variables('workspace-location-inline')]",
              "identity": {
                "type": "SystemAssigned"
              },
              "dependsOn": [
                "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('FarsightDNSDBApiKey'))]",
                "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]"
              ],
              "properties": {
                "state": "Enabled",
                "definition": {
                  "$schema": "https://schema.management.azure.com/providers/Microsoft.Logic/schemas/2016-06-01/workflowdefinition.json#",
                  "contentVersion": "1.0.0.0",
                  "parameters": {
                    "$connections": {
                      "type": "Object"
                    }
                  },
                  "triggers": {
                    "Microsoft_Sentinel_incident": {
                      "type": "ApiConnectionWebhook",
                      "inputs": {
                        "body": {
                          "callback_url": "@{listCallbackUrl()}"
                        },
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "path": "/incident-creation"
                      }
                    }
                  },
                  "actions": {
                    "DNS_Name_Variable": {
                      "runAfter": {
                        "Host_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dns_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Domain_Name_Variable": {
                      "runAfter": {
                        "DNS_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Entities_-_Get_Hosts": {
                      "runAfter": {
                        "registrar_value": [
                          "Succeeded"
                        ]
                      },
                      "type": "ApiConnection",
                      "inputs": {
                        "body": "@triggerBody()?['object']?['properties']?['relatedEntities']",
                        "host": {
                          "connection": {
                            "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                          }
                        },
                        "method": "post",
                        "path": "/entities/host"
                      }
                    },
                    "For_each_Host": {
                      "foreach": "@body('Entities_-_Get_Hosts')?['Hosts']",
                      "actions": {
                        "Check_DNS_Name_is_empty": {
                          "actions": {
                            "Set_Domain_Name_Variable": {
                              "type": "SetVariable",
                              "inputs": {
                                "name": "domain_name",
                                "value": "@{variables('host_name')}.@{variables('dns_name')}"
                              }
                            }
                          },
                          "runAfter": {
                            "Set_DNS_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Set_variable": {
                                "type": "SetVariable",
                                "inputs": {
                                  "name": "domain_name",
                                  "value": "@variables('host_name')"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "not": {
                                  "equals": [
                                    "@variables('dns_name')",
                                    ""
                                  ]
                                }
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Check_if_results_exists": {
                          "actions": {
                            "Results_Loop": {
                              "foreach": "@body('Investigate_Domain')?['response']?['results']",
                              "actions": {
                                "Add_comment_to_incident_(V3)": {
                                  "runAfter": {
                                    "Condition_2": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "body": {
                                      "incidentArmId": "@triggerBody()?['object']?['id']",
                                      "message": "<p><span style=\"font-size: 16px\"><strong>DomainTools IRIS Investigate response for: </strong></span><span style=\"font-size: 16px\">@{variables('domain_name')}</span><span style=\"font-size: 16px\"></span><br>\n@{body('Domain_detailts_Table')}@{replace(replace(replace(body('Domain_Risk_Score_Components_Table') , '&quot;', ''),']','') , '[', '') }@{body('miscellaneouos_Table')}@{body('IP_Table')}@{body('MX_Table')}@{body('Nameserver_Table')}@{body('Admin_Contact_Table')}@{body('Billing_Contact_Table')}@{body('Registrant_Contact_Table')}@{body('Technical_Contact_Table')}<br>\nFind more details: https://research.domaintools.com/iris/search/?q=@{variables('domain_name')}<br>\n<span style=\"font-size: 16px\"><strong><br>\nFarsight DNSDB RData Reuslts for: </strong></span><span style=\"font-size: 16px\"><strong>@{variables('domain_name')}</strong></span><span style=\"font-size: 16px\"><strong></strong></span><br>\n@{variables('dnsdb_results_string')}<br>\n@{replace(replace(replace(body('DNSDB_Table') , '&quot;', ''),']','') , '[', '')}<br>\nFind more details: https://scout.dnsdb.info/?seed=@{variables('domain_name')}<br>\n<br>\n</p>"
                                    },
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                      }
                                    },
                                    "method": "post",
                                    "path": "/Incidents/Comment"
                                  }
                                },
                                "Admin_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Admin_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Admin Contact City": "@items('Results_Loop')?['admin_contact']?['city']?['value']",
                                    "Admin Contact Country": "@items('Results_Loop')?['admin_contact']?['country']?['value']",
                                    "Admin Contact Email": "@substring(variables('admin_contact_email'),0,sub(length(variables('admin_contact_email')),1))",
                                    "Admin Contact Fax": "@items('Results_Loop')?['admin_contact']?['fax']?['value']",
                                    "Admin Contact Name": "@items('Results_Loop')?['admin_contact']?['name']?['value']",
                                    "Admin Contact Org": "@items('Results_Loop')?['admin_contact']?['org']?['value']",
                                    "Admin Contact Phone": "@items('Results_Loop')?['admin_contact']?['phone']?['value']",
                                    "Admin Contact Postal": "@items('Results_Loop')?['admin_contact']?['postal']?['value']",
                                    "Admin Contact State": "@items('Results_Loop')?['admin_contact']?['state']?['value']",
                                    "Admin Contact Street": "@items('Results_Loop')?['admin_contact']?['street']?['value']"
                                  }
                                },
                                "Admin_Contact_Table": {
                                  "runAfter": {
                                    "Nameserver_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('admin_contact_details')"
                                  }
                                },
                                "Append_to__Domain_Details_array": {
                                  "runAfter": {
                                    "_Domain_Details_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "@outputs('_Domain_Details_Compose')"
                                  }
                                },
                                "Append_to_admin_contact_array": {
                                  "runAfter": {
                                    "Admin_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "@outputs('Admin_Contact_Compose')"
                                  }
                                },
                                "Append_to_billing_contact_array": {
                                  "runAfter": {
                                    "Billing_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "@outputs('Billing_Contact_Compose')"
                                  }
                                },
                                "Append_to_miscellaneous_array_variable": {
                                  "runAfter": {
                                    "Miscellaneous_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "@outputs('Miscellaneous_Compose')"
                                  }
                                },
                                "Append_to_registrant_contact_array": {
                                  "runAfter": {
                                    "Registrant_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "@outputs('Registrant_Contact_Compose')"
                                  }
                                },
                                "Append_to_techinical_contact_array": {
                                  "runAfter": {
                                    "Technical_Contact_Compose": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "AppendToArrayVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "@outputs('Technical_Contact_Compose')"
                                  }
                                },
                                "Billing_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Billing_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Billing Contact City": "@items('Results_Loop')?['billing_contact']?['city']?['value']",
                                    "Billing Contact Country": "@items('Results_Loop')?['billing_contact']?['country']?['value']",
                                    "Billing Contact Email": "@substring(variables('billing_contact_email'),0,sub(length(variables('billing_contact_email')),1))",
                                    "Billing Contact Fax": "@items('Results_Loop')?['billing_contact']?['fax']?['value']",
                                    "Billing Contact Name": "@items('Results_Loop')?['billing_contact']?['name']?['value']",
                                    "Billing Contact Org": "@items('Results_Loop')?['billing_contact']?['org']?['value']",
                                    "Billing Contact Phone": "@items('Results_Loop')?['billing_contact']?['phone']?['value']",
                                    "Billing Contact Postal": "@items('Results_Loop')?['billing_contact']?['postal']?['value']",
                                    "Billing Contact State": "@items('Results_Loop')?['billing_contact']?['state']?['value']",
                                    "Billing Contact Street": "@items('Results_Loop')?['billing_contact']?['street']?['value']"
                                  }
                                },
                                "Billing_Contact_Table": {
                                  "runAfter": {
                                    "Admin_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('billing_contact_details')"
                                  }
                                },
                                "Check_dnsdb_results_exist": {
                                  "actions": {
                                    "For_each": {
                                      "foreach": "@body('RData_Lookup_with_RRType')",
                                      "actions": {
                                        "Condition": {
                                          "actions": {
                                            "Append_to_dnsdb_results": {
                                              "runAfter": {
                                                "dndb_compose_": [
                                                  "Succeeded"
                                                ]
                                              },
                                              "type": "AppendToArrayVariable",
                                              "inputs": {
                                                "name": "dnsdb_rdata_results",
                                                "value": "@outputs('dndb_compose_')"
                                              }
                                            },
                                            "dndb_compose_": {
                                              "type": "Compose",
                                              "inputs": {
                                                "Count": "@items('For_each')?['count']",
                                                "First Seen": "@items('For_each')?['time_first']",
                                                "Last Seen": "@items('For_each')?['time_last']",
                                                "RRName": "@items('For_each')?['rrname']",
                                                "Rdata": "@items('For_each')?['rdata']",
                                                "Record Type": "@items('For_each')?['rrtype']"
                                              }
                                            }
                                          },
                                          "else": {
                                            "actions": {
                                              "Append_to_array_variable_2": {
                                                "runAfter": {
                                                  "dnsdb_compose_2": [
                                                    "Succeeded"
                                                  ]
                                                },
                                                "type": "AppendToArrayVariable",
                                                "inputs": {
                                                  "name": "dnsdb_rdata_results",
                                                  "value": "@outputs('dnsdb_compose_2')"
                                                }
                                              },
                                              "dnsdb_compose_2": {
                                                "type": "Compose",
                                                "inputs": {
                                                  "Count": "@items('For_each')?['count']",
                                                  "First Seen": "@items('For_each')?['zone_time_first']",
                                                  "Last Seen": "@items('For_each')?['zone_time_last']",
                                                  "RRName": "@items('For_each')?['rrname']",
                                                  "Rdata": "@items('For_each')?['rdata']",
                                                  "Record Type": "@items('For_each')?['rrtype']"
                                                }
                                              }
                                            }
                                          },
                                          "expression": {
                                            "and": [
                                              {
                                                "not": {
                                                  "equals": [
                                                    "@items('For_each')?['time_first']",
                                                    "@null"
                                                  ]
                                                }
                                              }
                                            ]
                                          },
                                          "type": "If"
                                        }
                                      },
                                      "type": "Foreach"
                                    }
                                  },
                                  "runAfter": {
                                    "set_dnsdb_results": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(body('RData_Lookup_with_RRType'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_2": {
                                  "actions": {
                                    "Set_variable_2": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "dnsdb_results_string",
                                        "value": "Showing first  @{variables('dnsdb_results_count')}  records "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "DNSDB_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "else": {
                                    "actions": {
                                      "Set_variable_4": {
                                        "type": "SetVariable",
                                        "inputs": {
                                          "name": "dnsdb_results_string",
                                          "value": "No records found"
                                        }
                                      }
                                    }
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greaterOrEquals": [
                                          "@length(variables('dnsdb_rdata_results'))",
                                          "@variables('dnsdb_results_count')"
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "Condition_3": {
                                  "actions": {
                                    "Set_variable_3": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "registrar_value",
                                        "value": "@{items('Results_Loop')?['registrar']?['value']}"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_registrar_value": [
                                      "Succeeded"
                                    ]
                                  },
                                  "expression": {
                                    "and": [
                                      {
                                        "greater": [
                                          "@length(variables('registrar_value'))",
                                          0
                                        ]
                                      }
                                    ]
                                  },
                                  "type": "If"
                                },
                                "DNSDB_Table": {
                                  "runAfter": {
                                    "Check_dnsdb_results_exist": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('dnsdb_rdata_results')"
                                  }
                                },
                                "Domain_Risk_Score_Components_Table": {
                                  "runAfter": {
                                    "Domain_detailts_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@items('Results_Loop')?['domain_risk']?['components']"
                                  }
                                },
                                "Domain_detailts_Table": {
                                  "runAfter": {
                                    "Append_to_miscellaneous_array_variable": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('domain_details_array')"
                                  }
                                },
                                "For_Each_Email_Domain": {
                                  "foreach": "@items('Results_Loop')['email_domain']",
                                  "actions": {
                                    "Append_to_email_domains_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "email_domains",
                                        "value": "@{items('For_Each_Email_Domain')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_email_domain_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Admin_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['admin_contact']['email']",
                                  "actions": {
                                    "Append_to_admin_contact_email_": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "admin_contact_email",
                                        "value": "@{items('For_each_Admin_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to__Domain_Details_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Billing_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['billing_contact']['email']",
                                  "actions": {
                                    "Append_to_billing_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "billing_contact_email",
                                        "value": "@{items('For_each_Billing_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_admin_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Name_Server": {
                                  "foreach": "@items('Results_Loop')['name_server']",
                                  "actions": {
                                    "Append_to_array_variable": {
                                      "runAfter": {
                                        "Name_Server_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "nameservers",
                                        "value": "@outputs('Name_Server_Compose')"
                                      }
                                    },
                                    "For_each_namer_server_ip": {
                                      "foreach": "@items('For_each_Name_Server')['ip']",
                                      "actions": {
                                        "Append_to_name_server_ips_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "name_server_ips",
                                            "value": "@{items('For_each_namer_server_ip')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_name_server_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "Name_Server_Compose": {
                                      "runAfter": {
                                        "For_each_namer_server_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "Nameserver Domain": "@items('For_each_Name_Server')?['domain']?['value']",
                                        "Nameserver Host": "@items('For_each_Name_Server')?['host']?['value']",
                                        "Nameserver IPs": "@substring(variables('name_server_ips'),0,sub(length(variables('name_server_ips')),1))"
                                      }
                                    },
                                    "Set_name_server_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "name_server_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_mx": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Registrant_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['registrant_contact']['email']",
                                  "actions": {
                                    "Append_to_registrant_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrant_contact_email",
                                        "value": "@{items('For_each_Registrant_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_billing_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SOA_Email": {
                                  "foreach": "@items('Results_Loop')['soa_email']",
                                  "actions": {
                                    "Append_to_soa_email_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "soa_emails",
                                        "value": "@{items('For_each_SOA_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_soa_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_SSL_Email": {
                                  "foreach": "@items('Results_Loop')['ssl_email']",
                                  "actions": {
                                    "Append_to_SSL_Email_array_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "ssl_emails",
                                        "value": "@{items('For_each_SSL_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_ssl_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Tags": {
                                  "foreach": "@items('Results_Loop')?['tags']",
                                  "actions": {
                                    "Append_to_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "tags",
                                        "value": "@{items('For_each_Tags')?['label']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_adddtional_whois_email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_Technical_Contact_Email": {
                                  "foreach": "@items('Results_Loop')['technical_contact']['email']",
                                  "actions": {
                                    "Append_to_technical_contact_email": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "technical_contact_email",
                                        "value": "@{items('For_each_Technical_Contact_Email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_registrant_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_adddtional_whois_email": {
                                  "foreach": "@items('Results_Loop')['additional_whois_email']",
                                  "actions": {
                                    "Append_toadddtional_whois_email_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "additional_whois_emails",
                                        "value": "@{items('For_each_adddtional_whois_email')?['value']},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "set_additonal_whois_email_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_ip": {
                                  "foreach": "@items('Results_Loop')['ip']",
                                  "actions": {
                                    "Append_to_ips_array_variable": {
                                      "runAfter": {
                                        "IP_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "ips",
                                        "value": "@outputs('IP_Compose')"
                                      }
                                    },
                                    "For_each_IP_Asn": {
                                      "foreach": "@items('For_each_ip')['asn']",
                                      "actions": {
                                        "Append_to_ips_asn_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "ips_asns",
                                            "value": "@{items('For_each_IP_Asn')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_ips_asn_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "IP_Compose": {
                                      "runAfter": {
                                        "For_each_IP_Asn": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "IP ASN": "@substring(variables('ips_asns'),0,sub(length(variables('ips_asns')),1))",
                                        "IP Address": "@items('For_each_ip')?['address']?['value']",
                                        "IP Country Code": "@items('For_each_ip')?['country_code']?['value']",
                                        "IP ISP": "@items('For_each_ip')?['country_code']?['value']"
                                      }
                                    },
                                    "Set_ips_asn_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "ips_asns",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Append_to_techinical_contact_array": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_mx": {
                                  "foreach": "@items('Results_Loop')['mx']",
                                  "actions": {
                                    "Append_to_mxs_array_variable": {
                                      "runAfter": {
                                        "MX_Compose": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "AppendToArrayVariable",
                                      "inputs": {
                                        "name": "mxs",
                                        "value": "@outputs('MX_Compose')"
                                      }
                                    },
                                    "For_each_Mx_ip": {
                                      "foreach": "@items('For_each_mx')['ip']",
                                      "actions": {
                                        "Append_to_mx_ips_variable": {
                                          "type": "AppendToStringVariable",
                                          "inputs": {
                                            "name": "mx_ips",
                                            "value": "@{items('For_each_Mx_ip')?['value']},"
                                          }
                                        }
                                      },
                                      "runAfter": {
                                        "Set_mx_ips_to_empty": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Foreach"
                                    },
                                    "MX_Compose": {
                                      "runAfter": {
                                        "For_each_Mx_ip": [
                                          "Succeeded"
                                        ]
                                      },
                                      "type": "Compose",
                                      "inputs": {
                                        "MX Domain": "@items('For_each_mx')?['domain']?['value']",
                                        "MX Host": "@items('For_each_mx')?['host']?['value']",
                                        "MX IP": "@substring(variables('mx_ips'),0,sub(length(variables('mx_ips')),1))",
                                        "MX Priority": "@items('For_each_mx')?['priority']"
                                      }
                                    },
                                    "Set_mx_ips_to_empty": {
                                      "type": "SetVariable",
                                      "inputs": {
                                        "name": "mx_ips",
                                        "value": " "
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "For_each_ip": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "For_each_registrar_status": {
                                  "foreach": "@items('Results_Loop')?['registrar_status']",
                                  "actions": {
                                    "Append_to_registrar_status_string_variable": {
                                      "type": "AppendToStringVariable",
                                      "inputs": {
                                        "name": "registrar_status",
                                        "value": "@{items('For_each_registrar_status')},"
                                      }
                                    }
                                  },
                                  "runAfter": {
                                    "Set_Tags_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Foreach"
                                },
                                "IP_Table": {
                                  "runAfter": {
                                    "miscellaneouos_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('ips')"
                                  }
                                },
                                "MX_Table": {
                                  "runAfter": {
                                    "IP_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('mxs')"
                                  }
                                },
                                "Miscellaneous_Compose": {
                                  "runAfter": {
                                    "For_each_Tags": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Additional Whois Emails": "@substring(variables('additional_whois_emails'),0,sub(length(variables('additional_whois_emails')),1))",
                                    "Email Domains": "@substring(variables('email_domains'),0,sub(length(variables('email_domains')),1))",
                                    "SOA Emails": "@substring(variables('soa_emails'),0,sub(length(variables('soa_emails')),1))",
                                    "SSL Emails": "@substring(variables('ssl_emails'),0,sub(length(variables('ssl_emails')),1))",
                                    "Tags": "@substring(variables('tags'),0,sub(length(variables('tags')),1))"
                                  }
                                },
                                "Nameserver_Table": {
                                  "runAfter": {
                                    "MX_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('nameservers')"
                                  }
                                },
                                "RData_Lookup_with_RRType": {
                                  "runAfter": {
                                    "Technical_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "ApiConnection",
                                  "inputs": {
                                    "host": {
                                      "connection": {
                                        "name": "@parameters('$connections')['farsightdnsdb']['connectionId']"
                                      }
                                    },
                                    "method": "get",
                                    "path": "/lookup/rdata/name/@{encodeURIComponent(variables('domain_name'))}/ANY",
                                    "queries": {
                                      "humantime": true,
                                      "limit": "@variables('dnsdb_results_count')"
                                    }
                                  }
                                },
                                "Registrant_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Registrant_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Registrant Contact City": "@items('Results_Loop')?['registrant_contact']?['city']?['value']",
                                    "Registrant Contact Country": "@items('Results_Loop')?['registrant_contact']?['country']?['value']",
                                    "Registrant Contact Email": "@substring(variables('registrant_contact_email'),0,sub(length(variables('registrant_contact_email')),1))",
                                    "Registrant Contact Fax": "@items('Results_Loop')?['registrant_contact']?['fax']?['value']",
                                    "Registrant Contact Name": "@items('Results_Loop')?['registrant_contact']?['name']?['value']",
                                    "Registrant Contact Org": "@items('Results_Loop')?['registrant_contact']?['org']?['value']",
                                    "Registrant Contact Phone": "@items('Results_Loop')?['registrant_contact']?['phone']?['value']",
                                    "Registrant Contact Postal": "@items('Results_Loop')?['registrant_contact']?['postal']?['value']",
                                    "Registrant Contact State": "@items('Results_Loop')?['registrant_contact']?['state']?['value']",
                                    "Registrant Contact Street": "@items('Results_Loop')?['registrant_contact']?['street']?['value']"
                                  }
                                },
                                "Registrant_Contact_Table": {
                                  "runAfter": {
                                    "Billing_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('registrant_contact_details')"
                                  }
                                },
                                "Set_Admin_Contact_to_Empty": {
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Billing_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Billing_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Set_Admin_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "billing_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Domain_Details_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "domain_details_array",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Registrant_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Registrant_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Billing_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrant_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_Set_Admin_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Admin_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "admin_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Tags_to_Empty": {
                                  "runAfter": {
                                    "Set_registrar_status_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "tags",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_Email_to_Empty": {
                                  "runAfter": {
                                    "Set_Techinical_Contact_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_email",
                                    "value": " "
                                  }
                                },
                                "Set_Techinical_Contact_to_Empty": {
                                  "runAfter": {
                                    "Set_Registrant_Contact_Email_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "technical_contact_details",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_ips_variable_to_empty": {
                                  "runAfter": {
                                    "Set_miscellaneous_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ips",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_miscellaneous_to_empty": {
                                  "runAfter": {
                                    "Set_Domain_Details_to_Empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "Miscellaneous",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_mxs_variable_to_empty": {
                                  "runAfter": {
                                    "Set_ips_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "mxs",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_nameservers_variable_to_empty": {
                                  "runAfter": {
                                    "Set_mxs_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "nameservers",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "Set_registrar_status_to_empty": {
                                  "runAfter": {
                                    "Set_nameservers_variable_to_empty": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_status",
                                    "value": " "
                                  }
                                },
                                "Technical_Contact_Compose": {
                                  "runAfter": {
                                    "For_each_Technical_Contact_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Technical Contact City": "@items('Results_Loop')?['technical_contact']?['city']?['value']",
                                    "Technical Contact Country": "@items('Results_Loop')?['technical_contact']?['country']?['value']",
                                    "Technical Contact Email": "@substring(variables('technical_contact_email'),0,sub(length(variables('technical_contact_email')),1))",
                                    "Technical Contact Fax": "@items('Results_Loop')?['technical_contact']?['fax']?['value']",
                                    "Technical Contact Name": "@items('Results_Loop')?['technical_contact']?['name']?['value']",
                                    "Technical Contact Org": "@items('Results_Loop')?['technical_contact']?['org']?['value']",
                                    "Technical Contact Phone": "@items('Results_Loop')?['technical_contact']?['phone']?['value']",
                                    "Technical Contact Postal": "@items('Results_Loop')?['technical_contact']?['postal']?['value']",
                                    "Technical Contact State": "@items('Results_Loop')?['technical_contact']?['state']?['value']",
                                    "Technical Contact Street": "@items('Results_Loop')?['technical_contact']?['street']?['value']"
                                  }
                                },
                                "Technical_Contact_Table": {
                                  "runAfter": {
                                    "Registrant_Contact_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('technical_contact_details')"
                                  }
                                },
                                "_Domain_Details_Compose": {
                                  "runAfter": {
                                    "Condition_3": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Compose",
                                  "inputs": {
                                    "Active": "@items('Results_Loop')?['active']",
                                    "Adsense": "@items('Results_Loop')?['adsense']?['value']",
                                    "Alexa": "@items('Results_Loop')?['alexa']",
                                    "Create Date": "@items('Results_Loop')?['create_date']?['value']",
                                    "Data Updated Timestsamap": "@items('Results_Loop')?['data_updated_timestamp']",
                                    "Domain": "@items('Results_Loop')?['domain']",
                                    "Expiration Date": "@items('Results_Loop')?['expiration_date']?['value']",
                                    "Google Analytics": "@items('Results_Loop')?['google_analytics']?['value']",
                                    "Redirect": "@items('Results_Loop')?['redirect']?['value']",
                                    "Redirect Domain": "@items('Results_Loop')?['redirect_domain']?['value']",
                                    "Registrant Name": "@items('Results_Loop')?['registrant_name']?['value']",
                                    "Registrant Org": "@items('Results_Loop')?['registrant_org']?['value']",
                                    "Registrar": "@variables('registrar_value')",
                                    "Registrar Status": "@substring(variables('registrar_status'),0,sub(length(variables('registrar_status')),1))",
                                    "Risk Score": "@items('Results_Loop')?['domain_risk']?['risk_score']",
                                    "SPF Info": "@items('Results_Loop')?['spf_info']",
                                    "TLD": "@items('Results_Loop')?['tld']",
                                    "Website Response": "@items('Results_Loop')?['website_response']",
                                    "Whois URL": "@items('Results_Loop')?['whois_url']"
                                  }
                                },
                                "miscellaneouos_Table": {
                                  "runAfter": {
                                    "Domain_Risk_Score_Components_Table": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "Table",
                                  "inputs": {
                                    "format": "HTML",
                                    "from": "@variables('Miscellaneous')"
                                  }
                                },
                                "set_additonal_whois_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SSL_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "additional_whois_emails",
                                    "value": " "
                                  }
                                },
                                "set_dnsdb_results": {
                                  "runAfter": {
                                    "RData_Lookup_with_RRType": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "dnsdb_rdata_results",
                                    "value": "[variables('TemplateEmptyArray')]"
                                  }
                                },
                                "set_email_domain_to_empty": {
                                  "runAfter": {
                                    "For_each_Name_Server": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "email_domains",
                                    "value": " "
                                  }
                                },
                                "set_registrar_value": {
                                  "runAfter": {
                                    "For_each_registrar_status": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "registrar_value",
                                    "value": "@{items('Results_Loop')?['registrar']}"
                                  }
                                },
                                "set_soa_email_to_empty": {
                                  "runAfter": {
                                    "For_Each_Email_Domain": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "soa_emails",
                                    "value": " "
                                  }
                                },
                                "set_ssl_email_to_empty": {
                                  "runAfter": {
                                    "For_each_SOA_Email": [
                                      "Succeeded"
                                    ]
                                  },
                                  "type": "SetVariable",
                                  "inputs": {
                                    "name": "ssl_emails",
                                    "value": " "
                                  }
                                }
                              },
                              "type": "Foreach"
                            }
                          },
                          "runAfter": {
                            "Investigate_Domain": [
                              "Succeeded"
                            ]
                          },
                          "else": {
                            "actions": {
                              "Add_comment_to_incident_(V3)_2": {
                                "type": "ApiConnection",
                                "inputs": {
                                  "body": {
                                    "incidentArmId": "@triggerBody()?['object']?['id']",
                                    "message": "<p>No results found for @{variables('domain_name')}</p>"
                                  },
                                  "host": {
                                    "connection": {
                                      "name": "@parameters('$connections')['azuresentinel']['connectionId']"
                                    }
                                  },
                                  "method": "post",
                                  "path": "/Incidents/Comment"
                                }
                              }
                            }
                          },
                          "expression": {
                            "and": [
                              {
                                "greater": [
                                  "@length(body('Investigate_Domain')?['response']?['results'])",
                                  0
                                ]
                              }
                            ]
                          },
                          "type": "If"
                        },
                        "Investigate_Domain": {
                          "runAfter": {
                            "Check_DNS_Name_is_empty": [
                              "Succeeded"
                            ]
                          },
                          "type": "ApiConnection",
                          "inputs": {
                            "host": {
                              "connection": {
                                "name": "@parameters('$connections')['domaintoolsirisinves']['connectionId']"
                              }
                            },
                            "method": "post",
                            "path": "/iris-investigate/investigate_domain",
                            "queries": {
                              "domain": "@variables('domain_name')"
                            }
                          }
                        },
                        "Set_DNS_Name_Variable": {
                          "runAfter": {
                            "Set_Host_Name_Variable": [
                              "Succeeded"
                            ]
                          },
                          "type": "SetVariable",
                          "inputs": {
                            "name": "dns_name",
                            "value": "@items('For_each_Host')?['DnsDomain']"
                          }
                        },
                        "Set_Host_Name_Variable": {
                          "type": "SetVariable",
                          "inputs": {
                            "name": "host_name",
                            "value": "@items('For_each_Host')?['HostName']"
                          }
                        }
                      },
                      "runAfter": {
                        "Entities_-_Get_Hosts": [
                          "Succeeded"
                        ]
                      },
                      "type": "Foreach",
                      "runtimeConfiguration": {
                        "concurrency": {
                          "repetitions": 1
                        }
                      }
                    },
                    "Host_Name_Variable": {
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "host_name",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "Miscellaneous_variable": {
                      "runAfter": {
                        "registrar_status_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "Miscellaneous",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "additional_whois_email": {
                      "runAfter": {
                        "ssl_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "additional_whois_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "admin_contact_details_variable": {
                      "runAfter": {
                        "domain_details_array_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "admin_contact_email_variable": {
                      "runAfter": {
                        "admin_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "admin_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "billing_contact_details_variable": {
                      "runAfter": {
                        "admin_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "billing_contact_email_variable": {
                      "runAfter": {
                        "billing_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "billing_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "dnsdb_rdata_results": {
                      "runAfter": {
                        "nameservers_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dnsdb_rdata_results",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "dnsdb_results_count": {
                      "runAfter": {
                        "dnsdb_rdata_results": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dnsdb_results_count",
                            "type": "integer",
                            "value": 10
                          }
                        ]
                      }
                    },
                    "dnsdb_results_string": {
                      "runAfter": {
                        "dnsdb_results_count": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "dnsdb_results_string",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "domain_details_array_variable": {
                      "runAfter": {
                        "Domain_Name_Variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "domain_details_array",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "email_domains": {
                      "runAfter": {
                        "technical_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "email_domains",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_asns_": {
                      "runAfter": {
                        "additional_whois_email": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips_asns",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ips_variable": {
                      "runAfter": {
                        "Miscellaneous_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ips",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "mx_ips": {
                      "runAfter": {
                        "ips_asns_": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mx_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "mxs_variable": {
                      "runAfter": {
                        "ips_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "mxs",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "name_server_ips": {
                      "runAfter": {
                        "mx_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "name_server_ips",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "nameservers_variable": {
                      "runAfter": {
                        "mxs_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "nameservers",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_details_variable": {
                      "runAfter": {
                        "billing_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "registrant_contact_email_variable": {
                      "runAfter": {
                        "registrant_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrant_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_status_variable": {
                      "runAfter": {
                        "tags_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_status",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "registrar_value": {
                      "runAfter": {
                        "dnsdb_results_string": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "registrar_value",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "soa_emails": {
                      "runAfter": {
                        "email_domains": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "soa_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_emails": {
                      "runAfter": {
                        "soa_emails": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_emails",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "ssl_info_array": {
                      "runAfter": {
                        "name_server_ips": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "ssl_info",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "tags_variable": {
                      "runAfter": {
                        "ssl_info_array": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "tags",
                            "type": "string"
                          }
                        ]
                      }
                    },
                    "technical_contact_details_variable": {
                      "runAfter": {
                        "registrant_contact_email_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_details",
                            "type": "array"
                          }
                        ]
                      }
                    },
                    "technical_contact_email_variable": {
                      "runAfter": {
                        "technical_contact_details_variable": [
                          "Succeeded"
                        ]
                      },
                      "type": "InitializeVariable",
                      "inputs": {
                        "variables": [
                          {
                            "name": "technical_contact_email",
                            "type": "string"
                          }
                        ]
                      }
                    }
                  }
                },
                "parameters": {
                  "$connections": {
                    "value": {
                      "azuresentinel": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('AzureSentinelConnectionName'))]",
                        "connectionName": "[[variables('AzureSentinelConnectionName')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/azuresentinel')]",
                        "connectionProperties": {
                          "authentication": {
                            "type": "ManagedServiceIdentity"
                          }
                        }
                      },
                      "farsightdnsdb": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('FarsightDNSDBApiKey'))]",
                        "connectionName": "[[variables('FarsightDNSDBApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/farsightdnsdb')]"
                      },
                      "domaintoolsirisinves": {
                        "connectionId": "[[resourceId('Microsoft.Web/connections', variables('DomainToolsApiKey'))]",
                        "connectionName": "[[variables('DomainToolsApiKey')]",
                        "id": "[[concat('/subscriptions/', subscription().subscriptionId, '/providers/Microsoft.Web/locations/', variables('workspace-location-inline'), '/managedApis/domaintoolsirisinves')]"
                      }
                    }
                  }
                }
              },
              "tags": {
                "hidden-SentinelWorkspaceId": "[[variables('workspaceResourceId')]"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Playbook-', last(split(variables('playbookId8'),'/'))))]",
              "properties": {
                "parentId": "[variables('playbookId8')]",
                "contentId": "[variables('_playbookContentId8')]",
                "kind": "Playbook",
                "version": "[variables('playbookVersion8')]",
                "source": {
                  "kind": "Solution",
                  "name": "DomainTools",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "DomainTools",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "tier": "Partner",
                  "name": "DomainTools",
                  "email": "memberservices@domaintools.com",
                  "link": "https://www.domaintools.com/support/"
                }
              }
            }
          ],
          "metadata": {
            "title": "Domain Enrichment- DomainTools Iris Investigate With Farsight DNSDB",
            "description": "Given a domain or set of domains associated with an incident, enrich the domain using the DomainTools Iris Investigate API, returning whois and infrastructure details. Subsequently retrieve associated subdomains from passive DNS information seen in Farsight’s DNSDB.",
            "prerequisites": [
              "A DomainTools API Key provisioned for Iris Investigate. Visit https://www.domaintools.com/integrations to request a trial key.",
              "A Farisght API Key provisioned for Farsight DNSDB. Visit https://www.farsightsecurity.com/about-farsight-security/contacts/ to request a trial key"
            ],
            "lastUpdateTime": "2022-09-24T00:00:00Z",
            "entities": [
              "host"
            ],
            "tags": [
              "Enrichment"
            ],
            "releaseNotes": {
              "version": "1.0",
              "title": "[variables('blanks')]",
              "notes": [
                "Initial version"
              ]
            }
          }
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_playbookContentId8')]",
        "contentKind": "Playbook",
        "displayName": "DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook",
        "contentProductId": "[variables('_playbookcontentProductId8')]",
        "id": "[variables('_playbookcontentProductId8')]",
        "version": "[variables('playbookVersion8')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "DomainTools",
        "publisherDisplayName": "DomainTools",
        "descriptionHtml": "<p><strong>Note:</strong> <em>There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</em></p>\n<p>The <a href=\"https://www.domaintools.com/products/platform/iris-investigate/\">Domaintools Iris investigate</a> solution for Microsoft Sentinel contains Playbooks that can help Enrich domain &amp; investigate domain, domain risk score, Malicious tags, URL's and DNS from Domain tools. This enriched / investigated information can help drive better analysis in security Operations.</p>\n<p><strong>Function Apps:</strong> 1, <strong>Playbooks:</strong> 7</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<img src=\"https://raw.githubusercontent.com/Azure/Azure-Sentinel/master/Solutions/DomainTools/Playbooks/DomainTools_Iris_Enrich-Domain_Playbook/graphics/DomainTools.png\"width=\"75px\"height=\"75px\">",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "DomainTools",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "DomainTools",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "DomainTools",
          "email": "memberservices@domaintools.com",
          "tier": "Partner",
          "link": "https://www.domaintools.com/support/"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "AzureFunction",
              "contentId": "[variables('_DomainToolsFunctionApp')]",
              "version": "[variables('playbookVersion1')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Enrich-Domain_Playbook')]",
              "version": "[variables('playbookVersion2')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-Domain_Playbook')]",
              "version": "[variables('playbookVersion3')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-Domain_Risk_Score_Playbook')]",
              "version": "[variables('playbookVersion4')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-Guided_Pivots_Playbook')]",
              "version": "[variables('playbookVersion5')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-Malicious_Tags_Playbook')]",
              "version": "[variables('playbookVersion6')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-URL_Playbook')]",
              "version": "[variables('playbookVersion7')]"
            },
            {
              "kind": "Playbook",
              "contentId": "[variables('_DomainTools_Iris_Investigate-With_Farsight_pDNS_Playbook')]",
              "version": "[variables('playbookVersion8')]"
            }
          ]
        },
        "firstPublishDate": "2022-10-20",
        "providers": [
          "DomainTools"
        ],
        "categories": {
          "domains": [
            "Security - Automation (SOAR)",
            "Security - Threat Intelligence"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}
